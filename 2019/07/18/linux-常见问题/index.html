






<!doctype html>
<html lang="zh-CN">
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="author" content="Cellophane">
  
  
  
  
    <meta name="description" content="进程相关如何让一个进程在后台运行
使用 &amp;
输入命令 ./a.out &amp; 会在终端显示进程号，结果输出到终端
键入 Ctrl + C，发出 SIGINT 信号，程序会继续运行
如果关闭窗口（SIGHUP），进程也会关闭


使用 nohup
结果默认会输出到 nohup.out
键入 Ctrl + C（SIGINT），程序直接关闭
如果关闭窗口（SIGHUP），进程不会关闭，...">
  
  <title>linux 常见问题 [ Cellophane ]</title>
  
  
    <link rel="shortcut icon" href="/Blinky.ico">
  
  
  <link rel="stylesheet" href="/css/random.css">
<link rel="stylesheet" href="/css/vegas.min.css">
<link rel="stylesheet" href="/css/styles/railscasts.css">
<link rel="stylesheet" href="/css/jquery.fancybox.css">
<link rel="stylesheet" href="/css/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/jquery.fancybox-thumbs.css">
<link rel="stylesheet" href="/css/plyr.css">
<link rel="stylesheet" href="/css/prism.css">
  
</head>

<body>
<div class="side-navigate hide-area">
  
    <div class="item prev">
      <a href="/2019/08/14/MySQL-索引/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        MySQL 索引
      </div>
    </div>
  
  
    <div class="item next">
      <a href="/2019/07/08/PHP中判断一个参数存不存在的问题/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        PHP中判断一个参数存不存在的问题
      </div>
    </div>
  
</div>
<div id="outer-container" class="hide-area">
<div id="container">
  <div id="menu-outer" class="slide-down">
    <div id="menu-inner">
      <div id="brand">
        
        <a onClick="openUserCard()">
          <img id="avatar" src="/images/me3.jpg"/>
          <div id="homelink">Cellophane</div>
        </a>
      </div>
      <div id="menu-list">
        <ul>
        
        
          
            <li>
          
            <a href="/index.html">首页</a>
            
          </li>
        
          
            <li>
          
            <a href="/archives">文章</a>
            
          </li>
        
          
            <li>
          
            <a href="/tags">标签</a>
            
          </li>
        
          
            <li>
          
            <a href="/categories">分类</a>
            
          </li>
        
        </ul>
      </div>
      <div id="show-menu">
        <button>Menu</button>
      </div>
    </div>
  </div>

  <div id="content-outer">
    <div id="content-inner">
      
      
  

  <article id="post">
    <h1>linux 常见问题</h1>
    <p class="page-title-sub">
      <span id = "post-title-date">撰写于 2019-07-18</span>
      
      
      <span id = "post-title-categories">分类
      
      
        
        
        <a href="/categories/基础/">基础</a>
      
      </span>
      
      
      <span id = "post-title-tags">
      标签
      
      
        
        
        <a href="/tags/Linux/">Linux</a>
      
        
          /
        
        
        <a href="/tags/题目/">题目</a>
      
      </span>
      
    </p>
    
    <h1 id="进程相关"><a href="#进程相关" class="headerlink" title="进程相关"></a>进程相关</h1><h2 id="如何让一个进程在后台运行"><a href="#如何让一个进程在后台运行" class="headerlink" title="如何让一个进程在后台运行"></a>如何让一个进程在后台运行</h2><ul>
<li>使用 &amp;<ul>
<li>输入命令 <code>./a.out &amp;</code> 会在终端显示进程号，结果输出到终端</li>
<li>键入 Ctrl + C，发出 SIGINT 信号，程序会继续运行</li>
<li>如果关闭窗口（SIGHUP），进程也会关闭</li>
</ul>
</li>
<li>使用 nohup<ul>
<li>结果默认会输出到 nohup.out</li>
<li>键入 Ctrl + C（SIGINT），程序直接关闭</li>
<li>如果关闭窗口（SIGHUP），进程不会关闭，可以通过 killall 关闭<br>一般会使用 nohup 配合 &amp; 来启动程序，同时免疫 SIGINT 和 SIGHUP 信号</li>
</ul>
</li>
</ul>
<h2 id="如何查看日志"><a href="#如何查看日志" class="headerlink" title="如何查看日志"></a>如何查看日志</h2><ul>
<li><code>tail error.log</code> 查看文件末尾</li>
<li><code>tail -f error.log</code> 实时输出最新写入的数据</li>
</ul>
<h2 id="查询线程数"><a href="#查询线程数" class="headerlink" title="查询线程数"></a>查询线程数</h2><ul>
<li><code>ps -elf|ec -l</code></li>
<li><code>pstree -p|wa -l</code></li>
</ul>
<h2 id="查最耗-cpu-的进程"><a href="#查最耗-cpu-的进程" class="headerlink" title="查最耗 cpu 的进程"></a>查最耗 cpu 的进程</h2><ul>
<li><code>ps H -eo pid,pcpu | sort -nk2 | tail</code></li>
<li><code>top -c</code> 键入 P （进程按照 CPU 使用率排序） </li>
</ul>
<h2 id="查最耗-cpu-的线程"><a href="#查最耗-cpu-的线程" class="headerlink" title="查最耗 cpu 的线程"></a>查最耗 cpu 的线程</h2><ul>
<li><code>top -Hp 10765(进程 ID)</code> 显示一个进程的线程运行信息列表。键入 P。</li>
</ul>
<h2 id="查看堆栈"><a href="#查看堆栈" class="headerlink" title="查看堆栈"></a>查看堆栈</h2><ul>
<li>首先将线程 PID 转化为 16 进制：<code>printf &quot;%x\n&quot; 10804(线程ID)</code></li>
<li>查看堆栈：<code>jstack 10765 | grep &#39;0x2a34&#39; -C5</code></li>
</ul>
<h2 id="查出进程号对应的服务名"><a href="#查出进程号对应的服务名" class="headerlink" title="查出进程号对应的服务名"></a>查出进程号对应的服务名</h2><ul>
<li><code>ps aux | fgrep pid</code></li>
<li><code>ll /proc/pid</code> 可以打印出全路径</li>
</ul>
<h2 id="查看某个端口的连接情况"><a href="#查看某个端口的连接情况" class="headerlink" title="查看某个端口的连接情况"></a>查看某个端口的连接情况</h2><ul>
<li><code>netstat -lap | fgrep 22022</code></li>
<li><code>/user/sbin/lsof -i:22022</code></li>
</ul>
<h1 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h1><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><ul>
<li>原理：逐行处理文件中的数据</li>
<li>语法 <code>awk &#39;pattern + {action}&#39;</code><ul>
<li>‘’ 是为了和 shell 命令区分开</li>
<li>{} 表示一个命令分组</li>
<li>pattern 是一个过滤器，正则使用 /pattern/</li>
<li>action 是处理动作，默认是 print</li>
<li>使用 # 作为注释</li>
</ul>
</li>
<li>内置变量<ul>
<li>NR 当前行数，从1 开始</li>
<li>NF 当前记录字段个数</li>
<li>$0 当前记录</li>
<li>$1 ~ $N 当前记录第 n 个字段</li>
</ul>
</li>
<li>实例：<ul>
<li><code>cat hello.txt | awk &#39;NR==3, NR==5{print $1,$NF}&#39;</code> 显示 hello.txt 中的第三行至第五行的第一列与最后一列</li>
<li><code>cat hello.txt | awk &#39;length($0)&gt;80{print NR}&#39;</code> 显示 hello.txt 中，长度大于 100 的行号</li>
</ul>
</li>
</ul>
<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><ul>
<li>参数：<ul>
<li>-n sed 会在处理一行文本前，将待处理的文本打印出来，-n 参数关闭了这个功能</li>
<li>p 命令表示打印当前行</li>
</ul>
</li>
<li>基本命令<ul>
<li>a\ 在匹配行后面加入一条文本</li>
<li>i\ 在匹配行前面加入一行文本</li>
<li>c\ 将匹配行替换为目的行</li>
<li>d 将匹配行删除</li>
<li>s 将匹配行替换 <code>s/被替换的串/替换成这个串/g</code> g 代表全部替换</li>
</ul>
</li>
<li><code>sed -n &#39;2,$&#39;p hello.txt</code> 打印第二行到最后一行，$ 表示最后一行</li>
<li><code>sed -n &#39;/100/&#39;p hello.txt</code> 打印 hello.txt 中 正则匹配 100 的行</li>
<li><code>sed &#39;/100/&#39;i\ &quot;new line&quot; hello.txt</code></li>
</ul>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><h2 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h2><p>sort 和 uniq 经常配对使用。<br>sort 可以使用 -t 指定分隔符，使用 -k 指定要排序的列。</p>
<p>下面这个命令输出 nginx 日志的 ip 和每个 ip 的 pv，pv 最高的前10</p>
<pre class="line-numbers language-shell"><code class="language-shell">#2019-06-26T10:01:57+08:00|nginx001.server.ops.pro.dc|100.116.222.80|10.31.150.232:41021|0.014|0.011|0.000|200|200|273|-|/visit|sign=91CD1988CE8B313B8A0454A4BBE930DF|-|-|http|POST|112.4.238.213

awk -F"|" '{print $3}' access.log | sort | uniq -c | sort -nk1 -r | head -n10
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="磁盘相关"><a href="#磁盘相关" class="headerlink" title="磁盘相关"></a>磁盘相关</h1><h2 id="du-和-df"><a href="#du-和-df" class="headerlink" title="du 和 df"></a>du 和 df</h2><ul>
<li>du 通过搜索文件来计算每个文件的大小然后累加得到值。</li>
<li>df 通过文件系统来获取空间大小信息。</li>
</ul>
<p>如果用户删除了一个正在运行的应用程序所打开的某个目录下的文件。du 返回的值是删除了文件后的大小，df 返回的值，不显示减去该文件后的大小。</p>
<p>如果要删除某个日志：<code>echo &quot;&quot; &gt; access.log</code></p>
<h2 id="如何查看已删除文件"><a href="#如何查看已删除文件" class="headerlink" title="如何查看已删除文件"></a>如何查看已删除文件</h2><ul>
<li><code>lsof | grep deleted</code></li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651961108&amp;idx=1&amp;sn=3fccc94c4307fa2306bae680d8570c18&amp;chksm=bd2d02c88a5a8bde8944e383a3fb9b6d24461cf07ed5a65dbf774a2382bf1f318aca18df5572&amp;scene=21#wechat_redirect" target="_blank" rel="external">一分钟了解nohup和&amp;的功效</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=205216499&amp;idx=1&amp;sn=656b5403f3be045772bb539c873e6bd0&amp;scene=21#wechat_redirect" target="_blank" rel="external">linux下追查线上问题常用命令</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651963003&amp;idx=1&amp;sn=fdf4c9a54dbc03568c5d5ad7a0c2112b&amp;chksm=bd2d0ba78a5a82b132d5968a147f13ccd4c81cd1da4fc0a9de1228f505191b2357b17488e00d&amp;scene=21#wechat_redirect" target="_blank" rel="external">线上问题排查，这些命令你一定用得到！</a></li>
<li><a href="https://mp.weixin.qq.com/s/9RbTGQ4k4s92mrSf2xJ5TQ" target="_blank" rel="external">Linux上，最常用的一批命令解析（10年精选）</a></li>
</ul>

  </article>
  <div class="random-toc-area">
  <button class="btn-hide-toc btn-hide-toc-show" style="display: none" onclick="TOCToggle()">显示目录</button>
  <button class="btn-hide-toc btn-hide-toc-hide" onclick="TOCToggle()">隐藏目录</button>
  <div class="random-toc">
    <h2>目录</h2>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#进程相关"><span class="toc-text">进程相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何让一个进程在后台运行"><span class="toc-text">如何让一个进程在后台运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何查看日志"><span class="toc-text">如何查看日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询线程数"><span class="toc-text">查询线程数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查最耗-cpu-的进程"><span class="toc-text">查最耗 cpu 的进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查最耗-cpu-的线程"><span class="toc-text">查最耗 cpu 的线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看堆栈"><span class="toc-text">查看堆栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查出进程号对应的服务名"><span class="toc-text">查出进程号对应的服务名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看某个端口的连接情况"><span class="toc-text">查看某个端口的连接情况</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#文本处理"><span class="toc-text">文本处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#awk"><span class="toc-text">awk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed"><span class="toc-text">sed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#grep"><span class="toc-text">grep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#统计"><span class="toc-text">统计</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#磁盘相关"><span class="toc-text">磁盘相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#du-和-df"><span class="toc-text">du 和 df</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何查看已删除文件"><span class="toc-text">如何查看已删除文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
  </div>
</div>

  
<nav id="pagination">
  
    <a href="/2019/08/14/MySQL-索引/" class="prev">&larr; 上一篇 MySQL 索引</a>
  

  

  
    <a href="/2019/07/08/PHP中判断一个参数存不存在的问题/" class="next">下一篇 PHP中判断一个参数存不存在的问题 &rarr;</a>
  
</nav>

  <!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


      
      
    </div>
  </div>

  <div id="bottom-outer">
    <div id="bottom-inner">
      Site by Cellophane using
      <a href="http://hexo.io">Hexo</a> & <a href="https://github.com/stiekel/hexo-theme-random">Random</a>
      <br>
      
    </div>
  </div>
</div>

</div>


<div id="user-card">
  <div class="center-field">
    <img class="avatar" src="/images/me3.jpg">
    <p id="description"></p>
    <ul class="social-icon">
  
  
    <li>
      <a href="https://github.com/liuyuqi21">
        
          <i class="icon iconfont github">&#xe606;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.zhihu.com/people/ding-wei-33-1/activities">
        
          <i class="icon iconfont zhihu">&#xe60b;</i>
        
      </a>
    </li>
  
    <li>
      <a href="http://chensd.com">
        
          <i class="icon iconfont rss">&#xe60e;</i>
        
      </a>
    </li>
  
</ul>
  </div>
</div>


<div id="btn-view">Hide</div>

<script>
// is trigger analytics / tongji script
var isIgnoreHost = false;

if(window && window.location && window.location.host) {
  isIgnoreHost = ["localhost","127.0.0.1"].some(function(address){
    return 0 === window.location.host.indexOf(address);
  });
}

var isTriggerAnalytics = !( true && isIgnoreHost );

</script>




  
  
    <script src="/js/jquery-2.2.3.min.js"></script>
  
    <script src="/js/vegas.min.js"></script>
  
    <script src="/js/random.js"></script>
  
    <script src="/js/highlight.pack.js"></script>
  
    <script src="/js/jquery.mousewheel.pack.js"></script>
  
    <script src="/js/jquery.fancybox.pack.js"></script>
  
    <script src="/js/jquery.fancybox-thumbs.js"></script>
  
    <script src="/js/plyr.js"></script>
  
    <script src="/js/prism.js"></script>
  

<script>

  // fancybox
  var backgroundImages = [];
  
  $('#post').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('fancybox-thumb')) return;
      var alt = this.alt || this.title;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'post' + i);
    });
  });
  $(".fancybox").fancybox();

var vegasConfig = {"preload­Image":true,"transition":["flash"],"timer":true,"delay":1500000,"shuffle":true,"count":12};
var unsplashConfig = {"gravity":"center"};
// is show background images
var turnoffBackgroundImage = false;




var backgroundColor = "34495E";

$(".fancybox-thumb").fancybox({
  prevEffect: 'none',
  nextEffect: 'none',
  helpers: {
    title: {
      type: 'outside'
    },
    thumbs: {
      width: 50,
      height: 50
    }
  }
});

// show video with plyr
$(".video-container iframe").each(function(i){
  var url = $(this).attr('src');
  var id = url.split('/').pop();
  var plyrContainer = document.createElement('div');
  plyrContainer.className = 'plyr';
  var plyrElement = document.createElement('div');
  plyrElement.dataset.videoId = id;
  switch(true) {
    case url.search('youtube.com') >= 0:
      plyrElement.dataset.type = 'youtube';
      break;
    case url.search('vimeo.com') >= 0:
      plyrElement.dataset.type = 'vimeo';
      break;
    default:
      return;
  };
  plyrContainer.appendChild(plyrElement);
  $(this).parent().html(plyrContainer);
});
plyr.setup('.plyr', {iconUrl: '/css/sprite.svg'});
</script>
</body>
</html>

