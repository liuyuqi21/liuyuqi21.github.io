---
title: 极客时间-趣谈网络协议笔记
date: 2020-03-08 22:31:23
tags: 
    - HTTP
    - 计算机网络
categories: 读书笔记
---
# 第1讲 讲为什么要学习网络协议？

协议三要素：语法、语义、顺序。

打开一个网址用到的网络协议：
1. 从 URL 协议成 IP 地址用到了 DNS 协议。
1. 知道了 IP 地址后，浏览器就开始打包它的请求，普通浏览使用 HTTP 协议，加密传输使用 HTTPS 协议。
1. DNS、HTTP、HTTPS 所在的层是**应用层**。
1. 下一层是**传输层**，HTTP 基于 TCP 协议，TCP 协议里面有两个端口，一个是浏览器监听的端口，一个是服务器监听的端口。操作系统往往通过端口来判断，它得到的包应该给哪个进程。
1. 传输层封装完毕后，浏览器会将包交给操作系统的**网络层**。网络层协议是 IP 协议，IP 协议里面会有源 IP 地址和目的 IP 地址。
1. 操作系统拿到了目标 IP 地址后，根据这个 IP 地址找目标机器。如果 IP 不在本地，就要通过发送给**网关**。操作系统启动的适合，就会被 DHCP 协议配置 IP 地址，以及默认的网关 IP 地址。
1. 操作系统如何将 IP 地址发给网关呢？在本地通信基本靠吼，于是操作系统大吼一声，谁是 192.168.1.1 啊？网关会回答它，我就是，我的本地地址在村东头。这个本地地址就是 MAC 地址，而大吼的那一声是 ARP 协议。
1. 于是操作系统将 IP 包交给了下一层，也就是 MAC 层。网卡再将包发出去。
1. 网关往往是一个路由器，收到包之后，会根据路由表找到某个 IP 地址应该怎么走。

# 第2讲 网络分层的真实含义是什么？
当然网络包的格式很复杂，这个程序也很复杂。复杂的程序都要分层，这是程序设计的要求。比如，复杂的电商还会分数据库层、缓存层、Compose 层、Controller 层和接入层，每一层专注做本层的事情。

# 第3讲 讲ifconfig：最熟悉又陌生的命令行
如何查看 ip 地址：windows 上是 ipconfig，linux 上是 ifconfig 和 ip addr。

如 10.100.122.2 就是一个 IP 地址。这个地址被点分隔为四个部分，每个部分 8 个 bit，所以 IP 地址总共是 32 位。这样产生的IP地址的数量很快就不够用了。因为不够用，于是就有了IPv6，有 128 位。

本来 32 位的 IP 地址就不够用，还被分成了 5 类。A、B、C 类主要分两部分，前面一部分是网络号，后面一部分是主机号。

![](https://gitee.com/cellophane/image/raw/master/ip.jpg)

这里面有个尴尬的事情，就是 C 类地址能包含的最大主机数量实在太少了，只有 254 个。当时设计的时候恐怕没想到，现在估计一个网吧都不够用吧。而B类地址能包含的最大主机数量又太多了。6 万多台机器放在一个网络下面，一般的企业基本达不到这个规模，闲着的地址就是浪费。

**无类型域间选路（CIDR）**
于是有了一个折中的方式叫作无类型域间选路，简称 CIDR。这种方式打破了原来设计的几类地址的做法，将 32 位的 IP 地址一分为二，前面是网络号，后面是主机号。10.100.122.2/24，这个 IP 地址中有一个斜杠，斜杠后面有个数字 24。这种地址表示形式，就是 CIDR。后面 24 的意思是，32 位中，前 24 位是网络号，后8位是主机号。

伴随着CIDR存在的，一个是广播地址，10.100.122.255。如果发送这个地址，所有 10.100.122 网络里面的机器都可以收到。另一个是子网掩码，255.255.255.0。

将子网掩码和 IP 地址进行 AND 计算。前面三个255，转成二进制都是 1。1 和任何数值取 AND，都是原来数值，因而前三个数不变，为10.100.122。后面一个 0，转换成二进制是 0，0 和任何数值取 AND，都是0，因而最后一个数变为 0，合起来就是10.100.122.0。这就是网络号。**将子网掩码和IP地址按位计算 AND，就可得到网络号**。
