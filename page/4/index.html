<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Cellophane&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Cellophane&#39;s blog">
<meta property="og:url" content="https://liuyuqi21.github.io/page/4/index.html">
<meta property="og:site_name" content="Cellophane&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Cellophane">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/icon.ico">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism-base16-ateliersulphurpool.light.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Cellophane&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://liuyuqi21.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-MySQL-索引" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/14/MySQL-%E7%B4%A2%E5%BC%95/" class="article-date">
  <time datetime="2019-08-14T07:43:25.000Z" itemprop="datePublished">2019-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/14/MySQL-%E7%B4%A2%E5%BC%95/">MySQL 索引</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="表"><a href="#表" class="headerlink" title="表"></a>表</h1><p>MySQL 使用 InnoDB 存储表时，会将表的定义和数据索引等信息分开存储，其中前者存储在 .frm 文件中，后者存储在 .ibd 文件中。</p>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><h2 id="索引工作原理"><a href="#索引工作原理" class="headerlink" title="索引工作原理"></a>索引工作原理</h2><p>索引存储了指向表中某一行的指针</p>
<p>当某个 SQL 语句运行时，数据库会检查在查询的列上是否有索引，如果有索引，数据库会接着检查使用这个索引做查询是否合理，因为有些场景下，使用索引比全表扫描更加低效。</p>
<p>可以强制数据库使用索引。</p>
<h2 id="B-Tree-索引"><a href="#B-Tree-索引" class="headerlink" title="B+Tree 索引"></a>B+Tree 索引</h2><h3 id="B-树"><a href="#B-树" class="headerlink" title="B 树"></a>B 树</h3><ul>
<li>叶子节点和非叶子节点都存储数据</li>
<li>通过中序遍历获得所有节点</li>
</ul>
<p>为什么 b 树适合做索引</p>
<ul>
<li>高度低</li>
<li>每个节点可以存储 j 个记录，如果将节点大小设置为页大小，可以利用预读特性，减少磁盘 IO。</li>
</ul>
<h3 id="局部性原理"><a href="#局部性原理" class="headerlink" title="局部性原理"></a>局部性原理</h3><ol>
<li>内存读写快，磁盘读写慢</li>
<li>磁盘预读：磁盘读写并不是按需读取，而是按页读取，一次读一页的数据。如果未来要读的数据就在这一页中，可以避免未来的磁盘 IO，提高效率。</li>
</ol>
<p>数据库系统将索引的一个节点的大小设置为页的大小，使得一次 I/O 就能完全载入一个节点。并且可以利用预读特性，相邻的节点也能够被预先载入.</p>
<h3 id="B-树-1"><a href="#B-树-1" class="headerlink" title="B+ 树"></a>B+ 树</h3><ul>
<li>非叶子节点不再存储数据，数据只存储在叶子节点上</li>
<li>相同层次的页面之间用双向链表连接</li>
<li>在 B+ Tree 中，一个节点中的 key 从左到右递增排列</li>
</ul>
<p>每颗 B+ 数由很多页面组成，B+ 数的页面可分为</p>
<ul>
<li>叶子节点：存储记录的所有内容。</li>
<li>非叶子节点：存储索引值和对应的页号</li>
</ul>
<h4 id="与-b-树的比较"><a href="#与-b-树的比较" class="headerlink" title="与 b 树的比较"></a>与 b 树的比较</h4><ul>
<li>范围查找，定位 min 和 max 之后，中间叶子节点就是结果集，不需要中序遍历。</li>
<li>叶子节点存储实际记录行，适合大数据量磁盘存储，非叶子节点存储记录的主键值，用于查询加速，适合内存存储。</li>
</ul>
<h4 id="与红黑树的比较"><a href="#与红黑树的比较" class="headerlink" title="与红黑树的比较"></a>与红黑树的比较</h4><ul>
<li>更少的查找次数：平衡树查找操作的时间复杂度和树高 h 相关，O(h)=O(logdN)，其中 d 为每个节点的出度。红黑树的出度为 2，而 B+ Tree 的出度一般都非常大，所以红黑树的树高 h 很明显比 B+ Tree 大非常多，查找的次数也就更多。</li>
<li>利用磁盘预读特性</li>
</ul>
<h2 id="hash-索引"><a href="#hash-索引" class="headerlink" title="hash 索引"></a>hash 索引</h2><p>哈希索引操作的平均复杂度都是 O(1),内存表默认使用 hash 索引。</p>
<p>但是 hash 函数计算后的结果是随机的，在磁盘上随机放置，失去了有序性。所以无法对范围查询和排序进行优化，无法利用前缀索引。</p>
<p>InnoDB 不支持哈希索引，用户无法手动创建哈希索引。</p>
<p>InnoDB 存储引擎有一个特殊的功能叫“自适应哈希索引”，当某个索引值被使用的非常频繁时，会在 B+Tree 索引之上再创建一个哈希索引，这样就让 B+Tree 索引具有哈希索引的一些优点，比如快速的哈希查找。key 是索引键值，value 是索引记录页面的位置。</p>
<h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><ul>
<li>MyISAM 存储引擎支持全文索引，用于查找文本中的关键词，而不是直接比较是否相等</li>
<li>查找使用 MATCH AGAINST 而不是普通的 WHERE</li>
<li>全文索引使用倒排索引实现，它记录着关键词到其所在文档的映射</li>
<li>InnoDB 存储引擎在 MySQL5.6.4 版本中也开始支持全文索引</li>
</ul>
<h2 id="空间数据索引"><a href="#空间数据索引" class="headerlink" title="空间数据索引"></a>空间数据索引</h2><ul>
<li>MyISAM 存储引擎支持空间数据索引（R-Tree），可以用于地理数据存储。空间数据索引会从所有维度来索引数据，可以有效地使用任意维度来进行组合查询。</li>
<li>必须使用 GIS 相关的函数来维护数据。</li>
</ul>
<h1 id="从物理角度"><a href="#从物理角度" class="headerlink" title="从物理角度"></a>从物理角度</h1><h2 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a>聚集索引</h2><p>主索引上直接存放数据，次索引存储主键的值。</p>
<p>因为次索引存储主键的值，所以不建议使用过长的字段作为主键。</p>
<p>InnoDB 是聚簇索引。<br>优势：</p>
<ol>
<li>查询条目比较少时，不用回到物理行找数据。</li>
<li>辅助索引使用主键作为“指针”而不是地址值，<strong>减少了当出现行移动或者数据页分裂时辅助索引的维护工作</strong>。</li>
</ol>
<p>劣势：碰到不规则数据插入时，造成频繁的页分裂。</p>
<ul>
<li>如果表定义了 PK，则 PK 就是聚集索引；</li>
<li>如果表没有定义 PK，则第一个非空 unique 列是聚集索引；</li>
<li>否则，InnoDB 会创建一个隐藏的 row-id 作为聚集索引；</li>
</ul>
<p>一般来讲，使用一个业务无关的自增（ AUTO_INCREMENT ）ID，可以保证数据在插入时会被按顺序写入。假设我们使用 UUID 作为聚簇索引，在插入数据的时候，聚簇索引所被插入的位置将变得完全随机。大量的随机插入会导致页分裂和碎片非常多。</p>
<h2 id="非聚簇索引"><a href="#非聚簇索引" class="headerlink" title="非聚簇索引"></a>非聚簇索引</h2><p>InnoDB 中普通索引是非聚簇索引，叶子节点存储主键值。通过普通索引查找记录会先由普通索引找到主键，然后通过主键索引找到行记录。</p>
<p>MyISAM 中主索引和次索引一样，都保存指向物理地址的指针。</p>
<h1 id="从逻辑角度"><a href="#从逻辑角度" class="headerlink" title="从逻辑角度"></a>从逻辑角度</h1><ul>
<li>普通索引</li>
<li>唯一索引</li>
<li>主键索引</li>
<li>组合索引</li>
<li>外键索引</li>
<li>空间索引</li>
</ul>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li><a href="https://blog.csdn.net/xiangwanpeng/article/details/54310955" target="_blank" rel="noopener">数据库索引是怎样工作的？</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/23624390" target="_blank" rel="noopener">深入浅出数据库索引原理</a></li>
<li><a href="http://www.uml.org.cn/sjjm/201107145.asp" target="_blank" rel="noopener">MySQl 索引背后的数据结构及算法原理</a></li>
<li><a href="http://tencentdba.com/blog/innodb%E9%A1%B5%E9%9D%A2%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84-1/" target="_blank" rel="noopener">innodb页面存储结构-1</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/08/14/MySQL-%E7%B4%A2%E5%BC%95/" data-id="ckd5czhhq000znnnrblvo3zhu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-linux-常见问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/18/linux-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2019-07-18T00:28:18.000Z" itemprop="datePublished">2019-07-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/18/linux-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">linux 常见问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="进程相关"><a href="#进程相关" class="headerlink" title="进程相关"></a>进程相关</h1><h2 id="如何让一个进程在后台运行"><a href="#如何让一个进程在后台运行" class="headerlink" title="如何让一个进程在后台运行"></a>如何让一个进程在后台运行</h2><ul>
<li>使用 &amp;<ul>
<li>输入命令 <code>./a.out &amp;</code> 会在终端显示进程号，结果输出到终端</li>
<li>键入 Ctrl + C，发出 SIGINT 信号，程序会继续运行</li>
<li>如果关闭窗口（SIGHUP），进程也会关闭</li>
</ul>
</li>
<li>使用 nohup<ul>
<li>结果默认会输出到 nohup.out</li>
<li>键入 Ctrl + C（SIGINT），程序直接关闭</li>
<li>如果关闭窗口（SIGHUP），进程不会关闭，可以通过 killall 关闭<br>一般会使用 nohup 配合 &amp; 来启动程序，同时免疫 SIGINT 和 SIGHUP 信号</li>
</ul>
</li>
</ul>
<h2 id="如何查看日志"><a href="#如何查看日志" class="headerlink" title="如何查看日志"></a>如何查看日志</h2><ul>
<li><code>tail error.log</code> 查看文件末尾</li>
<li><code>tail -f error.log</code> 实时输出最新写入的数据</li>
</ul>
<h2 id="查询线程数"><a href="#查询线程数" class="headerlink" title="查询线程数"></a>查询线程数</h2><ul>
<li><code>ps -elf|ec -l</code></li>
<li><code>pstree -p|wa -l</code></li>
</ul>
<h2 id="查最耗-cpu-的进程"><a href="#查最耗-cpu-的进程" class="headerlink" title="查最耗 cpu 的进程"></a>查最耗 cpu 的进程</h2><ul>
<li><code>ps H -eo pid,pcpu | sort -nk2 | tail</code></li>
<li><code>top -c</code> 键入 P （进程按照 CPU 使用率排序） </li>
</ul>
<h2 id="查最耗-cpu-的线程"><a href="#查最耗-cpu-的线程" class="headerlink" title="查最耗 cpu 的线程"></a>查最耗 cpu 的线程</h2><ul>
<li><code>top -Hp 10765(进程 ID)</code> 显示一个进程的线程运行信息列表。键入 P。</li>
</ul>
<h2 id="查看堆栈"><a href="#查看堆栈" class="headerlink" title="查看堆栈"></a>查看堆栈</h2><ul>
<li>首先将线程 PID 转化为 16 进制：<code>printf &quot;%x\n&quot; 10804(线程ID)</code></li>
<li>查看堆栈：<code>jstack 10765 | grep &#39;0x2a34&#39; -C5</code></li>
</ul>
<h2 id="查出进程号对应的服务名"><a href="#查出进程号对应的服务名" class="headerlink" title="查出进程号对应的服务名"></a>查出进程号对应的服务名</h2><ul>
<li><code>ps aux | fgrep pid</code></li>
<li><code>ll /proc/pid</code> 可以打印出全路径</li>
</ul>
<h2 id="查看某个端口的连接情况"><a href="#查看某个端口的连接情况" class="headerlink" title="查看某个端口的连接情况"></a>查看某个端口的连接情况</h2><ul>
<li><code>netstat -lap | fgrep 22022</code></li>
<li><code>/user/sbin/lsof -i:22022</code></li>
</ul>
<h1 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h1><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><ul>
<li>原理：逐行处理文件中的数据</li>
<li>语法 <code>awk &#39;pattern + {action}&#39;</code><ul>
<li>‘’ 是为了和 shell 命令区分开</li>
<li>{} 表示一个命令分组</li>
<li>pattern 是一个过滤器，正则使用 /pattern/</li>
<li>action 是处理动作，默认是 print</li>
<li>使用 # 作为注释</li>
</ul>
</li>
<li>内置变量<ul>
<li>NR 当前行数，从1 开始</li>
<li>NF 当前记录字段个数</li>
<li>$0 当前记录</li>
<li>$1 ~ $N 当前记录第 n 个字段</li>
</ul>
</li>
<li>实例：<ul>
<li><code>cat hello.txt | awk &#39;NR==3, NR==5{print $1,$NF}&#39;</code> 显示 hello.txt 中的第三行至第五行的第一列与最后一列</li>
<li><code>cat hello.txt | awk &#39;length($0)&gt;80{print NR}&#39;</code> 显示 hello.txt 中，长度大于 100 的行号</li>
</ul>
</li>
</ul>
<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><ul>
<li>参数：<ul>
<li>-n sed 会在处理一行文本前，将待处理的文本打印出来，-n 参数关闭了这个功能</li>
<li>p 命令表示打印当前行</li>
</ul>
</li>
<li>基本命令<ul>
<li>a\ 在匹配行后面加入一条文本</li>
<li>i\ 在匹配行前面加入一行文本</li>
<li>c\ 将匹配行替换为目的行</li>
<li>d 将匹配行删除</li>
<li>s 将匹配行替换 <code>s/被替换的串/替换成这个串/g</code> g 代表全部替换</li>
</ul>
</li>
<li><code>sed -n &#39;2,$&#39;p hello.txt</code> 打印第二行到最后一行，$ 表示最后一行</li>
<li><code>sed -n &#39;/100/&#39;p hello.txt</code> 打印 hello.txt 中 正则匹配 100 的行</li>
<li><code>sed &#39;/100/&#39;i\ &quot;new line&quot; hello.txt</code></li>
</ul>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><h2 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h2><p>sort 和 uniq 经常配对使用。<br>sort 可以使用 -t 指定分隔符，使用 -k 指定要排序的列。</p>
<p>下面这个命令输出 nginx 日志的 ip 和每个 ip 的 pv，pv 最高的前10</p>
<pre class="line-numbers language-shell"><code class="language-shell">#2019-06-26T10:01:57+08:00|nginx001.server.ops.pro.dc|100.116.222.80|10.31.150.232:41021|0.014|0.011|0.000|200|200|273|-|/visit|sign=91CD1988CE8B313B8A0454A4BBE930DF|-|-|http|POST|112.4.238.213

awk -F"|" '{print $3}' access.log | sort | uniq -c | sort -nk1 -r | head -n10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="192-统计词频"><a href="#192-统计词频" class="headerlink" title="192. 统计词频"></a><a href="https://leetcode-cn.com/problems/word-frequency/" target="_blank" rel="noopener">192. 统计词频</a></h2><pre class="line-numbers language-shell"><code class="language-shell">cat words.txt | awk '{for(i=1;i<=NF;i++){arr[$i]++;}};END{for(w in arr){print arr[w],w;}}' | sort -rn|awk '{print $2,$1}'

cat words.txt | xargs -n1 | sort | uniq -c | sort -rn | awk '{print $2,$1}'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="磁盘相关"><a href="#磁盘相关" class="headerlink" title="磁盘相关"></a>磁盘相关</h1><h2 id="du-和-df"><a href="#du-和-df" class="headerlink" title="du 和 df"></a>du 和 df</h2><ul>
<li>du 通过搜索文件来计算每个文件的大小然后累加得到值。</li>
<li>df 通过文件系统来获取空间大小信息。</li>
</ul>
<p>如果用户删除了一个正在运行的应用程序所打开的某个目录下的文件。du 返回的值是删除了文件后的大小，df 返回的值，不显示减去该文件后的大小。</p>
<p>如果要删除某个日志：<code>echo &quot;&quot; &gt; access.log</code></p>
<h2 id="如何查看已删除文件"><a href="#如何查看已删除文件" class="headerlink" title="如何查看已删除文件"></a>如何查看已删除文件</h2><ul>
<li><code>lsof | grep deleted</code></li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651961108&idx=1&sn=3fccc94c4307fa2306bae680d8570c18&chksm=bd2d02c88a5a8bde8944e383a3fb9b6d24461cf07ed5a65dbf774a2382bf1f318aca18df5572&scene=21#wechat_redirect" target="_blank" rel="noopener">一分钟了解nohup和&amp;的功效</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=205216499&idx=1&sn=656b5403f3be045772bb539c873e6bd0&scene=21#wechat_redirect" target="_blank" rel="noopener">linux下追查线上问题常用命令</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651963003&idx=1&sn=fdf4c9a54dbc03568c5d5ad7a0c2112b&chksm=bd2d0ba78a5a82b132d5968a147f13ccd4c81cd1da4fc0a9de1228f505191b2357b17488e00d&scene=21#wechat_redirect" target="_blank" rel="noopener">线上问题排查，这些命令你一定用得到！</a></li>
<li><a href="https://mp.weixin.qq.com/s/9RbTGQ4k4s92mrSf2xJ5TQ" target="_blank" rel="noopener">Linux上，最常用的一批命令解析（10年精选）</a></li>
<li><a href="https://mp.weixin.qq.com/s/EI63RZZcPzJT4c0zl8XQSA" target="_blank" rel="noopener">LeetCode上稀缺的四道shell编程题解析</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/07/18/linux-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" data-id="ckd5czhi6002dnnnre1gredyk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A2%98%E7%9B%AE/" rel="tag">题目</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-PHP中判断一个参数存不存在的问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/08/PHP%E4%B8%AD%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E5%AD%98%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2019-07-08T04:14:22.000Z" itemprop="datePublished">2019-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%97%AE%E9%A2%98/">问题</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/08/PHP%E4%B8%AD%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E5%AD%98%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98/">PHP中判断一个参数存不存在的问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近做的需求要求开发一个接口，参数是可选的。比如说有个设备号 equipment_id，这个参数是可选的，可以不传，也可以传入但是内容为空，并且如果穿了参数就要验签。</p>
<h2 id="isset-和-empty"><a href="#isset-和-empty" class="headerlink" title="isset() 和 empty()"></a>isset() 和 empty()</h2><ul>
<li>isset() 函数用来检查一个变量是否存在并且不是 <strong>null</strong>。</li>
<li>empty() 函数检查一个变量是否为空。</li>
</ul>
<p>无论使用 isset() 还是 empty() 都无法区别，传入<code>&quot;equipment_id&quot;:&quot;&quot;</code>,与不传 equipment_id。</p>
<p>所以去查了下 PHP 手册，发现了这个函数，array_key_exists()，作用是检查数组里是否有指定的键名或索引，这个函数正好可以解决这个问题，如果是传了参数 <code>array_key_exists(&#39;equipment_id&#39;, $allParam)</code> 返回 true，如果是没有传参，则返回 false。</p>
<p>最用后了一个这样的函数来判断，感觉挺奇葩的，这大概就是弱类型语言的一个缺陷吧。。</p>
<p>最后巩固一下 PHP 中空的其中情况。</p>
<h3 id="PHP-空的七种情况"><a href="#PHP-空的七种情况" class="headerlink" title="PHP 空的七种情况"></a>PHP 空的七种情况</h3><ul>
<li>“” (空字符串)</li>
<li>0 (作为整数的0)</li>
<li>0.0 (作为浮点数的0)</li>
<li>“0” (作为字符串的0)</li>
<li>NULL</li>
<li>FALSE</li>
<li>array() (一个空数组)</li>
<li>$var (一个声明了，但是没有值的变量)</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/07/08/PHP%E4%B8%AD%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E5%AD%98%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98/" data-id="ckd5czhhu001fnnnr5ufng10j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux-命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/22/Linux-%E5%91%BD%E4%BB%A4/" class="article-date">
  <time datetime="2019-06-22T07:31:25.000Z" itemprop="datePublished">2019-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/22/Linux-%E5%91%BD%E4%BB%A4/">linux 命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Linux-命令"><a href="#Linux-命令" class="headerlink" title="Linux-命令"></a>Linux-命令</h1><ul>
<li>文件目录操作：pwd，cd，ls，file，cp，mv，mkdir，rm，ln</li>
<li>使用命令：type，help，man，apropos，info，whatis，alias</li>
<li>权限：id，chmod，umask，sudo，chown，chgrp，passwd，usermod，useradd，groupadd，userdel</li>
<li>进程管理：w，top，free，ps，kill，pkill，pstree，killall，jobs，bg，fg，shutdown</li>
<li>环境变量：set，printenv，export</li>
<li>存储媒介：mount，umount，fsck，fdisk，mkfs，dd，genisoimage，wodim，md5sum</li>
<li>网络系统：ifconfig，route，ping，netstat，ss，curl，telnet，traceroute，ftp，wget，ssh</li>
<li>文件系统：file，mount，umount，fsck，df，du，tar，gzip，scp，rsync</li>
<li>系统关机重启：shutdown，reboot</li>
<li>常用工具：ssh，clear，history，who，screen</li>
<li>文件查找：locate，find，whereis，which</li>
<li>文件内容查看：head，tail，less，more</li>
<li>文本处理：cat，sort，uniq，cut，paste，join，comm，diff，patch，tr</li>
<li>文本搜素：grep，sed，awk</li>
<li>格式化输出：nl，fold，fmt，pr，printf，groff</li>
<li>软件包管理：</li>
<li>编译程序：</li>
</ul>
<h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p><code>crontab [-u user] file crontab [-u user] [ -e | -l | -r ]</code></p>
<h3 id="crontab-的文件格式"><a href="#crontab-的文件格式" class="headerlink" title="crontab 的文件格式"></a>crontab 的文件格式</h3><p>分 时 日 月 周 要运行的命令</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p><code>* * * * * myCommmand</code> 每分钟执行<br><code>3,15 * * * * myCommand</code> 每小时的第3和第15分钟执行<br><code>3,15 8-11 */2  *  * myCommand</code> 每隔两天的上午8点到11点的第3和第15分钟执行<br><code>3,15 8-11 * * 1 myCommand</code> 每周一一上午8点到11点的第3和第15分钟执行<br><code>* */1 * * * myCommand</code> 每一小时执行 </p>
<h2 id="文件目录操作"><a href="#文件目录操作" class="headerlink" title="文件目录操作"></a>文件目录操作</h2><h3 id="pwd-打印出当前工作目录名"><a href="#pwd-打印出当前工作目录名" class="headerlink" title="pwd 打印出当前工作目录名"></a>pwd 打印出当前工作目录名</h3><ul>
<li>-P 当目录是链接时，显示出实际路径</li>
</ul>
<h3 id="cd-切换目录"><a href="#cd-切换目录" class="headerlink" title="cd 切换目录"></a>cd 切换目录</h3><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>/</td>
<td>进入根目录</td>
</tr>
<tr>
<td>~</td>
<td>或者不填 进入当前用户主目录</td>
</tr>
<tr>
<td>-</td>
<td>返回之前的目录</td>
</tr>
</tbody></table>
<h3 id="ls-列出目录下的内容"><a href="#ls-列出目录下的内容" class="headerlink" title="ls 列出目录下的内容"></a>ls 列出目录下的内容</h3><h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>-all 列出目录下的所有文件，包括以 .  开头的隐藏文件</td>
</tr>
<tr>
<td>-d</td>
<td>通常，如果指定了目录名，ls 命令会列出这个目录中的内容，而不是目录本身。 把这个选项与 -l 选项结合使用，可以看到所指定目录的详细信息，而不是目录中的内容。</td>
</tr>
<tr>
<td>-h</td>
<td>显示文件详细信息时，以人们可读的格式，而不是以字节数来显示文件的大小。</td>
</tr>
<tr>
<td>-r</td>
<td>以相反的顺序来显示结果。通常，ls 命令的输出结果按照字母升序排列</td>
</tr>
<tr>
<td>-i</td>
<td>打印出每个文件后的 inode 号</td>
</tr>
<tr>
<td>-t</td>
<td>以文件修改时间排序</td>
</tr>
<tr>
<td>-l</td>
<td>显示文件详细信息</td>
</tr>
<tr>
<td>-S</td>
<td>命令输出结果按照文件大小来排序。</td>
</tr>
<tr>
<td>-R</td>
<td>同事列出所有子目录层</td>
</tr>
</tbody></table>
<h3 id="file-确定文件类型"><a href="#file-确定文件类型" class="headerlink" title="file 确定文件类型"></a>file 确定文件类型</h3><p>当调用 file 命令后，file 命令会打印出文件内容的简单描述</p>
<h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p><code>file filename</code></p>
<h3 id="mkdir-创建文件夹"><a href="#mkdir-创建文件夹" class="headerlink" title="mkdir 创建文件夹"></a>mkdir 创建文件夹</h3><h4 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-m</td>
<td>–mode=模式，设定权限&lt;模式&gt; (类似 chmod)，而不是 rwxrwxrwx 减 umask</td>
</tr>
<tr>
<td>-p</td>
<td>–parents  可以是一个路径名称。此时若路径中的某些目录尚不存在,加上此选项后,系统将自动建立好那些尚不存在的目录,即一次可以建立多个目录;</td>
</tr>
<tr>
<td>-v</td>
<td>–verbose  每次创建新目录都显示信息，–help 显示此帮助信息并退出，–version 输出版本信息并退出</td>
</tr>
</tbody></table>
<h3 id="rm-删除文件或目录"><a href="#rm-删除文件或目录" class="headerlink" title="rm 删除文件或目录"></a>rm 删除文件或目录</h3><h4 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-f –force</td>
<td>忽略不存在的文件，不给出提示</td>
</tr>
<tr>
<td>-i –interactive</td>
<td>进行交互式删除</td>
</tr>
<tr>
<td>-r -R –recursive</td>
<td>递归删除子目录</td>
</tr>
<tr>
<td>-v –verbose</td>
<td>详细显示进行的步骤，–help 显示此帮助信息并退出，–version 输出版本信息并退出</td>
</tr>
</tbody></table>
<h3 id="rmdir-删除空目录"><a href="#rmdir-删除空目录" class="headerlink" title="rmdir 删除空目录"></a>rmdir 删除空目录</h3><h3 id="mv-移动-重命名文件和目录"><a href="#mv-移动-重命名文件和目录" class="headerlink" title="mv 移动/重命名文件和目录"></a>mv 移动/重命名文件和目录</h3><h4 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h4><p><code>mv [选项] 源文件或目录 目标文件或目录</code></p>
<h4 id="参数-4"><a href="#参数-4" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>若需覆盖文件，则覆盖前先备份</td>
</tr>
<tr>
<td>-f</td>
<td>强制，如果目标文件已经存在，不会询问是否覆盖</td>
</tr>
<tr>
<td>-i</td>
<td>若目标文件已经存在，就会询问是否覆盖</td>
</tr>
<tr>
<td>-u</td>
<td>若目标文件已经存在，且 source 比较新，才会更新(update)</td>
</tr>
<tr>
<td>-t</td>
<td>–target-directory=DIRECTORY move all SOURCE arguments into DIRECTORY，即指定mv的目标目录，该选项适用于移动多个源文件到一个目录的情况，此时目标目录在前，源文件在后。</td>
</tr>
</tbody></table>
<h3 id="cp-复制文件或者目录"><a href="#cp-复制文件或者目录" class="headerlink" title="cp 复制文件或者目录"></a>cp 复制文件或者目录</h3><h4 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h4><p><code>cp [选项] [-t] 源 目的</code></p>
<h4 id="参数-5"><a href="#参数-5" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>为每个已存在的目标文件创建备份</td>
</tr>
<tr>
<td>-f</td>
<td>如果目标文件无法打开则将其移除并重试</td>
</tr>
<tr>
<td>-r</td>
<td>复制目录及目录内的所有项目</td>
</tr>
<tr>
<td>-n</td>
<td>不要覆盖已存在的文件</td>
</tr>
</tbody></table>
<h3 id="touch-修改文件的时间戳，或者新建一个不存在的文件"><a href="#touch-修改文件的时间戳，或者新建一个不存在的文件" class="headerlink" title="touch 修改文件的时间戳，或者新建一个不存在的文件"></a>touch 修改文件的时间戳，或者新建一个不存在的文件</h3><h4 id="参数-6"><a href="#参数-6" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>改变档案的读取时间记录</td>
</tr>
<tr>
<td>-m</td>
<td>改变档案的修改时间记录</td>
</tr>
<tr>
<td>-c</td>
<td>加入母的档案不存在，不建立任何档案，与 –no-create 的效果一样</td>
</tr>
<tr>
<td>-d -t</td>
<td>使用指定的日期时间，而非现在时间 touch -t 201911142234.50 log.log <code>[[CC]YY]MMDDhhmm[.SS]</code>   这里，CC为年数中的前两位，即”世纪数”；YY为年数的后两位，即某世纪中的年数．如果不给出CC的值，则touch   将把年数CCYY限定在1969–2068之内．MM为月数，DD为天将把年数CCYY限定在1969–2068之内．MM为月数，DD为天数，hh 为小时数(几点)，mm为分钟数，SS为秒数．此处秒的设定范围是0–61，这样可以处理闰秒．这些数字组成的时间是环境变量TZ指定的时区中的一个时 间．由于系统的限制，早于1970年1月1日的时间是错误的</td>
</tr>
<tr>
<td>-r</td>
<td>使用参考文档的时间 touch -r log.log log2019.log</td>
</tr>
</tbody></table>
<h3 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h3><p>给命令传递参数的一个过滤器，一般与管道一起使用。<br>在使用 find命令的-exec选项处理匹配到的文件时， find命令将所有匹配到的文件一起传递给exec执行。但有些系统对能够传递给exec的命令长度有限制，这样在find命令运行几分钟之后，就会出现溢出错误。错误信息通常是“参数列太长”或“参数列溢出”。这就是xargs命令的用处所在，特别是与find命令一起使用。  </p>
<p>find命令把匹配到的文件传递给xargs命令，而xargs命令每次只获取一部分文件而不是全部，不像-exec选项那样。这样它可以先处理最先获取的一部分文件，然后是下一批，并如此继续下去。  </p>
<h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><ul>
<li>find / -name “core” -print | xargs echo “” &gt;/tmp/core.log 在整个系统中查找内存信息转储文件(core dump) ，然后把结果保存到/tmp/core.log 文件中</li>
<li>find . -type f -print | xargs grep “hostname” 用grep命令在所有的普通文件中搜索hostname这个词</li>
</ul>
<h2 id="使用命令"><a href="#使用命令" class="headerlink" title="使用命令"></a>使用命令</h2><p>命令可以是以下四种形式之一</p>
<ol>
<li>是一个可执行程序</li>
<li>是一个内建于 shell 自身的命令</li>
<li>是一个 shell 函数</li>
<li>是一个命令别名</li>
</ol>
<h3 id="type-显示命令的类型"><a href="#type-显示命令的类型" class="headerlink" title="type 显示命令的类型"></a>type 显示命令的类型</h3><h4 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h4><p><code>type command</code></p>
<h3 id="help-得到-shell-内建命令的帮助文档"><a href="#help-得到-shell-内建命令的帮助文档" class="headerlink" title="help 得到 shell 内建命令的帮助文档"></a>help 得到 shell 内建命令的帮助文档</h3><p>bash 有一个内建的帮助工具，可供每一个 shell <strong>内建命令</strong> 使用。</p>
<h3 id="–help-显示用法信息"><a href="#–help-显示用法信息" class="headerlink" title="–help 显示用法信息"></a>–help 显示用法信息</h3><p>许多 <strong>可执行程序</strong> 支持一个 –help 选项，这个选项是显示命令所支持的语法和选项说明。</p>
<h3 id="man-显示程序手册页"><a href="#man-显示程序手册页" class="headerlink" title="man 显示程序手册页"></a>man 显示程序手册页</h3><p>许多希望被命令行使用的 <strong>可执行程序</strong>，提供了一个正式的文档，叫做手册或手册页(man page)。一个特殊的叫做 man 的分页程序，可用来浏览他们。</p>
<h3 id="apropos-显示适当的命令"><a href="#apropos-显示适当的命令" class="headerlink" title="apropos 显示适当的命令"></a>apropos 显示适当的命令</h3><p>也有可能搜索参考手册列表，基于某个关键字的匹配项。</p>
<p>输出结果每行的第一个字段是手册页的名字，第二个字段展示章节。注意，man 命令加上”-k”选项， 和 apropos 完成一样的功能。</p>
<h3 id="whatis-显示非常简洁的命令说明"><a href="#whatis-显示非常简洁的命令说明" class="headerlink" title="whatis 显示非常简洁的命令说明"></a>whatis 显示非常简洁的命令说明</h3><p>whatis 程序显示匹配特定关键字的手册页的名字和一行命令说明：</p>
<h3 id="info-显示程序-Info-条目"><a href="#info-显示程序-Info-条目" class="headerlink" title="info 显示程序 Info 条目"></a>info 显示程序 Info 条目</h3><p>GNU 项目提供了一个命令程序手册页的替代物，称为”info”。info 内容可通过 info 阅读器 程序读取。info 页是超级链接形式的，和网页很相似。</p>
<h3 id="alias-创建命令别名"><a href="#alias-创建命令别名" class="headerlink" title="alias 创建命令别名"></a>alias 创建命令别名</h3><ul>
<li><code>alias</code> 查看别名</li>
<li><code>alias name=&#39;command&#39;</code> 创建别名 </li>
<li><code>unalias name</code> 删除别名</li>
</ul>
<h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><p>I/O 重定向允许我们更改输出地点和输入来源。一般地，输出送到屏幕，输入来自键盘， 但是通过 I/O 重定向，我们可以做出改变,将标准输出重定向到除屏幕以外的另一个文件。</p>
<h3 id="gt-标准输出重定向"><a href="#gt-标准输出重定向" class="headerlink" title="&gt; 标准输出重定向"></a>&gt; 标准输出重定向</h3><p><code>ls &gt; output.txt</code> 结果输出到了 output.txt，使用‘&gt;’重定向符，目标文件总是从头开始被重写，如果需要清空一个文件内容，可以<code>&gt; output.txt</code></p>
<h3 id="gt-gt-追加输出结果到目标文件"><a href="#gt-gt-追加输出结果到目标文件" class="headerlink" title="&gt;&gt; 追加输出结果到目标文件"></a>&gt;&gt; 追加输出结果到目标文件</h3><h3 id="2-gt-标准错误重定向"><a href="#2-gt-标准错误重定向" class="headerlink" title="2&gt; 标准错误重定向"></a>2&gt; 标准错误重定向</h3><p>标准错误重定向没有专用的重定向操作符。为了重定向标准错误，我们必须参考其文件描述符。 一个程序可以在几个编号的文件流中的任一个上产生输出。虽然我们已经将这些文件流的前 三个称作标准输入、输出和错误，shell 内部分别将其称为文件描述符0、1和2。</p>
<h3 id="重定向标准输出和错误到同一个文件"><a href="#重定向标准输出和错误到同一个文件" class="headerlink" title="重定向标准输出和错误到同一个文件"></a>重定向标准输出和错误到同一个文件</h3><ul>
<li>方法一：<code>ls -l /bin/usr &gt; ls-output.txt 2&gt;&amp;1</code>使用这种方法，我们完成两个重定向。首先重定向标准输出到文件 ls-output.txt，然后 重定向文件描述符2（标准错误）到文件描述符1（标准输出）使用表示法2&gt;&amp;1。注意重定向的顺序安排非常重要。标准错误的重定向必须总是出现在标准输出 重定向之后，要不然它不起作用。</li>
<li>方法二：<code>ls -l /bin/usr &amp;&gt; ls-output.txt</code></li>
</ul>
<h3 id="处理不需要的输出"><a href="#处理不需要的输出" class="headerlink" title="处理不需要的输出"></a>处理不需要的输出</h3><p>系统提供了一个叫做”/dev/null”的特殊文件， 这个文件是系统设备，叫做位存储桶，它可以接受输入，并且对输入不做任何处理。<code>ls -l /bin/usr 2&gt; /dev/null</code></p>
<h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><p>命令从标准输入读取数据并输送到标准输出的能力被一个称为管道线的 shell 特性所利用。 使用管道操作符”|”（竖杠）</p>
<ul>
<li><code>ls -l /usr/bin | less</code> 使用 less 来显示输出</li>
</ul>
<h3 id="tee-从-Stdin-读取数据，并同时输出到-Stdout-和文件"><a href="#tee-从-Stdin-读取数据，并同时输出到-Stdout-和文件" class="headerlink" title="tee 从 Stdin 读取数据，并同时输出到 Stdout 和文件"></a>tee 从 Stdin 读取数据，并同时输出到 Stdout 和文件</h3><p>Linux 提供了一个叫做 tee 的命令，这个命令制造了 一个”tee”，安装到我们的管道上。tee 程序从标准输入读入数据，并且同时复制数据 到标准输出（允许数据继续随着管道线流动）和一个或多个文件。当在某个中间处理 阶段来捕捉一个管道线的内容时很有用</p>
<ul>
<li><code>ls /usr/bin | tee ls.txt | grep zip</code> 在 grep 过滤管道线的内容之前，来捕捉整个目录列表到文件 ls.txt</li>
</ul>
<h2 id="展开"><a href="#展开" class="headerlink" title="展开"></a>展开</h2><h3 id="echo-它将它的文本参数打印到标准输出中"><a href="#echo-它将它的文本参数打印到标准输出中" class="headerlink" title="echo 它将它的文本参数打印到标准输出中"></a>echo 它将它的文本参数打印到标准输出中</h3><ul>
<li><code>echo this is a test</code> 输出 this is a test</li>
</ul>
<h3 id="路径名展开"><a href="#路径名展开" class="headerlink" title="路径名展开"></a>路径名展开</h3><p>通配符所依赖的工作机制叫做路径名展开。</p>
<ul>
<li><code>echo D*</code> 显示当前目录下以 D 开头的文件</li>
<li><code>echo /usr/*/share</code></li>
<li>路径名展开不会显示隐藏文件，使用 <code>echo .*</code> 会显示出父目录，使用 <code>.[!.]?*</code> 可以展开成所有以圆点开头，第二个字符不包含圆点，再包含至少一个字符， 并且这个字符之后紧接着任意多个字符的文件名。</li>
</ul>
<h3 id="波浪线展开"><a href="#波浪线展开" class="headerlink" title="波浪线展开"></a>波浪线展开</h3><p>当它用在 一个单词的开头时，它会展开成指定用户的家目录名，如果没有指定用户名，则展开成当前用户的家目录</p>
<ul>
<li><code>echo ~</code> 显示 /home/me</li>
<li><code>echo ~foo</code> 显示 /home/foo</li>
</ul>
<h3 id="算术表达式展开"><a href="#算术表达式展开" class="headerlink" title="算术表达式展开"></a>算术表达式展开</h3><p>格式：$((expression))  只支持整数</p>
<ul>
<li><code>echo $((2 + 2))</code> </li>
</ul>
<h3 id="花括号展开"><a href="#花括号展开" class="headerlink" title="花括号展开"></a>花括号展开</h3><p>花括号展开模式可能包含一个开头部分叫做报头，一个结尾部分叫做附言。花括号表达式本身可 能包含一个由逗号分开的字符串列表，或者一个整数区间，或者单个的字符的区间。这种模式不能 嵌入空白字符。</p>
<ul>
<li><code>echo Front-{A,B,C}-Back</code> Front-A-Back Front-B-Back Front-C-Back</li>
<li><code>echo {1..5}</code> 1 2 3 4 5</li>
<li><code>echo {Z..A}</code> Z Y X W V U T S R Q P O N M L K J I H G F E D C B A</li>
<li>嵌套 <code>echo a{A{1,2},B{3,4}}b</code> aA1b aA2b aB3b aB4b</li>
</ul>
<h3 id="参数展开"><a href="#参数展开" class="headerlink" title="参数展开"></a>参数展开</h3><ul>
<li><code>echo $USER</code> 输出用户名</li>
<li>可以用 <code>printenv | less</code> 来查看有效的变量名</li>
</ul>
<h3 id="命令替换"><a href="#命令替换" class="headerlink" title="命令替换"></a>命令替换</h3><p>命令替换允许我们把一个命令的输出作为一个展开模式来使用：</p>
<ul>
<li><code>ls -l $(which cp)</code> 把 which cp 的执行结果作为一个参数传递给 ls 命令，因此可以在不知道 cp 命令 完整路径名的情况下得到它的文件属性列表。</li>
</ul>
<h3 id="双引号"><a href="#双引号" class="headerlink" title="双引号"></a>双引号</h3><p>如果你把文本放在双引号中， shell 使用的特殊字符，都失去它们的特殊含义，被当作普通字符来看待。 有几个例外： $，\ (反斜杠），和 `（倒引号）。这意味着单词分割、路径名展开、 波浪线展开和花括号展开都将失效，然而参数展开、算术展开和命令替换 仍然执行。</p>
<ul>
<li>ls -l “two words.txt” 当文件名含有空格时使用双引号</li>
</ul>
<h3 id="单引号"><a href="#单引号" class="headerlink" title="单引号"></a>单引号</h3><p>禁止所有的展开</p>
<h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><h3 id="id-显示用户身份号"><a href="#id-显示用户身份号" class="headerlink" title="id 显示用户身份号"></a>id 显示用户身份号</h3><h3 id="chmod-改变文件或目录的访问权限"><a href="#chmod-改变文件或目录的访问权限" class="headerlink" title="chmod 改变文件或目录的访问权限"></a>chmod 改变文件或目录的访问权限</h3><h4 id="参数-7"><a href="#参数-7" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-c</td>
<td>当发生改变时，报告处理信息</td>
</tr>
<tr>
<td>-f</td>
<td>错误信息不输出</td>
</tr>
<tr>
<td>-R</td>
<td>处理指定目录以及其子目录下的所有文件</td>
</tr>
<tr>
<td>-v</td>
<td>运行时显示详细处理信息</td>
</tr>
</tbody></table>
<h4 id="权限范围"><a href="#权限范围" class="headerlink" title="权限范围"></a>权限范围</h4><table>
<thead>
<tr>
<th>a</th>
<th>b</th>
</tr>
</thead>
<tbody><tr>
<td>u</td>
<td>目录或者文件的当前的用户</td>
</tr>
<tr>
<td>g</td>
<td>目录或者文件的当前的群组</td>
</tr>
<tr>
<td>o</td>
<td>除了目录或者文件的当前用户或群组之外的用户或者群组</td>
</tr>
<tr>
<td>a</td>
<td>所有的用户及群组</td>
</tr>
</tbody></table>
<h4 id="权限代号"><a href="#权限代号" class="headerlink" title="权限代号"></a>权限代号</h4><table>
<thead>
<tr>
<th>代号</th>
<th>权限</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>读权限，用数字4表示</td>
</tr>
<tr>
<td>w</td>
<td>写权限，用数字2表示</td>
</tr>
<tr>
<td>x</td>
<td>执行权限，用数字1表示</td>
</tr>
<tr>
<td>-</td>
<td>删除权限，用数字0表示</td>
</tr>
<tr>
<td>s</td>
<td>特殊权限</td>
</tr>
</tbody></table>
<h4 id="格式-4"><a href="#格式-4" class="headerlink" title="格式"></a>格式</h4><ol>
<li>文字设定法：<code>chmod ［who］ ［+ | - | =］ ［mode］ 文件名</code> chmod a+x a.txt</li>
<li>数字设定法：<code>chmod ［mode］ 文件名</code> r=4，w=2，x=1</li>
</ol>
<h3 id="chgrp-变更文件与目录所属群组"><a href="#chgrp-变更文件与目录所属群组" class="headerlink" title="chgrp 变更文件与目录所属群组"></a>chgrp 变更文件与目录所属群组</h3><h4 id="参数同-chmod"><a href="#参数同-chmod" class="headerlink" title="参数同 chmod"></a>参数同 chmod</h4><ul>
<li>–reference=&lt;文件或者目录&gt; 根据指定文件改变文件的群组属性</li>
</ul>
<h4 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>chgrp -R 100 test6</code> 通过群组识别码改变文件群组属性，100为users群组的识别码，具体群组和群组识别码可以去/etc/group文件中查看</li>
</ul>
<h3 id="chown-改变文件的拥有者和群组"><a href="#chown-改变文件的拥有者和群组" class="headerlink" title="chown 改变文件的拥有者和群组"></a>chown 改变文件的拥有者和群组</h3><h4 id="格式-5"><a href="#格式-5" class="headerlink" title="格式"></a>格式</h4><p><code>chown [选项] [所有者][:[组]] 文件</code></p>
<h4 id="必要参数"><a href="#必要参数" class="headerlink" title="必要参数"></a>必要参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-c</td>
<td>显示更改的部分的信息</td>
</tr>
<tr>
<td>-f</td>
<td>忽略错误信息</td>
</tr>
<tr>
<td>-h</td>
<td>修复符号链接</td>
</tr>
<tr>
<td>-R</td>
<td>处理指定目录以及其子目录下的所有文件</td>
</tr>
<tr>
<td>-v</td>
<td>显示详细的处理信息</td>
</tr>
<tr>
<td>-deference</td>
<td>作用于符号链接的指向，而不是链接文件本身</td>
</tr>
</tbody></table>
<h4 id="选择参数"><a href="#选择参数" class="headerlink" title="选择参数"></a>选择参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>–reference=&lt;目录或文件&gt;</td>
<td>把指定的目录/文件作为参考，把操作的文件/目录设置成参考文件/目录相同拥有者和群组</td>
</tr>
<tr>
<td>–from=&lt;当前用户：当前群组&gt;</td>
<td>只有当前用户和群组跟指定的用户和群组相同时才进行改变</td>
</tr>
<tr>
<td>–help</td>
<td>显示帮助信息</td>
</tr>
<tr>
<td>–version</td>
<td>显示版本信息</td>
</tr>
</tbody></table>
<h4 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>chown mail:mail log2012.log</code> 改变拥有者和群组</li>
<li><code>chown root: log2012.log</code> 改变文件拥有者和群组</li>
<li><code>chown :mail log2012.log</code> 改变文件群组</li>
</ul>
<h3 id="umask-设置默认权限"><a href="#umask-设置默认权限" class="headerlink" title="umask 设置默认权限"></a>umask 设置默认权限</h3><p>当创建一个文件时，umask 命令控制着文件的默认权限。umask 命令使用八进制表示法来表达 从文件模式属性中删除一个位掩码。</p>
<h3 id="su-以其他用户身份和组-ID-运行一个-shell"><a href="#su-以其他用户身份和组-ID-运行一个-shell" class="headerlink" title="su 以其他用户身份和组 ID 运行一个 shell"></a>su 以其他用户身份和组 ID 运行一个 shell</h3><p>输入 exit 能返回原来的 shell</p>
<h3 id="sudo-以另一个用户身份执行命令"><a href="#sudo-以另一个用户身份执行命令" class="headerlink" title="sudo 以另一个用户身份执行命令"></a>sudo 以另一个用户身份执行命令</h3><p>sudo 命令不要求超级用户的密码。使用 sudo 命令时，用户使用他/她自己的密码来认证。su 和 sudo 之间的一个重要区别是 sudo 不会重新启动一个 shell，也不会加载另一个 用户的 shell 运行环境。</p>
<h3 id="passwd-更改用户密码"><a href="#passwd-更改用户密码" class="headerlink" title="passwd 更改用户密码"></a>passwd 更改用户密码</h3><ul>
<li><code>passwd [user]</code></li>
</ul>
<h2 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h2><p>当系统启动的时候，内核先把一些它自己的活动初始化为进程，然后运行一个叫做 init 的程序。init， 依次地，再运行一系列的称为 init 脚本的 shell 脚本（位于/etc），它们可以启动所有的系统服务。 其中许多系统服务以守护（daemon）程序的形式实现，守护程序仅在后台运行，没有任何用户接口(User Interface)。 这样，即使我们没有登录系统，至少系统也在忙于执行一些例行事务。</p>
<p>在进程方案中，一个程序可以发动另一个程序被表述为一个父进程可以产生一个子进程。</p>
<p>内核维护每个进程的信息，以此来保持事情有序。例如，系统分配给每个进程一个数字，这个数字叫做 进程(process) ID 或 PID。PID 号按升序分配，init 进程的 PID 总是1。内核也对分配给每个进程的内存和就绪状态进行跟踪以便继续执行这个进程。 像文件一样，进程也有所有者和用户 ID，有效用户 ID，等等。</p>
<h2 id="top-显示当前系统正在执行的进程的相关信息"><a href="#top-显示当前系统正在执行的进程的相关信息" class="headerlink" title="top 显示当前系统正在执行的进程的相关信息"></a>top 显示当前系统正在执行的进程的相关信息</h2><ul>
<li>查询一般不带参数的，具体信息通过grep筛选</li>
<li>交互模式下键入M进程列表按内存使用大小降序排列，键入P进程列表按CPU使用大小降序排列</li>
<li>%id表示CPU空闲率，过低表示可能存在CPU存在瓶颈</li>
<li>%wa表示等待I/O的CPU时间百分比，过高则I/O存在瓶颈 &gt; 用iostat进一步分析<h3 id="输出信息"><a href="#输出信息" class="headerlink" title="输出信息"></a>输出信息</h3>各进程（任务）的状态监控，项目列信息说明如下：<br>信息|说明</li>
<li>—|—<br>PID | 进程描述符<br>USER | 进程所有者<br>PR | 进程优先级<br>NI | nice值。负值表示高优先级，正值表示低优先级<br>VIRT | 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES<br>RES | 常驻内存，单位kb。RES=CODE+DATA<br>SHR（SHARE） | 共享内存大小，单位kb<br>S（STAT） | 进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程<br>%CPU | CPU 使用率<br>%MEM | 进程使用的物理内存百分比<br>TIME+ | 进程使用的CPU时间总计，单位1/100秒<br>COMMAND | 进程名称（命令名/命令行）</li>
</ul>
<h3 id="amp-把一个进程放到后台执行"><a href="#amp-把一个进程放到后台执行" class="headerlink" title="&amp; 把一个进程放到后台执行"></a>&amp; 把一个进程放到后台执行</h3><ul>
<li><code>xlogo &amp;</code> 在程序命令之后加上 &amp; 字符，让他在后台运行</li>
</ul>
<h3 id="jobs-列出从终端中启动了的任务"><a href="#jobs-列出从终端中启动了的任务" class="headerlink" title="jobs 列出从终端中启动了的任务"></a>jobs 列出从终端中启动了的任务</h3><p>返回任务号和这个任务的命令</p>
<h3 id="停止一个进程"><a href="#停止一个进程" class="headerlink" title="停止一个进程"></a>停止一个进程</h3><p>输入 Ctrl+z 可以停止进程</p>
<h3 id="fg-恢复程序到前台运行"><a href="#fg-恢复程序到前台运行" class="headerlink" title="fg 恢复程序到前台运行"></a>fg 恢复程序到前台运行</h3><h3 id="bg-把程序移到后台"><a href="#bg-把程序移到后台" class="headerlink" title="bg 把程序移到后台"></a>bg 把程序移到后台</h3><ul>
<li><code>bg %1</code></li>
</ul>
<h3 id="free-显示-Linux-系统中空闲的内存情况"><a href="#free-显示-Linux-系统中空闲的内存情况" class="headerlink" title="free 显示 Linux 系统中空闲的内存情况"></a>free 显示 Linux 系统中空闲的内存情况</h3><h4 id="参数-8"><a href="#参数-8" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>以 Byte 为单位显示</td>
</tr>
<tr>
<td>-k</td>
<td>以 KB 为单位显示</td>
</tr>
<tr>
<td>-m</td>
<td>以 MB 为单位显示</td>
</tr>
<tr>
<td>-g</td>
<td>以 GB 为单位显示</td>
</tr>
<tr>
<td>-o</td>
<td>不显示缓冲区调节列</td>
</tr>
<tr>
<td>-s</td>
<td>持续观察内存使用状况</td>
</tr>
<tr>
<td>-t</td>
<td>显示内存总和列</td>
</tr>
<tr>
<td>-V</td>
<td>显示版本信息</td>
</tr>
</tbody></table>
<h4 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h4><table>
<thead>
<tr>
<th>输出</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>total</td>
<td>总计物理内存大小</td>
</tr>
<tr>
<td>used</td>
<td>已使用多大</td>
</tr>
<tr>
<td>free</td>
<td>可用有多少</td>
</tr>
<tr>
<td>shared</td>
<td>多个进程共享内存总额</td>
</tr>
<tr>
<td>buffers/cached</td>
<td>磁盘缓存的大小</td>
</tr>
</tbody></table>
<h2 id="ps-查看进程"><a href="#ps-查看进程" class="headerlink" title="ps 查看进程"></a>ps 查看进程</h2><h3 id="linux上进程有5种状态"><a href="#linux上进程有5种状态" class="headerlink" title="linux上进程有5种状态:"></a>linux上进程有5种状态:</h3><ol>
<li>运行(正在运行或在运行队列中等待) </li>
<li>中断(休眠中, 受阻, 在等待某个条件的形成或接受到信号) </li>
<li>不可中断(收到信号不唤醒和不可运行, 进程必须等待直到有中断发生) </li>
<li>僵死(进程已终止, 但进程描述符存在, 直到父进程调用wait4()系统调用后释放) </li>
<li>停止(进程收到SIGSTOP, SIGSTP, SIGTIN, SIGTOU信号后停止运行运行)</li>
</ol>
<h3 id="实例-4"><a href="#实例-4" class="headerlink" title="实例"></a>实例</h3><ol>
<li>显示所有进程信息 ps -A</li>
<li>显式指定用户信息 ps -u root</li>
<li>显示所有进程信息，连同命令行 ps -ef</li>
<li>显示属于每个用户的进程信息 ps aux</li>
<li>以完整格式显示所有进程 ps -ajx</li>
</ol>
<h2 id="pstree-输出一个树型结构的进程列表-processtree-，这个列表展示了进程间父-子关系。"><a href="#pstree-输出一个树型结构的进程列表-processtree-，这个列表展示了进程间父-子关系。" class="headerlink" title="pstree     输出一个树型结构的进程列表(processtree)，这个列表展示了进程间父/子关系。"></a>pstree     输出一个树型结构的进程列表(processtree)，这个列表展示了进程间父/子关系。</h2><h3 id="kill-给进程发送信号"><a href="#kill-给进程发送信号" class="headerlink" title="kill 给进程发送信号"></a>kill 给进程发送信号</h3><table>
<thead>
<tr>
<th>编号</th>
<th>名字</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>HUP</td>
<td>挂起</td>
</tr>
<tr>
<td>2</td>
<td>INT</td>
<td>中断</td>
</tr>
<tr>
<td>9</td>
<td>KILL</td>
<td>杀死</td>
</tr>
<tr>
<td>15</td>
<td>TERM</td>
<td>终止</td>
</tr>
<tr>
<td>18</td>
<td>CONT</td>
<td>继续</td>
</tr>
<tr>
<td>19</td>
<td>STOP</td>
<td>停止</td>
</tr>
</tbody></table>
<h4 id="格式-6"><a href="#格式-6" class="headerlink" title="格式"></a>格式</h4><p><code>kill [参数][进程号]</code></p>
<h4 id="实例-5"><a href="#实例-5" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>kill -9 1</code></li>
<li><code>kill -l</code> 得到完整信号列表</li>
</ul>
<h3 id="killall-给匹配特定程序或用户名的多个进程发送信号"><a href="#killall-给匹配特定程序或用户名的多个进程发送信号" class="headerlink" title="killall 给匹配特定程序或用户名的多个进程发送信号"></a>killall 给匹配特定程序或用户名的多个进程发送信号</h3><p>killall 杀死指定 <strong>名字</strong> 的进程（kill processes by name）。kill 命令可以杀死指定进程 <strong>PID</strong> 的进程。</p>
<h4 id="格式-7"><a href="#格式-7" class="headerlink" title="格式"></a>格式</h4><p><code>killall [-u user][-signal] name...</code></p>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>shell 在环境中存储了两种基本类型的数据，虽然 bash 几乎无法分辨这些数据的类型。 它们是环境变量和 shell 变量。</p>
<h3 id="set-显示-shell-或环境变量"><a href="#set-显示-shell-或环境变量" class="headerlink" title="set 显示 shell 或环境变量"></a>set 显示 shell 或环境变量</h3><h3 id="printenv-显示环境变量"><a href="#printenv-显示环境变量" class="headerlink" title="printenv 显示环境变量"></a>printenv 显示环境变量</h3><ul>
<li><code>printenv</code> 显示所有环境变量</li>
<li><code>printenv name</code> 显示特定变量的值</li>
</ul>
<h2 id="存储媒介"><a href="#存储媒介" class="headerlink" title="存储媒介"></a>存储媒介</h2><h3 id="mount-挂载一个文件系统"><a href="#mount-挂载一个文件系统" class="headerlink" title="mount 挂载一个文件系统"></a>mount 挂载一个文件系统</h3><h3 id="umount-卸载一个文件系统"><a href="#umount-卸载一个文件系统" class="headerlink" title="umount 卸载一个文件系统"></a>umount 卸载一个文件系统</h3><h3 id="fask-检查和修复一个文件系统"><a href="#fask-检查和修复一个文件系统" class="headerlink" title="fask 检查和修复一个文件系统"></a>fask 检查和修复一个文件系统</h3><h3 id="fdisk-分区表控制器"><a href="#fdisk-分区表控制器" class="headerlink" title="fdisk 分区表控制器"></a>fdisk 分区表控制器</h3><h3 id="mkfs-创建文件系统"><a href="#mkfs-创建文件系统" class="headerlink" title="mkfs 创建文件系统"></a>mkfs 创建文件系统</h3><h3 id="fdformat-格式化一张软盘"><a href="#fdformat-格式化一张软盘" class="headerlink" title="fdformat 格式化一张软盘"></a>fdformat 格式化一张软盘</h3><h3 id="dd-把面向块的数据直接写入设备"><a href="#dd-把面向块的数据直接写入设备" class="headerlink" title="dd 把面向块的数据直接写入设备"></a>dd 把面向块的数据直接写入设备</h3><h3 id="genisoimage-mkisofs-创建一个-ISO-9660的映像文件"><a href="#genisoimage-mkisofs-创建一个-ISO-9660的映像文件" class="headerlink" title="genisoimage (mkisofs) 创建一个 ISO 9660的映像文件"></a>genisoimage (mkisofs) 创建一个 ISO 9660的映像文件</h3><h3 id="wodim-cdrecord-把数据写入光存储媒介"><a href="#wodim-cdrecord-把数据写入光存储媒介" class="headerlink" title="wodim (cdrecord) 把数据写入光存储媒介"></a>wodim (cdrecord) 把数据写入光存储媒介</h3><h3 id="md5sum-计算-MD5检验码"><a href="#md5sum-计算-MD5检验码" class="headerlink" title="md5sum  计算 MD5检验码"></a>md5sum  计算 MD5检验码</h3><h1 id="网络系统"><a href="#网络系统" class="headerlink" title="网络系统"></a>网络系统</h1><h2 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h2><ul>
<li>ifconfig 显示已激活的网络设备信息</li>
<li>ifconfig eth0 up 启动或者关闭指定网卡</li>
<li>ifconfig eth0 192.168.1.1 配置 IP 地址</li>
<li>ifconfig eth0 mtu 1500 设置最大传输单元</li>
<li>ifconfig eth0 arp 开启 arp，关闭是 -arp</li>
</ul>
<h3 id="ping-发送-ICMP-ECHO-REQUEST-数据包到网络主机"><a href="#ping-发送-ICMP-ECHO-REQUEST-数据包到网络主机" class="headerlink" title="ping 发送 ICMP ECHO_REQUEST 数据包到网络主机"></a>ping 发送 ICMP ECHO_REQUEST 数据包到网络主机</h3><h3 id="traceroute-打印到一台网络主机的路由数据包"><a href="#traceroute-打印到一台网络主机的路由数据包" class="headerlink" title="traceroute 打印到一台网络主机的路由数据包"></a>traceroute 打印到一台网络主机的路由数据包</h3><p>显示从本地到指定主机要经过的所有“跳数”的网路流量列表</p>
<p>对于那些提供标识信息的路由器，能看到主机名，IP地址和性能数据，对于没有提供标识的路由器，会看到几个星号</p>
<h3 id="netstat-显示与IP、TCP、UDP和ICMP协议相关的统计数据"><a href="#netstat-显示与IP、TCP、UDP和ICMP协议相关的统计数据" class="headerlink" title="netstat 显示与IP、TCP、UDP和ICMP协议相关的统计数据"></a>netstat 显示与IP、TCP、UDP和ICMP协议相关的统计数据</h3><ul>
<li><code>netstat -ie</code> 查看系统中的网络接口</li>
<li><code>netstat -r</code> 显示路由表信息</li>
<li><code>netstat -a</code> 列出所有端口</li>
<li><code>netstat -nu</code> 显示当前 UDP 连接状况</li>
<li><code>netstat -apu</code> 显示 UDP 端口号的使用情况</li>
<li><code>netstat -i</code> 显示网卡列表</li>
<li><code>netstat -s</code> 显示网络统计信息</li>
<li><code>netstat -l</code> 显示监听的套接口</li>
<li><code>netstat -at</code> 列出所有 tcp 端口</li>
<li><code>netstat -a | awk &#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</code> 统计机器中网络连接各个状态个数</li>
<li><code>netstat -nat |awk &#39;{print $6}&#39;|sort|uniq -c</code> 把状态全都取出来后使用uniq -c统计后再进行排序</li>
<li><code>netstat -nat | grep &quot;192.168.120.20:16067&quot; |awk &#39;{print $5}&#39;|awk -F: &#39;{print $4}&#39;|sort|uniq -c|sort -nr|head -20</code> 查看连接某服务端口最多的的IP地址</li>
<li><code>netstat -ap | grep ssh</code> 找出程序运行的端口</li>
<li><code>netstat -pt</code> 在 netstat 输出中显示 PID 和进程名称</li>
<li><code>netstat -anpt | grep &#39;:16064&#39;</code> 找出运行在指定端口的进程</li>
</ul>
<h2 id="route-查看路由表"><a href="#route-查看路由表" class="headerlink" title="route 查看路由表"></a>route 查看路由表</h2><h2 id="tcpdump-抓包分析"><a href="#tcpdump-抓包分析" class="headerlink" title="tcpdump 抓包分析"></a>tcpdump 抓包分析</h2><ul>
<li>tcpdump -i eth0 port 3000</li>
</ul>
<h3 id="ftp-因特网文件传输程序"><a href="#ftp-因特网文件传输程序" class="headerlink" title="ftp 因特网文件传输程序"></a>ftp 因特网文件传输程序</h3><h3 id="wget-非交互式网络下载器"><a href="#wget-非交互式网络下载器" class="headerlink" title="wget 非交互式网络下载器"></a>wget 非交互式网络下载器</h3><h3 id="ssh-OpenSSH-SSH-客户端（远程登陆程序）"><a href="#ssh-OpenSSH-SSH-客户端（远程登陆程序）" class="headerlink" title="ssh OpenSSH SSH 客户端（远程登陆程序）"></a>ssh OpenSSH SSH 客户端（远程登陆程序）</h3><h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><h3 id="file-显示文件详细信息"><a href="#file-显示文件详细信息" class="headerlink" title="file 显示文件详细信息"></a>file 显示文件详细信息</h3><h4 id="格式-8"><a href="#格式-8" class="headerlink" title="格式"></a>格式</h4><p><code>file [filename]</code></p>
<h3 id="df-查看磁盘剩余空间的数量"><a href="#df-查看磁盘剩余空间的数量" class="headerlink" title="df 查看磁盘剩余空间的数量"></a>df 查看磁盘剩余空间的数量</h3><h3 id="tar-打包"><a href="#tar-打包" class="headerlink" title="tar 打包"></a>tar 打包</h3><h4 id="格式-9"><a href="#格式-9" class="headerlink" title="格式"></a>格式</h4><p><code>tar [必要参数] [选择参数] [打包后文件名] [文件或目录]</code></p>
<h4 id="必要参数-1"><a href="#必要参数-1" class="headerlink" title="必要参数"></a>必要参数</h4><ul>
<li>-A 新增压缩文件到已存在的压缩</li>
<li>-B 设置区块大小</li>
<li>-c 建立新的压缩文件</li>
<li>-d 记录文件的差别</li>
<li>-r 添加文件到已经压缩的文件</li>
<li>-u 添加改变了和现有的文件到已经存在的压缩文件</li>
<li>-x 从压缩文件中提取文件</li>
<li>-t 显示压缩文件的内容</li>
<li>-z 支持 gzip 解压文件</li>
<li>-j 支持 bzip2 解压文件</li>
<li>-z 支持 compress 解压文件</li>
<li>-v 显示操作过程</li>
<li>-l 文件系统边界设置</li>
<li>-k 保留原有文件不被覆盖</li>
<li>-m 保留五年间不被覆盖</li>
<li>-W 确认压缩文件的正确性</li>
</ul>
<h4 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h4><ul>
<li>-b 设置区块数目</li>
<li>-C 切换到指定目录</li>
<li>-f 指定压缩文件</li>
</ul>
<h4 id="常见解压、压缩命令"><a href="#常见解压、压缩命令" class="headerlink" title="常见解压、压缩命令"></a>常见解压、压缩命令</h4><h5 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h5><p>解包：tar xvf FileName.tar<br>打包：tar cvf FileName.tar DirName</p>
<h5 id="gz"><a href="#gz" class="headerlink" title=".gz"></a>.gz</h5><p>解压1：gunzip FileName.gz<br>解压2：gzip -d FileName.gz<br>压缩：gzip FileName</p>
<h5 id="tar-gz-和-tgz"><a href="#tar-gz-和-tgz" class="headerlink" title=".tar.gz 和 .tgz"></a>.tar.gz 和 .tgz</h5><p>解压：tar zxvf FileName.tar.gz<br>压缩：tar zcvf FileName.tar.gz DirName</p>
<h5 id="bz2"><a href="#bz2" class="headerlink" title=".bz2"></a>.bz2</h5><p>解压1：bzip2 -d FileName.bz2<br>解压2：bunzip2 FileName.bz2<br>压缩： bzip2 -z FileName</p>
<h5 id="tar-bz2"><a href="#tar-bz2" class="headerlink" title=".tar.bz2"></a>.tar.bz2</h5><p>解压：tar jxvf FileName.tar.bz2<br>压缩：tar jcvf FileName.tar.bz2 DirName</p>
<h5 id="bz"><a href="#bz" class="headerlink" title=".bz"></a>.bz</h5><p>解压1：bzip2 -d FileName.bz<br>解压2：bunzip2 FileName.bz</p>
<h5 id="tar-bz"><a href="#tar-bz" class="headerlink" title=".tar.bz"></a>.tar.bz</h5><p>解压：tar jxvf FileName.tar.bz</p>
<h5 id="Z"><a href="#Z" class="headerlink" title=".Z"></a>.Z</h5><p>解压：uncompress FileName.Z<br>压缩：compress FileName</p>
<h5 id="tar-Z"><a href="#tar-Z" class="headerlink" title=".tar.Z"></a>.tar.Z</h5><p>解压：tar Zxvf FileName.tar.Z<br>压缩：tar Zcvf FileName.tar.Z DirName</p>
<h5 id="zip"><a href="#zip" class="headerlink" title=".zip"></a>.zip</h5><p>解压：unzip FileName.zip<br>压缩：zip FileName.zip DirName</p>
<h5 id="rar"><a href="#rar" class="headerlink" title=".rar"></a>.rar</h5><p>解压：rar x FileName.rar<br>压缩：rar a FileName.rar DirName </p>
<h3 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h3><ul>
<li>-a或–ascii 　使用ASCII文字模式。 </li>
<li>-c或–stdout或–to-stdout 　把压缩后的文件输出到标准输出设备，不去更动原始文件。 </li>
<li>-d或–decompress或—-uncompress 　<strong>解压</strong> 文件。 </li>
<li>-f或–force 　强行压缩文件。不理会文件名称或硬连接是否存在以及该文件是否为符号连接。 </li>
<li>-h或–help 　在线帮助。 </li>
<li>-l或–list 　列出压缩文件的相关信息。 </li>
<li>-L或–license 　显示版本与版权信息。 </li>
<li>-n或–no-name 　压缩文件时，不保存原来的文件名称及时间戳记。 </li>
<li>-N或–name 　压缩文件时，保存原来的文件名称及时间戳记。 </li>
<li>-q或–quiet 　不显示警告信息。 </li>
<li>-r或–recursive 　递归处理，将指定目录下的所有文件及子目录一并处理。 </li>
<li>-S&lt;压缩字尾字符串&gt;或—-suffix&lt;压缩字尾字符串&gt; 　更改压缩字尾字符串。 </li>
<li>-t或–test 　测试压缩文件是否正确无误。 </li>
<li>-v或–verbose 　显示指令执行过程。 </li>
<li>-V或–version 　显示版本信息。 </li>
</ul>
<h3 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h3><h4 id="上传文件到远程服务器"><a href="#上传文件到远程服务器" class="headerlink" title="上传文件到远程服务器"></a>上传文件到远程服务器</h4><ul>
<li><code>scp /path/filename  username@serverIp:/path</code></li>
</ul>
<h4 id="从远程服务器下载文件"><a href="#从远程服务器下载文件" class="headerlink" title="从远程服务器下载文件"></a>从远程服务器下载文件</h4><ul>
<li><code>scp username@serverIp:/path/filename ~/local_dir</code></li>
</ul>
<h3 id="df-检查文件系统的磁盘空间占用情况"><a href="#df-检查文件系统的磁盘空间占用情况" class="headerlink" title="df 检查文件系统的磁盘空间占用情况"></a>df 检查文件系统的磁盘空间占用情况</h3><h4 id="参数-9"><a href="#参数-9" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>全部文件系统列表</td>
</tr>
<tr>
<td>-h</td>
<td>方便阅读方式显示</td>
</tr>
<tr>
<td>-i</td>
<td>显示 inode 信息</td>
</tr>
<tr>
<td>-T</td>
<td>文件系统类型</td>
</tr>
<tr>
<td>-t&lt;文件系统类型&gt;</td>
<td>只显示选定文件系统的磁盘信息</td>
</tr>
<tr>
<td>-x&lt;文件系统类型&gt;</td>
<td>不显示选定文件系统的磁盘信息</td>
</tr>
</tbody></table>
<h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><h3 id="键盘高级操作技巧"><a href="#键盘高级操作技巧" class="headerlink" title="键盘高级操作技巧"></a><a href="http://billie66.github.io/TLCL/book/chap09.html" target="_blank" rel="noopener">键盘高级操作技巧</a></h3><h3 id="history-查看历史命令"><a href="#history-查看历史命令" class="headerlink" title="history 查看历史命令"></a>history 查看历史命令</h3><ul>
<li><code>history | less</code> 搜索历史命令</li>
</ul>
<h3 id="clear-清空屏幕"><a href="#clear-清空屏幕" class="headerlink" title="clear 清空屏幕"></a>clear 清空屏幕</h3><h2 id="文件查找"><a href="#文件查找" class="headerlink" title="文件查找"></a>文件查找</h2><h3 id="which-显示一个可执行程序的位置"><a href="#which-显示一个可执行程序的位置" class="headerlink" title="which 显示一个可执行程序的位置"></a>which 显示一个可执行程序的位置</h3><p>只对 <strong>可执行程序</strong> 有效，不包括 <strong>内建命令</strong> 和 <strong>命令别名</strong>，which 指令会在 PATH 变量指定的路径中，搜索某个系统命令的位置，并且返回第一个搜索结果</p>
<h3 id="locate-通过名字来查找文件"><a href="#locate-通过名字来查找文件" class="headerlink" title="locate 通过名字来查找文件"></a>locate 通过名字来查找文件</h3><p>和 find -name 一样，但是速度更快。<br>locate 命令可以在搜寻数据库时快速找到档案，数据库由 updatedb 程序来更新，updatedb 是由cron daemon 周期性建立的，locate命令在搜寻数据库时比由整个由硬盘资料来搜寻资料来得快，但较差劲的是locate所找到的档案若是最近才建立或 刚更名的，可能会找不到，在内定值中，updatedb 每天会跑一次，可以由修改 crontab 来更新设定值。(etc/crontab)</p>
<h4 id="格式-10"><a href="#格式-10" class="headerlink" title="格式"></a>格式</h4><p><code>locate [选择参数][样式]</code></p>
<h4 id="参数-10"><a href="#参数-10" class="headerlink" title="参数"></a>参数</h4><ul>
<li>-e 将排除在寻找范围之外</li>
<li>-o 指定资料库存的名称</li>
<li>-d 指定资料库的路径</li>
</ul>
<h4 id="实例-6"><a href="#实例-6" class="headerlink" title="实例"></a>实例</h4><ol>
<li><code>locate /etc/sh</code> 搜索 etc 目录下所有以 sh 开头的文件</li>
<li><code>locate pwd</code> 查找和 pwd 相关的所有文件</li>
<li><code>locate /etc/sh</code> 搜索 etc 目录下所有以 sh 开头的文件</li>
</ol>
<h3 id="whereis-查看文件的位置"><a href="#whereis-查看文件的位置" class="headerlink" title="whereis 查看文件的位置"></a>whereis 查看文件的位置</h3><p>whereis 命令只能用于 <strong>程序名</strong> 的搜索，而且只搜索二进制文件（参数-b）、man 说明文件（参数-m）和源代码文件（参数-s）。如果省略参数，则返回所有信息。使用和 locate 相同的数据库。</p>
<h4 id="格式-11"><a href="#格式-11" class="headerlink" title="格式"></a>格式</h4><p><code>whereis [-bmsu] [BMS 目录名 -f ] 文件名</code></p>
<h4 id="实例-7"><a href="#实例-7" class="headerlink" title="实例"></a>实例</h4><p>where nginx 将和 nginx 相关的文件都查找出来</p>
<h3 id="find-在一个目录层次结构中搜索文件"><a href="#find-在一个目录层次结构中搜索文件" class="headerlink" title="find 在一个目录层次结构中搜索文件"></a>find 在一个目录层次结构中搜索文件</h3><h4 id="格式-12"><a href="#格式-12" class="headerlink" title="格式"></a>格式</h4><p><code>find pathname -options [-print -exec -ok ...]</code></p>
<h4 id="参数-11"><a href="#参数-11" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>pathname</td>
<td>用来查找的目录路径。.表示当前目录</td>
</tr>
<tr>
<td>-print</td>
<td>将匹配的文件输出到标准输出</td>
</tr>
<tr>
<td>-exec</td>
<td>find命令对匹配的文件执行该参数所给出的shell命令。相应命令的形式为’command’ {} ;，注意{}和;之间的空格。{} 代表前面查找出来的文件名</td>
</tr>
<tr>
<td>-ok</td>
<td>和 -exec 作用相同，在执行每个命令前让用户确定是否执行</td>
</tr>
</tbody></table>
<h4 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h4><table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-name</td>
<td>按照文件名查找</td>
</tr>
<tr>
<td>-perm</td>
<td>按照文件权限查找</td>
</tr>
<tr>
<td>-user</td>
<td>按照文件属主查找</td>
</tr>
<tr>
<td>-group</td>
<td>按照文件所属的组查找</td>
</tr>
<tr>
<td>-mtime -n +n</td>
<td>按照文件更改的时间来查找，-n 表示文件更改时间距现在 n 天以内，+n 表示文件更改时间距现在 n 天以前</td>
</tr>
<tr>
<td>-nogroup</td>
<td>查找无有效所属组的文件，即该文件所属的组在/etc/groups中不存在。</td>
</tr>
<tr>
<td>-nouser</td>
<td>查找无有效属主的文件，即该文件的属主在/etc/passwd中不存在。</td>
</tr>
<tr>
<td>-newer file1 ! file2</td>
<td>查找更改时间比文件file1新但比文件file2旧的文件。</td>
</tr>
<tr>
<td>-type</td>
<td>查找某一类型的文件，b - 块设备文件、d - 目录、c - 字符设备文件、p - 管道文件、l - 符号链接文件、f - 普通文件。</td>
</tr>
<tr>
<td>-follow</td>
<td>如果 find 命令遇到符号链接文件，就跟踪链接所指向的文件</td>
</tr>
</tbody></table>
<h4 id="实例-8"><a href="#实例-8" class="headerlink" title="实例"></a>实例</h4><ol>
<li><code>find . -name &quot;*.log&quot;</code> 根据关键词查找</li>
<li><code>find . type d|sort</code> 查找当前所有目录并排序</li>
<li><code>find . type -exec ls -l {} \;</code> 匹配当前目录下的所有普通文件，并在-exec选项中使用ls -l命令将它们列出。</li>
<li><code>find . type f -mtime +14 -exec rm {} \;</code> 在目录中查找更改时间在n日以前的文件并删除它们</li>
<li><code>find . \( -nmae &quot;*.txt&quot; -or -name &quot;*.pdf&quot; \)</code> 打印目录下所有以 .txt 和 .pdf 结尾的文件名</li>
<li><code>find . ! -name &quot;*.txt&quot;</code> 打印当前目录下所有不以 .txt 结尾的文件名</li>
</ol>
<h2 id="文件内容查看"><a href="#文件内容查看" class="headerlink" title="文件内容查看"></a>文件内容查看</h2><h3 id="more-逐页读取文件（启动时加载整个文件）"><a href="#more-逐页读取文件（启动时加载整个文件）" class="headerlink" title="more 逐页读取文件（启动时加载整个文件）"></a>more 逐页读取文件（启动时加载整个文件）</h3><ul>
<li>+n      从笫n行开始显示</li>
<li>-n       定义屏幕大小为n行</li>
<li>+/pattern 在每个档案显示前搜寻该字串（pattern），然后从该字串前两行之后开始显示  </li>
<li>-c       从顶部清屏，然后显示</li>
</ul>
<h4 id="实例-9"><a href="#实例-9" class="headerlink" title="实例"></a>实例</h4><p>ls -l | more -5 使用 more 分页显示</p>
<h3 id="less-（more-的改进版）"><a href="#less-（more-的改进版）" class="headerlink" title="less （more 的改进版）"></a>less （more 的改进版）</h3><p>可以向前或者向后浏览和搜索文件，而且不会加载整个文件</p>
<h4 id="参数-12"><a href="#参数-12" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>&lt;缓冲区大小&gt; 设置缓冲区的大小</td>
</tr>
<tr>
<td>-e</td>
<td>当文件显示结束后，自动离开</td>
</tr>
<tr>
<td>-f</td>
<td>强迫打开特殊文件，例如外围设备代号、目录和二进制文件</td>
</tr>
<tr>
<td>-g</td>
<td>只标志最后搜索的关键词</td>
</tr>
<tr>
<td>-i</td>
<td>忽略搜索时的大小写</td>
</tr>
<tr>
<td>-m</td>
<td>显示类似more命令的百分比</td>
</tr>
<tr>
<td>-N</td>
<td>显示每行的行号</td>
</tr>
<tr>
<td>-o</td>
<td>&lt;文件名&gt; 将less 输出的内容在指定文件中保存起来</td>
</tr>
<tr>
<td>-Q</td>
<td>不使用警告音</td>
</tr>
<tr>
<td>-s</td>
<td>显示连续空行为一行</td>
</tr>
<tr>
<td>-S</td>
<td>行过长时间将超出部分舍弃</td>
</tr>
<tr>
<td>-x</td>
<td>&lt;数字&gt; 将“tab”键显示为规定的数字空格</td>
</tr>
<tr>
<td>/字符串</td>
<td>向下搜索“字符串”的功能</td>
</tr>
<tr>
<td>?字符串</td>
<td>向上搜索“字符串”的功能</td>
</tr>
<tr>
<td>n</td>
<td>重复前一个搜索（与 / 或 ? 有关）</td>
</tr>
<tr>
<td>N</td>
<td>反向重复前一个搜索（与 / 或 ? 有关）</td>
</tr>
<tr>
<td>b</td>
<td>向后翻一页</td>
</tr>
<tr>
<td>d</td>
<td>向后翻半页</td>
</tr>
<tr>
<td>h</td>
<td>显示帮助界面</td>
</tr>
<tr>
<td>Q</td>
<td>退出less 命令</td>
</tr>
<tr>
<td>u</td>
<td>向前滚动半页</td>
</tr>
<tr>
<td>y</td>
<td>向前滚动一行</td>
</tr>
<tr>
<td>空格键</td>
<td>滚动一行</td>
</tr>
<tr>
<td>回车键</td>
<td>滚动一页</td>
</tr>
<tr>
<td><code>[pagedown]</code></td>
<td>向下翻动一页</td>
</tr>
<tr>
<td><code>[pageup]</code></td>
<td>向上翻动一页</td>
</tr>
</tbody></table>
<h3 id="head-显示档案的开头"><a href="#head-显示档案的开头" class="headerlink" title="head 显示档案的开头"></a>head 显示档案的开头</h3><h4 id="参数-13"><a href="#参数-13" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-q</td>
<td>隐藏文件名</td>
</tr>
<tr>
<td>-v</td>
<td>显示文件名</td>
</tr>
<tr>
<td>-c</td>
<td>显示的字节数</td>
</tr>
<tr>
<td>-n</td>
<td>显示的行数</td>
</tr>
</tbody></table>
<h4 id="实例-10"><a href="#实例-10" class="headerlink" title="实例"></a>实例</h4><p>head -n -6 log2014.log 输出文件除了最后n行的全部内容</p>
<h3 id="tail-查看文件最后几行"><a href="#tail-查看文件最后几行" class="headerlink" title="tail 查看文件最后几行"></a>tail 查看文件最后几行</h3><h4 id="参数-14"><a href="#参数-14" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-f</td>
<td>不断刷新，循环读取</td>
</tr>
<tr>
<td>-q</td>
<td>不显示处理信息</td>
</tr>
<tr>
<td>-v</td>
<td>显示详细的处理信息</td>
</tr>
<tr>
<td>-c</td>
<td>显示的字节数</td>
</tr>
<tr>
<td>-n</td>
<td>显示的行数</td>
</tr>
<tr>
<td>–pid=PID</td>
<td>与 -f 合用，表示在进程 PID 死掉后结束</td>
</tr>
<tr>
<td>-s</td>
<td>与 -f 合用，表示在每次反复的间隔休眠 s 秒</td>
</tr>
</tbody></table>
<h3 id="uniq-报道或忽略重复行"><a href="#uniq-报道或忽略重复行" class="headerlink" title="uniq 报道或忽略重复行"></a>uniq 报道或忽略重复行</h3><h3 id="wc-打印行数、字数和字节数"><a href="#wc-打印行数、字数和字节数" class="headerlink" title="wc 打印行数、字数和字节数"></a>wc 打印行数、字数和字节数</h3><ul>
<li><code>wc filename</code></li>
</ul>
<h2 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h2><h3 id="cat-连接文件并且打印到标准输出"><a href="#cat-连接文件并且打印到标准输出" class="headerlink" title="cat 连接文件并且打印到标准输出"></a>cat 连接文件并且打印到标准输出</h3><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><ul>
<li>一次显示整个文件 cat filename</li>
<li>从键盘创建一个文件 cat &gt; filename,按下 Ctrl+d 结束</li>
<li>讲几个文件合并为一个文件 cat file1 file2 &gt; file</li>
</ul>
<h4 id="参数-15"><a href="#参数-15" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-A</td>
<td>–show-all 等价于 -vET</td>
</tr>
<tr>
<td>-b</td>
<td>对非空输出行编号</td>
</tr>
<tr>
<td>-e</td>
<td>等价于 -vE</td>
</tr>
<tr>
<td>-E</td>
<td>在每行结束出显示 $</td>
</tr>
<tr>
<td>-n</td>
<td>对所有输出行编号</td>
</tr>
<tr>
<td>-s</td>
<td>有连续两次以上的空白行，就代换为一行的空白行</td>
</tr>
<tr>
<td>-t</td>
<td>与 -vT 等价</td>
</tr>
<tr>
<td>-T</td>
<td>将跳格字符显示为 ^I</td>
</tr>
<tr>
<td>-v –show-nonprinting</td>
<td>使用 ^ 和 M- 引用，除了 LFD 和 TAB 之外</td>
</tr>
</tbody></table>
<h4 id="实例-11"><a href="#实例-11" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>cat -A foo.txt</code> 输出 ^IThe quick brown fox jumped over the lazy dog.       $ 。tab 用 ^I 表示，$ 著现在文本行真正的结尾处，表明文本包含末尾的空格。</li>
</ul>
<h4 id="tac-和cat相反，从最后一行开始显示"><a href="#tac-和cat相反，从最后一行开始显示" class="headerlink" title="tac 和cat相反，从最后一行开始显示"></a>tac 和cat相反，从最后一行开始显示</h4><h3 id="sort-给文本行排序"><a href="#sort-给文本行排序" class="headerlink" title="sort 给文本行排序"></a>sort 给文本行排序</h3><p>能够接受命令行中的多个文件作为参数，吧多个文件合并成一个有序的文件。</p>
<h4 id="参数-16"><a href="#参数-16" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-f</td>
<td>不区分大小写</td>
</tr>
<tr>
<td>-n</td>
<td>基于字符串的数值来排序</td>
</tr>
<tr>
<td>-r</td>
<td>按相反顺序排序，按照降序排列</td>
</tr>
<tr>
<td>-k</td>
<td><code>--key=field1[,field2]</code> 对从 field1 到 field2 之间的字符排序，而不是整个文本行。</td>
</tr>
<tr>
<td>-o</td>
<td>把排好序的输出结果发送到文件，而不是标准输出</td>
</tr>
<tr>
<td>-t</td>
<td>定义分割字符</td>
</tr>
</tbody></table>
<h4 id="实例-12"><a href="#实例-12" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>sort file1.txt file2.txt file3.txt &gt; final_sorted_list.txt</code></li>
<li><code>du -s /usr/share/* | sort -nr | head</code> 显示十个最大的空间消费者</li>
<li><code>ls -l /usr/bin | sort -nr -k 5 | head</code> 按照文件大小（第五个字段）排序</li>
<li><code>sort --key=1,1 --key=2n distros.txt</code> 我们指定了一个字段区域。因为我们只想对第一个字段排序，我们指定了 1,1， 意味着“始于并且结束于第一个字段。”在第二个实例中，我们指定了 2n，意味着第二个字段是排序的键值， 并且按照数值排序</li>
</ul>
<h3 id="uniq-报告或者省略重复行"><a href="#uniq-报告或者省略重复行" class="headerlink" title="uniq 报告或者省略重复行"></a>uniq 报告或者省略重复行</h3><p>只会删除相邻的重复行</p>
<h4 id="参数-17"><a href="#参数-17" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-c</td>
<td>输出所有的重复行，每行开头显示重复的次数</td>
</tr>
<tr>
<td>-d</td>
<td>只输出重复行</td>
</tr>
<tr>
<td>-f n</td>
<td>忽略开头的 n 个字段，字段之间由空格分隔</td>
</tr>
</tbody></table>
<h3 id="cut-从每行中删除文本区域"><a href="#cut-从每行中删除文本区域" class="headerlink" title="cut 从每行中删除文本区域"></a>cut 从每行中删除文本区域</h3><h4 id="参数-18"><a href="#参数-18" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>以字节为单位进行分割</td>
</tr>
<tr>
<td>-c</td>
<td>以字符为单位进行分割</td>
</tr>
<tr>
<td>-d</td>
<td>自定义分隔符，默认为制表符</td>
</tr>
<tr>
<td>-f</td>
<td>自定义字段</td>
</tr>
<tr>
<td>–complement</td>
<td>抽取整个文本行，除了那些由 -c 或 -f 选项指定的文本</td>
</tr>
</tbody></table>
<h4 id="实例-13"><a href="#实例-13" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>cut -f 1,3 -d &#39; &#39; student.txt</code> 取出 student.txt 文件中的第一列和第三列</li>
<li><code>cut -f 1-3 -d &#39; &#39; student.txt</code> 取出 student.txt 文件的前三列</li>
</ul>
<h3 id="paste-合并文件文本行"><a href="#paste-合并文件文本行" class="headerlink" title="paste 合并文件文本行"></a>paste 合并文件文本行</h3><h4 id="参数-19"><a href="#参数-19" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-s</td>
<td>将每个文件合并成行而不是按行粘贴</td>
</tr>
<tr>
<td>-d</td>
<td>自定义分隔符，默认为制表符</td>
</tr>
</tbody></table>
<h4 id="实例-14"><a href="#实例-14" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>paste distros-dates.txt distros-versions.txt</code> 将这两个文件按列拼接</li>
</ul>
<h3 id="join-基于某个共享字段来联合两个文件的文本行"><a href="#join-基于某个共享字段来联合两个文件的文本行" class="headerlink" title="join 基于某个共享字段来联合两个文件的文本行"></a>join 基于某个共享字段来联合两个文件的文本行</h3><h4 id="参数-20"><a href="#参数-20" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-j FIELD</td>
<td>等同于 -1 FIELD -2 FIELD,-j 指定一个域作为匹配字段</td>
</tr>
<tr>
<td>-1 FIELD</td>
<td>以 file1 中 FIELD 字段进行匹配</td>
</tr>
<tr>
<td>-2 FIELD</td>
<td>以 file2 中 FIELD 字段进行匹配</td>
</tr>
<tr>
<td>-t</td>
<td>自定义分隔符，默认为制表符</td>
</tr>
</tbody></table>
<h3 id="comm-逐行比较两个有序的文件"><a href="#comm-逐行比较两个有序的文件" class="headerlink" title="comm 逐行比较两个有序的文件"></a>comm 逐行比较两个有序的文件</h3><h3 id="diff-逐行比较文件"><a href="#diff-逐行比较文件" class="headerlink" title="diff 逐行比较文件"></a>diff 逐行比较文件</h3><p>支持 许多输出格式，并且一次能处理许多文本文件。软件开发员经常使用 diff 程序来检查不同程序源码 版本之间的更改，diff 能够递归地检查源码目录，经常称之为源码树。</p>
<h3 id="patch-给原始文件打补丁"><a href="#patch-给原始文件打补丁" class="headerlink" title="patch 给原始文件打补丁"></a>patch 给原始文件打补丁</h3><h3 id="tr-转换字符"><a href="#tr-转换字符" class="headerlink" title="tr 转换字符"></a>tr 转换字符</h3><p>tr 命令操作标准输入，并把结果输出到标准输出。tr 命令接受两个参数：要被转换的字符集以及相对应的转换后的字符集。字符集可以用三种方式来表示：</p>
<ol>
<li>一个枚举列表。例如， ABCDEFGHIJKLMNOPQRSTUVWXYZ</li>
<li>一个字符域。例如，A-Z 。注意这种方法有时候面临与其它命令相同的问题，归因于 语系的排序规则，因此应该谨慎使用。</li>
<li>POSIX 字符类。例如，[:upper:]</li>
</ol>
<h4 id="实例-15"><a href="#实例-15" class="headerlink" title="实例"></a>实例</h4><ul>
<li><code>echo &quot;lowercase letters&quot; | tr a-z A-Z</code> 将小写转换为大写</li>
<li><code>echo &quot;lowercase letters&quot; | tr [:lower:] [:upper:]</code></li>
</ul>
<h3 id="aspell-交互式拼写检查器"><a href="#aspell-交互式拼写检查器" class="headerlink" title="aspell 交互式拼写检查器"></a>aspell 交互式拼写检查器</h3><h2 id="文本搜素"><a href="#文本搜素" class="headerlink" title="文本搜素"></a>文本搜素</h2><h3 id="grep-打印匹配行"><a href="#grep-打印匹配行" class="headerlink" title="grep 打印匹配行"></a>grep 打印匹配行</h3><h4 id="格式-13"><a href="#格式-13" class="headerlink" title="格式"></a>格式</h4><p><code>grep [option] regex [file...]</code></p>
<h4 id="参数-21"><a href="#参数-21" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-i</td>
<td>忽略大小写</td>
</tr>
<tr>
<td>-v</td>
<td>只打印不匹配的行</td>
</tr>
<tr>
<td>-c</td>
<td>打印匹配的数量</td>
</tr>
</tbody></table>
<h4 id="实例-16"><a href="#实例-16" class="headerlink" title="实例"></a>实例</h4><ol>
<li>从文件中读取关键词进行搜索 cat text.txt|grep -f test2.txt 输出test.txt文件中含有从test2.txt文件中读取出的关键词的内容行</li>
<li>显示当前目录下面以.txt 结尾的文件中的所有包含每个字符串至少有7个连续小写字符的字符串的行 <code>grep &#39;[a-z]\{7\}&#39; *.txt</code></li>
<li>从文件中查找关键词 grep ‘linux’ test.txt</li>
</ol>
<h3 id="sed-用于筛选和转换文本的流编辑器"><a href="#sed-用于筛选和转换文本的流编辑器" class="headerlink" title="sed 用于筛选和转换文本的流编辑器"></a>sed 用于筛选和转换文本的流编辑器</h3><h4 id="参数-22"><a href="#参数-22" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>n</td>
<td>行号，n 是一个正整数。</td>
</tr>
<tr>
<td>$</td>
<td>最后一行。</td>
</tr>
<tr>
<td>/regexp/</td>
<td>所有匹配一个 POSIX 基本正则表达式的文本行。注意正则表达式通过 斜杠字符界定。选择性地，这个正则表达式可能由一个备用字符界定，通过\cregexpc 来 指定表达式，这里 c 就是一个备用的字符。</td>
</tr>
<tr>
<td>addr1,addr2</td>
<td>从 addr1 到 addr2 范围内的文本行，包含地址 addr2 在内。地址可能是上述任意 单独的地址形式。</td>
</tr>
<tr>
<td>first~step</td>
<td>匹配由数字 first 代表的文本行，然后随后的每个在 step 间隔处的文本行。例如 1<del>2 是指每个位于偶数行号的文本行，5</del>5 则指第五行和之后每五行位置的文本行。</td>
</tr>
<tr>
<td>addr1,+n</td>
<td>匹配地址 addr1 和随后的 n 个文本行。</td>
</tr>
<tr>
<td>addr!</td>
<td>匹配所有的文本行，除了 addr 之外，addr 可能是上述任意的地址形式。</td>
</tr>
</tbody></table>
<h3 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h3><h2 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h2><h3 id="nl-添加行号"><a href="#nl-添加行号" class="headerlink" title="nl 添加行号"></a>nl 添加行号</h3><p>相当于 <code>cat -n</code></p>
<h4 id="参数-23"><a href="#参数-23" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-b a</td>
<td>无论是否空行都输出行号</td>
</tr>
<tr>
<td>-b t</td>
<td>对非空行输出行号</td>
</tr>
<tr>
<td>-n ln</td>
<td>行号在萤幕的最左方显示</td>
</tr>
<tr>
<td>-n rn</td>
<td>行号在自己栏位的最右方显示，且不加 0</td>
</tr>
<tr>
<td>-n rz</td>
<td>行号在自己栏位的最右方显示，且加 0</td>
</tr>
<tr>
<td>-w</td>
<td>行号宽度设置，默认为六</td>
</tr>
</tbody></table>
<h3 id="实例-17"><a href="#实例-17" class="headerlink" title="实例"></a>实例</h3><ul>
<li><code>nl -b a -n rz -w 3 log2014.log</code> 让行号前面自动补上0，行号为3位</li>
</ul>
<h3 id="fold-限制文件列宽"><a href="#fold-限制文件列宽" class="headerlink" title="fold 限制文件列宽"></a>fold 限制文件列宽</h3><ul>
<li><code>echo &quot;The quick brown fox jumped over the lazy dog.&quot; | fold -w 12</code> 限制行宽为 12 个字符，默认 80</li>
<li>加上 -s 选项可以考虑单词边界</li>
</ul>
<h3 id="fmt-简单的文本格式转换器"><a href="#fmt-简单的文本格式转换器" class="headerlink" title="fmt 简单的文本格式转换器"></a>fmt 简单的文本格式转换器</h3><h3 id="pr"><a href="#pr" class="headerlink" title="pr"></a>pr</h3><h3 id="printf-格式化数据并打印"><a href="#printf-格式化数据并打印" class="headerlink" title="printf 格式化数据并打印"></a>printf 格式化数据并打印</h3><h3 id="groff-文件格式化系统"><a href="#groff-文件格式化系统" class="headerlink" title="groff 文件格式化系统"></a>groff 文件格式化系统</h3><h2 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h2><table>
<thead>
<tr>
<th>Debian</th>
<th>Red Hat</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>apt-get update;apt-cache search search_string</td>
<td>yum search search_string</td>
<td>查找资源库中的软件包</td>
</tr>
<tr>
<td>apt-get update; apt-get install package_name</td>
<td>yum install package_name</td>
<td>从资源库中安装一个软件包</td>
</tr>
<tr>
<td>dpkg –install package_file</td>
<td>rpm -i package_file</td>
<td>通过软件包文件来安装软件</td>
</tr>
<tr>
<td>apt-get remove package_name</td>
<td>yum erase package_name</td>
<td>卸载软件</td>
</tr>
<tr>
<td>apt-get update; apt-get upgrade</td>
<td>yum update</td>
<td>经过资源库来更新软件包</td>
</tr>
<tr>
<td>dpkg –install package_file</td>
<td>rpm -U package_file</td>
<td>经过软件包文件来升级软件</td>
</tr>
<tr>
<td>dpkg –list</td>
<td>rpm -qa</td>
<td>列出所安装的软件包</td>
</tr>
<tr>
<td>dpkg –status package_name</td>
<td>rpm -q package_name</td>
<td>确定是否安装了一个软件包</td>
</tr>
<tr>
<td>apt-cache show package_name</td>
<td>yum info package_name</td>
<td>显示所安装软件包的信息</td>
</tr>
<tr>
<td>dpkg –search file_name</td>
<td>rpm -qf file_name</td>
<td>查找安装了某个文件的软件包</td>
</tr>
</tbody></table>
<h2 id="其他内容"><a href="#其他内容" class="headerlink" title="其他内容"></a>其他内容</h2><h3 id="etc-group-文件"><a href="#etc-group-文件" class="headerlink" title="/etc/group 文件"></a>/etc/group 文件</h3><p>Linux /etc/group文件与/etc/passwd和/etc/shadow文件都是有关于系统管理员对用户和用户组管理时相关的文件。linux /etc/group文件是有关于系统管理员对用户和用户组管理的文件,linux用户组的所有信息都存放在/etc/group文件中。具有某种共同特征的用户集合起来就是用户组（Group）。用户组（Group）配置文件主要有 /etc/group和/etc/gshadow，其中/etc/gshadow是/etc/group的加密信息文件。</p>
<p>用户组的所有信息都存放在/etc/group文件中。此文件的格式是由冒号(:)隔开若干个字段，这些字段具体如下：</p>
<ul>
<li>组名:口令:组标识号:组内用户列表</li>
</ul>
<h4 id="组名："><a href="#组名：" class="headerlink" title="组名："></a>组名：</h4><p>组名是用户组的名称，由字母或数字构成。与/etc/passwd中的登录名一样，组名不应重复。</p>
<h4 id="口令："><a href="#口令：" class="headerlink" title="口令："></a>口令：</h4><p>口令字段存放的是用户组加密后的口令字。一般Linux系统的用户组都没有口令，即这个字段一般为空，或者是*。</p>
<h4 id="组标识号："><a href="#组标识号：" class="headerlink" title="组标识号："></a>组标识号：</h4><p>组标识号与用户标识号类似，也是一个整数，被系统内部用来标识组。别称GID.</p>
<h4 id="组内用户列表："><a href="#组内用户列表：" class="headerlink" title="组内用户列表："></a>组内用户列表：</h4><p>是属于这个组的所有用户的列表，不同用户之间用逗号(,)分隔。这个用户组可能是用户的主组，也可能是附加组。</p>
<h3 id="date-显示系统当前时间和日期"><a href="#date-显示系统当前时间和日期" class="headerlink" title="date 显示系统当前时间和日期"></a>date 显示系统当前时间和日期</h3><h3 id="cal-显示当前月份的日历"><a href="#cal-显示当前月份的日历" class="headerlink" title="cal 显示当前月份的日历"></a>cal 显示当前月份的日历</h3><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://www.cnblogs.com/peida/archive/2012/12/05/2803591.html" target="_blank" rel="noopener">每天一个 linux 命令</a></li>
<li><a href="http://billie66.github.io/TLCL/book/index.html" target="_blank" rel="noopener">The Linux Command Line</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/06/22/Linux-%E5%91%BD%E4%BB%A4/" data-id="ckd5czhhk000innnrh2kk3hbb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A2%98%E7%9B%AE/" rel="tag">题目</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-高并发大流量解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/10/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%A4%A7%E6%B5%81%E9%87%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="article-date">
  <time datetime="2019-06-10T14:10:24.000Z" itemprop="datePublished">2019-06-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/10/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%A4%A7%E6%B5%81%E9%87%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">高并发大流量设计思路</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="大型网站架构演化发展历程"><a href="#大型网站架构演化发展历程" class="headerlink" title="大型网站架构演化发展历程"></a>大型网站架构演化发展历程</h2><ul>
<li>应用服务和数据服务分离</li>
<li>使用缓存改善网站性能</li>
<li>使用应用服务器集群改善网站的并发处理能力</li>
<li>数据库读写分离</li>
<li>使用反向代理和 CDN 加速网站响应</li>
<li>使用分布式文件系统和分布式数据库系统</li>
<li>使用 NoSQL 和搜索引擎</li>
<li>业务拆分</li>
<li>分布式服务</li>
</ul>
<h1 id="高并发系统设计的三大目标"><a href="#高并发系统设计的三大目标" class="headerlink" title="高并发系统设计的三大目标"></a>高并发系统设计的三大目标</h1><h2 id="高性能"><a href="#高性能" class="headerlink" title="高性能"></a>高性能</h2><h3 id="性能的度量指标"><a href="#性能的度量指标" class="headerlink" title="性能的度量指标"></a>性能的度量指标</h3><ul>
<li>平均值：把这段时间所有请求的响应时间数据相加，再除以总请求数。</li>
<li>最大值：这段时间内所有请求响应时间最长的值。</li>
<li>分位值：</li>
</ul>
<h3 id="高并发下的优化"><a href="#高并发下的优化" class="headerlink" title="高并发下的优化"></a>高并发下的优化</h3><ul>
<li>提高系统的处理核心数</li>
<li>减少单次任务的响应时间</li>
</ul>
<h2 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a>高可用</h2><h3 id="可用性的度量"><a href="#可用性的度量" class="headerlink" title="可用性的度量"></a>可用性的度量</h3><ul>
<li>MTBF：平均故障间隔</li>
<li>MTTR：故障的平均恢复时间<br><code>Availability=MTBF/(MTBF+MTTR)</code></li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li>故障转移</li>
<li>超时控制</li>
<li>降级</li>
<li>限流</li>
</ul>
<h3 id="系统运维"><a href="#系统运维" class="headerlink" title="系统运维"></a>系统运维</h3><ul>
<li>灰度发布</li>
<li>故障演练</li>
</ul>
<h2 id="可扩展"><a href="#可扩展" class="headerlink" title="可扩展"></a>可扩展</h2><ul>
<li>并发：在某个时间点，有多个访问同时到来</li>
<li>高并发：如果一个系统日PV在千万以上，有可能是一个高并发系统</li>
<li>QPS：每秒钟请求或者查询的数量，在互联网领域，指每秒请求数（HTTP请求）</li>
<li>吞吐量：单位时间内处理的请求数量（通常由QPS并发数决定）</li>
<li>响应时间：从请求发出到响应花费的时间</li>
<li>PV：综合浏览量（Page View），一个访客在24小时内访问的页面数量，同一个人浏览你的网站同一页面，只记作一次PV</li>
<li>UV：独立访客（Unique Visitor），一定时间范围内相同访客多次访问网站，只计算为1个独立访客</li>
<li>带宽：峰值流量和页面平均大小 </li>
<li>日网站带宽=PV/统计时间（换算到秒）* 平均页面大小（单位kb）* 8 峰值一般是平均值的倍数</li>
<li>峰值QPS=（总PV数 * 80%）/（6个小时秒数 * 20%）</li>
<li>压力测试 测试能承受的最大并发 最大承受的QPS值</li>
<li>常用性能测试工具</li>
<li>apache benchmark <ul>
<li>yum -y install http-tools</li>
<li>ab -c100 -n 5000 待测试网站 并发请求100次 总共请求5000次</li>
<li>测试机器与被测试机器分开</li>
</ul>
</li>
<li>QPS达到100时，数据库缓存，数据库负载均衡 达到800，CDN加速，负载均衡 1000，静态html缓存 2000 业务分离，分布式存储</li>
<li>流量优化 防盗链处理</li>
<li>前端优化：减少http请求 添加异步请求 启用浏览器缓存和文件压缩 CDN加速 动静分离，静态资源独立部署 独立图片服务器 反向代理</li>
<li>服务端优化：页面静态化 并发处理 队列处理 负载均衡 业务拆分</li>
<li>数据库优化：数据库缓存 分库分表 分区 读写分离 负载均衡</li>
<li>web服务器优化：负载均衡  </li>
</ul>
<h1 id="网站架构模式"><a href="#网站架构模式" class="headerlink" title="网站架构模式"></a>网站架构模式</h1><h2 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h2><ul>
<li>应用层</li>
<li>服务层</li>
<li>数据层</li>
</ul>
<h2 id="分割"><a href="#分割" class="headerlink" title="分割"></a>分割</h2><h2 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h2><ul>
<li>分布式应用和服务</li>
<li>分布式静态资源</li>
<li>分布式数据和存储</li>
<li>分布式计算</li>
</ul>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><ul>
<li>CDN</li>
<li>反向代理</li>
<li>本地缓存</li>
<li>分布式缓存</li>
</ul>
<h2 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h2><ul>
<li>提高系统可用性</li>
<li>加快网站响应速度</li>
<li>消除并发访问高峰</li>
</ul>
<h2 id="冗余"><a href="#冗余" class="headerlink" title="冗余"></a>冗余</h2><h2 id="自动化"><a href="#自动化" class="headerlink" title="自动化"></a>自动化</h2><h2 id="架构在新浪微博的应用"><a href="#架构在新浪微博的应用" class="headerlink" title="架构在新浪微博的应用"></a>架构在新浪微博的应用</h2><p>早期架构中，微博发布使用同步推模式，当粉丝多的时候，会引起大量的数据库写操作，超出数据库负载，系统性能急剧下降。后来改用 <strong>异步</strong> 推拉结合模式，用户发表微博后系统将微博写入消息队列后立即返回，消息队列消费者任务将微博推送给左右当前在线粉丝的订阅列表中，非在线用户登陆后再根据关注粉丝列表拉取微博订阅列表</p>
<h1 id="大型网站核心架构要素"><a href="#大型网站核心架构要素" class="headerlink" title="大型网站核心架构要素"></a>大型网站核心架构要素</h1><h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><h2 id="可用性"><a href="#可用性" class="headerlink" title="可用性"></a>可用性</h2><h2 id="伸缩性"><a href="#伸缩性" class="headerlink" title="伸缩性"></a>伸缩性</h2><h2 id="扩展性"><a href="#扩展性" class="headerlink" title="扩展性"></a>扩展性</h2><h2 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h2><h1 id="高性能-1"><a href="#高性能-1" class="headerlink" title="高性能"></a>高性能</h1><ul>
<li>响应时间</li>
<li>并发数</li>
<li>吞吐量</li>
<li>性能计数器</li>
</ul>
<h2 id="Web-前端性能优化"><a href="#Web-前端性能优化" class="headerlink" title="Web 前端性能优化"></a>Web 前端性能优化</h2><p>一般 Web 前端指网站业务逻辑之前的部分，包括浏览器加载、网站视图模型、图片服务、CDN 服务等，主要优化手段有优化浏览器访问、使用反向代理、CDN 等。</p>
<h3 id="浏览器访问优化"><a href="#浏览器访问优化" class="headerlink" title="浏览器访问优化"></a>浏览器访问优化</h3><ul>
<li>减少 http 请求：合并 css，js，图片。</li>
<li>使用浏览器缓存：通过设置 HTTP头中 Cache-Control 和 Expires 的属性，可设定浏览器缓存。</li>
<li>启用压缩：对 HTML、CSS、JavaScript 文件启用 GZip 压缩可达到较好的效果。</li>
<li>CSS放页面最上面，JavaScript  放页面最下面。</li>
<li>减少 Cookie 传输</li>
</ul>
<h3 id="CDN-加速"><a href="#CDN-加速" class="headerlink" title="CDN 加速"></a>CDN 加速</h3><p>CDN（内容分发网络）的本质仍然是一个缓存，并且将数据缓存在离用户最近的地方，是用户以最快速度获取数据，即所谓网络访问第一跳。CDN 能够缓存的一般是静态资源。</p>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>传统代理服务器位于浏览器一侧，代理浏览器将 HTTP 请求发到互联网上，而反向代理服务器位于网络机房一侧，代理网站 Web 服务器接收 HTTP 请求。</p>
<p><img src="http://q6z2k96rl.bkt.clouddn.com/Fp8dKB_0fsFQ8n7hJtxKr982AiQF" alt=""></p>
<p>反向代理的作用：</p>
<ul>
<li>保护网站安全</li>
<li>配置缓存加速 Web 请求</li>
<li>负载均衡</li>
</ul>
<h2 id="应用服务器性能优化"><a href="#应用服务器性能优化" class="headerlink" title="应用服务器性能优化"></a>应用服务器性能优化</h2><p>应用服务器就是处理网站业务的服务器，网站的业务代码都部署在这里。优化手段主要有缓存、集群、异步等。</p>
<h3 id="分布式缓存"><a href="#分布式缓存" class="headerlink" title="分布式缓存"></a>分布式缓存</h3><p>当网站遇到性能瓶颈时，第一个想到的解决方案就是使用缓存。缓存即存在于浏览器，也存在于应用服务器和数据库服务器；既可以对数据缓存，也可以对文件缓存，还可以对页面片段缓存。</p>
<blockquote>
<p>网站优化第一定律：优先考虑使用缓存优化性能。</p>
</blockquote>
<h3 id="异步操作"><a href="#异步操作" class="headerlink" title="异步操作"></a>异步操作</h3><p>使用消息队列将调用异步化，可改善网站的的性能和扩展性。</p>
<p><img src="http://q6z2k96rl.bkt.clouddn.com/FiGYqtyrGv4BUNdDv6j317FxYwwn" alt=""></p>
<p>在不使用消息队列的情况下，用户的请求数据直接写入数据库，在高并发的情况下，会对数据库造成巨大的压力，同时也使得响应延迟加剧。在使用消息队列后，用户请求的数据发送给消息队列后立即返回，再用消息队列的消费者进程从消息队列中获取数据，异步写入数据库。</p>
<h3 id="使用集群"><a href="#使用集群" class="headerlink" title="使用集群"></a>使用集群</h3><p>在网站高并发访问的场景下，使用负载均衡技术为一个应用构建一个由多台服务器组成的服务器集群，将并发访问请求分发到多台服务器上处理，避免单一服务器因负载压力过大而响应缓慢，使用户请求具有更好的响应延迟特性。</p>
<h3 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h3><ul>
<li>多线程</li>
<li>资源复用：单例模式、对象池</li>
</ul>
<h1 id="高可用-1"><a href="#高可用-1" class="headerlink" title="高可用"></a>高可用</h1><p>应用层主要处理网站应用的业务逻辑，因此有时也称作业务逻辑层，应用的一个显著特点是应用的无状态性。无状态的应用是指应用服务器不保存业务的上下文信息，而仅根据每次请求提交的数据进行相应的业务逻辑处理，多个服务实例之间完全对等，请求提交到任意服务器，处理结果都是完全一样的。</p>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>负载均衡会把用户发送的访问请求分发到任意一台服务器上处理，当其中一台服务器宕机时，负载均衡服务器通过心跳检测机制发现该服务失去响应，就是把它从服务器列表中删除，而将请求发送到其他服务器上。</p>
<h2 id="集群的-Session-管理"><a href="#集群的-Session-管理" class="headerlink" title="集群的 Session 管理"></a>集群的 Session 管理</h2><p>应用层服务器的高可用架构设计主要基于服务无状态这一特性，但是事实上，业务总是有状态的。Web 应用中将这些多次请求修改使用的上下文对象称作会话（Session），单机情况下，Session 可由部署在服务器上的 Web 容器。在使用负载均衡的集群环境中，要保证每次请求能够获得正确的 Session 比单机时要复杂的多。以下是几种 Session 管理手段。</p>
<h3 id="Session-复制"><a href="#Session-复制" class="headerlink" title="Session 复制"></a>Session 复制</h3><p>应用服务器开启 Web 容器的 Session 复制功能，在集群中的几台服务器之间同步 Session 对象，使得每台服务器上都保存所有用户的 Session 信息。</p>
<p>这种方式需要大量的通信进行 Session 复制，占用服务器和网络大量资源，而且由于所有用户的 Session 信息在每台服务器上都有备份，在大量用户访问的情况下，甚至会出现服务器内存不够的情况。</p>
<h3 id="Session-绑定"><a href="#Session-绑定" class="headerlink" title="Session 绑定"></a>Session 绑定</h3><p>Session 绑定可以利用负载均衡的源地址 Hash 算法实现，负载均衡服务器总是将来源于同一 IP 的请求分发到同一台服务器上。（也可以根据 Cookie 信息将同一个用户的请求总是分发到同一台服务器上，这时负载均衡服务器必须工作在 HTTP 协议层上。这种方法又叫会话黏滞）。</p>
<p>这种方法不符合对系统高可用的需求，一旦一台服务器宕机，就无法完成业务处理。</p>
<h3 id="利用-Cookie-记录-Session"><a href="#利用-Cookie-记录-Session" class="headerlink" title="利用 Cookie 记录 Session"></a>利用 Cookie 记录 Session</h3><p>将 Session 记录在客户端，每次请求服务器的时候，将 Session 放在请求中发送给服务器，服务器处理完请求后再将修改过的 Session 响应给客户端。</p>
<p>利用 Cookie 记录 Session 也有一些缺点，比如受 Cookie 大小限制，每次请求响应都要传输 Cookie，影响性能。如果用户关闭 Cookie，访问就会不正常。</p>
<h3 id="Session-服务器"><a href="#Session-服务器" class="headerlink" title="Session 服务器"></a>Session 服务器</h3><p><img src="http://q6z2k96rl.bkt.clouddn.com/FmPftMWCO3lnbpXIq0tYOZkJHrXO" alt=""></p>
<p>利用独立部署的 Session 服务器（集群）统一管理 Session，应用服务器每次读写 Session 时，都访问 Session 服务器。</p>
<p>这种解决方案事实上是将应用服务器的状态分离，分为无状态的应用服务器和有状态的 Session 服务器，然后针对这两种服务器的不同特性分别设计其架构。</p>
<p>对于有状态的 Session 服务器，一种比较简单的方法是利用分布式缓存，数据库等，在这些产品的基础上进行包装，使其符合 Session 的存储和访问要求。</p>
<h2 id="高可用的服务"><a href="#高可用的服务" class="headerlink" title="高可用的服务"></a>高可用的服务</h2><h3 id="分级管理"><a href="#分级管理" class="headerlink" title="分级管理"></a>分级管理</h3><p>运维上将服务进行分级管理，核心应用和服务优先使用更好的硬件。</p>
<p>服务部署上进行必要的隔离，避免故障的连锁反应。低优先级的服务通过启动不同的线程或者部署在不同的虚拟机上进行隔离，而高优先级的服务则需要部署在不同的物理机上，核心服务和数据甚至需要部署在不同地域的数据中心。</p>
<h3 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h3><p>在应用程序中设置服务调用超时时间，一旦超时，同i性能框架就抛出异常，应用程序根据服务调度策略，可选择重试或将请求转移到提供相同服务的其他服务器上。</p>
<h3 id="异步调用"><a href="#异步调用" class="headerlink" title="异步调用"></a>异步调用</h3><p>通过消息队列等异步方式完成，避免一个服务失败导致整个应用请求失败的情况。</p>
<h3 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a>服务降级</h3><p>在网站访问高峰期，服务可能因为大量的并发调用而性能下降，严重时可能会导致服务宕机。为了保证核心应用和功能的正常运行，需要对服务进行降级。降级有两种手段：拒绝服务及关闭服务。</p>
<ul>
<li>拒绝服务：拒绝低优先级应用的调用，减少服务调用并发数，确保核心应用正常使用。或者随即拒绝部分请求应用，节约资源，让另一部分请求得以成功。</li>
<li>关闭服务：关闭部分不重要的服务，以节约系统开销，为重要的服务和功能让出资源。</li>
</ul>
<h3 id="幂等性设计"><a href="#幂等性设计" class="headerlink" title="幂等性设计"></a>幂等性设计</h3><p>应用调用服务失败后，会将调用请求重新发送到其他服务器，但是这个失败可能是虚假的失败。比如服务已经处理成功，但因为网络故障应用没有收到响应，这时应用重新提交请求就导致服务重复调用。</p>
<p>服务重复调用是无法避免的，因此必须在服务处保证服务重复调用和调用一次产生的结果相同，即服务具有幂等性。</p>
<h2 id="高可用的数据"><a href="#高可用的数据" class="headerlink" title="高可用的数据"></a>高可用的数据</h2><p>保证数据存储高可用的手段主要是数据备份和失效状态转移机制。</p>
<h3 id="CAP-原理"><a href="#CAP-原理" class="headerlink" title="CAP 原理"></a>CAP 原理</h3><p>CAP 原理认为，一个提供数据服务的存储系统无法同时满足一致性（Consistency）、数据可用性（Availability）、分区容错性（Partition Tolerance）。</p>
<ul>
<li>一致性：所用应用程序都能访问得到相同的数据</li>
<li>可用性：任何时候，任何应用程序都可以读写访问</li>
<li>分区容错性：系统可以跨网络分区线性伸缩</li>
</ul>
<p>为了保证数据的高可用，网站通常会牺牲数据一致性。</p>
<p>数据一致性又可分为：强一致、用户一致、最终一致。</p>
<h3 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h3><ul>
<li>冷备</li>
<li>异步热备</li>
<li>同步热备</li>
</ul>
<h3 id="失效转移"><a href="#失效转移" class="headerlink" title="失效转移"></a>失效转移</h3><p>失效转移操作由三部分组成：</p>
<ul>
<li>失效确认：系统确认一台服务器是否宕机的手段有两种：<strong>心跳检测和应用程序访问失败报告</strong>。对于应用程序访问失败报告，控制中心还需要再一次发送心跳检测进确认，以免错误判断服务器宕机。</li>
<li>访问转移：将数据读写访问重新路由到其他服务器上。</li>
<li>数据恢复</li>
</ul>
<h1 id="伸缩性-1"><a href="#伸缩性-1" class="headerlink" title="伸缩性"></a>伸缩性</h1><p>负载均衡不但可以实现网站的伸缩性，同时还可以改善网站的可用性。</p>
<h2 id="负载均衡的实现技术"><a href="#负载均衡的实现技术" class="headerlink" title="负载均衡的实现技术"></a>负载均衡的实现技术</h2><h3 id="HTTP-重定向"><a href="#HTTP-重定向" class="headerlink" title="HTTP 重定向"></a>HTTP 重定向</h3><p><img src="http://q6z2k96rl.bkt.clouddn.com/FpABIO0yaE4qvUlnw9l_ETBRkNwL" alt=""></p>
<p>HTTP 重定向服务器就是一台普通的应用服务器，其唯一功能就是根据用户的 HTTP 请求计算一台真是的 Web 服务器地址，并将该 Web 服务器地址写入 HTTP 重定向响应（ 302）中返回给用户浏览器。</p>
<ul>
<li>优点：实现比较简单</li>
<li>缺点：是浏览器需要请求两次服务器才能完成一次访问，性能较差。</li>
</ul>
<h3 id="DNS-域名解析"><a href="#DNS-域名解析" class="headerlink" title="DNS 域名解析"></a>DNS 域名解析</h3><p><img src="http://q6z2k96rl.bkt.clouddn.com/FsLQ4rXQzzCQKPN5orpI90dA0tr6" alt=""></p>
<p>在 DNS 服务器中配置多个 A 记录，每次域名解析请求都会根据负载均衡算法计算一个不同的 IP 地址返回。这样 A 记录中配置的多个服务器就会构成一个集群，并实现负载均衡。</p>
<ul>
<li>优点：是将负载均衡的工作转交给 DNS，同时许多 NDS 还支持基于地理位置的域名解析，会将域名解析成距离用户地理最近的一个服务器，加快用户访问速度。</li>
<li>缺点：DNS 是多级解析，每一级 DNS 都可能缓存 A 记录，当下线某台服务器修改了 A 记录后，使其生效也需要较长时间，这段时间 DNS 依然会将域名解析到已经下线的服务器，导致用户访问失败。</li>
</ul>
<h3 id="反向代理-1"><a href="#反向代理-1" class="headerlink" title="反向代理"></a>反向代理</h3><p><img src="http://q6z2k96rl.bkt.clouddn.com/Fi4JNF39iL0S4VTm5SiWzPmT6VW9" alt=""></p>
<p>反向代理服务器将请求根据负载均衡算法转发到不同 Web 服务器上。Web 服务器处理完成的响应也需要反向代理服务器返回给用户，由于 Web 服务器不直接对外提供访问，因此需不要使用外部 IP 地址，而反向代理服务器需要配置内外网 IP。</p>
<p>反向代理服务器转发请求在 HTTP 协议层面，因此也叫应用层负载均衡。</p>
<ul>
<li>优点：和反向代理服务器功能集成在一起，部署简单。</li>
<li>缺点：反向代理服务器是所有请求和相应的中转站，其性能可能会成为瓶颈。</li>
</ul>
<h3 id="IP-负载均衡"><a href="#IP-负载均衡" class="headerlink" title="IP 负载均衡"></a>IP 负载均衡</h3><p><img src="http://q6z2k96rl.bkt.clouddn.com/Fnrymkqn1-ouoAJjOKpOtLYKAG0Q" alt=""></p>
<p>在<strong>网络层</strong>通过修改请求目标地址进行负载均衡。</p>
<ul>
<li>优点：在内核进程内完成数据分发，较反向代理有更好的处理性能。</li>
<li>缺点：集群的最大响应数据吞吐量受限于负载均衡服务器网卡带宽。</li>
</ul>
<h3 id="直接路由"><a href="#直接路由" class="headerlink" title="直接路由"></a>直接路由</h3><p><img src="http://q6z2k96rl.bkt.clouddn.com/FnAOZ6qilLNMoGZ_3NeFXpIp7cmO" alt=""></p>
<p>是指在通信协议的数据链路层修改 mac 地址进行负载均衡，这种传输方式又称三角传输模式。实际请求的正是物理服务器 IP 和数据请求目的 IP 一致，不需要通过负载均衡服务器进行地址转换。</p>
<p>这种三角传输模式的链路层负载均衡是目前大型网站使用最广的一种负载均衡手段。在 Linux 平台上最好的链路层负载均衡开源产品是 LVS（Linux Virtual Server）。</p>
<ul>
<li>优点：避免负载均衡服务器网卡带宽称为瓶颈。</li>
</ul>
<h2 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h2><h3 id="轮询（-Round-Robin，RR）"><a href="#轮询（-Round-Robin，RR）" class="headerlink" title="轮询（ Round Robin，RR）"></a>轮询（ Round Robin，RR）</h3><p>所有请求被依次分发到每台应用服务器上，即每台服务器需要处理的请求数目都相同，适合于所有服务器硬件都相同的场景。</p>
<h3 id="随机（-Random）"><a href="#随机（-Random）" class="headerlink" title="随机（ Random）"></a>随机（ Random）</h3><p>请求被随机分配到各个应用服务器。如果应用服务器硬件配置不同，也可以使用加权随机算法。</p>
<h3 id="最少连接（-Least-Connections）"><a href="#最少连接（-Least-Connections）" class="headerlink" title="最少连接（ Least Connections）"></a>最少连接（ Least Connections）</h3><p>记录每个应用服务器正在处理的连接数，将新的请求分发到最少链接的服务器上。最少连接算法也可以实现加权最少连接。</p>
<h3 id="源地址散列（-Source-Hashing）"><a href="#源地址散列（-Source-Hashing）" class="headerlink" title="源地址散列（ Source Hashing）"></a>源地址散列（ Source Hashing）</h3><p>根据请求来源的 IP 地址进行 Hash 计算，得到应用服务器。这样来自同一个 IP 渎职的请求总在同一个服务器上处理，该请求的上下文信息可以存储在这台服务器上，在一个绘画周期重复使用，从而实现会话粘滞。</p>
<h1 id="网站的安全架构"><a href="#网站的安全架构" class="headerlink" title="网站的安全架构"></a>网站的安全架构</h1><h2 id="XSS（跨站脚本攻击）"><a href="#XSS（跨站脚本攻击）" class="headerlink" title="XSS（跨站脚本攻击）"></a>XSS（跨站脚本攻击）</h2><p>黑客通过篡改网页，注入恶意 HTML 脚本，在用户浏览网页时，控制用户浏览器进行恶意操作的一种方式。</p>
<p>常见的 XSS 攻击类型有两种。</p>
<ul>
<li>反射型：攻击者诱使用户点击一个嵌入恶意脚本的链接，达到攻击目的。</li>
<li>持久性：黑客提交含有恶意脚本的请求，保存至被攻击的 Web 站点的数据库中，用户浏览网页时，恶意脚本被包含在正常页面中，达到攻击目的。</li>
</ul>
<h3 id="防范手段"><a href="#防范手段" class="headerlink" title="防范手段"></a>防范手段</h3><ul>
<li>过滤特殊字符</li>
<li>HttpOnly</li>
</ul>
<h3 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h3><ul>
<li>窃取用户的 Cookie</li>
<li>伪造虚假的输入表单片区个人信息</li>
<li>显示伪造的文章或者图片</li>
</ul>
<h3 id="防范手段-1"><a href="#防范手段-1" class="headerlink" title="防范手段"></a>防范手段</h3><ul>
<li>过滤特殊字符</li>
<li>HttpOnly：防止窃取 Cookie</li>
</ul>
<h2 id="CSRF-（跨站请求伪造）"><a href="#CSRF-（跨站请求伪造）" class="headerlink" title="CSRF （跨站请求伪造）"></a>CSRF （跨站请求伪造）</h2><h3 id="防范手段-2"><a href="#防范手段-2" class="headerlink" title="防范手段"></a>防范手段</h3><ul>
<li>检查 Refer 首部字段</li>
<li>添加校验 Token</li>
<li>输入验证码</li>
</ul>
<h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><h3 id="防范手段-3"><a href="#防范手段-3" class="headerlink" title="防范手段"></a>防范手段</h3><ul>
<li>使用参数化查询 preparedStatement</li>
<li>单引号转换</li>
</ul>
<h2 id="拒绝服务攻击（洪水攻击）"><a href="#拒绝服务攻击（洪水攻击）" class="headerlink" title="拒绝服务攻击（洪水攻击）"></a>拒绝服务攻击（洪水攻击）</h2><p>其目的在于使目标电脑的网络或系统资源耗尽，使服务暂时中断或停止，导致其正常用户无法访问。</p>
<p>分布式拒绝服务攻击（distributed denial-of-service attack，DDoS），指攻击者使用两个或以上被攻陷的电脑作为“僵尸”向特定的目标发动“拒绝服务”式攻击。</p>
<h3 id="防范手段-4"><a href="#防范手段-4" class="headerlink" title="防范手段"></a>防范手段</h3><ul>
<li>防火墙：防火墙可以设置规则，例如允许或拒绝特定通讯协议，端口或IP地址。当攻击从少数不正常的IP地址发出时，可以简单的使用拒绝规则阻止一切从攻击源IP发出的通信。</li>
</ul>
<h1 id="对于大流量的网站-您采用什么样的方法来解决访问量问题"><a href="#对于大流量的网站-您采用什么样的方法来解决访问量问题" class="headerlink" title="对于大流量的网站,您采用什么样的方法来解决访问量问题?"></a>对于大流量的网站,您采用什么样的方法来解决访问量问题?</h1><p>优化程序，优化数据库，如果程序和数据库已经最优化，使用以下解决方法：</p>
<ol>
<li>确定当前服务器设备是否满足流量需求。</li>
<li>使用Memcache缓存技术，把动态内容缓存到文件中，动态网页直接调用这些文件，而不必再访问数据库。</li>
<li>禁止外部盗链，图片和文件外部盗链会给服务器带来大量的负载压力，可以通过refer来禁止外部盗链，或者使用apache来配置禁止盗链。</li>
<li>控制大文件的下载，大文件的下载对于非SCSI硬盘来说会占用大量的资源，导致服务器的响应能力下降。</li>
<li>使用不同的主机分流主要流量，使服务器均衡负载。</li>
<li>使用流量统计软件统计分析网站流量，可以知道哪些地方耗费了大量的流量，哪些页面需要再进行优化。</li>
</ol>
<h2 id="系统如何支持高并发"><a href="#系统如何支持高并发" class="headerlink" title="系统如何支持高并发"></a>系统如何支持高并发</h2><ol>
<li>系统集群化部署</li>
<li>数据库分库分表 + 读写分离</li>
<li>缓存集群的引入</li>
<li>引入消息中间件集群</li>
</ol>
<h2 id="web资源防盗链"><a href="#web资源防盗链" class="headerlink" title="web资源防盗链"></a>web资源防盗链</h2><ul>
<li>概念：在自己的页面上战视一些并不在自己服务器上的内容</li>
<li>工作原理：<ol>
<li>通过Referer或者签名，检测目标网页访问的来源网页，如果是资源文件，则可以追踪到显示他的网址，一旦检测到来源不是本站即进行阻止或返回指定的页面</li>
<li>通过计算签名的方式，判断请求是否合法，如果合法则显示，否则返回错误信息</li>
</ol>
</li>
<li>Refer方法：Nginx模块ngx_http_refer_module用于阻挡来源非法的域名请求，Nginx指令valid_referers 全局变量$invaild_referer</li>
</ul>
<h2 id="减少http请求"><a href="#减少http请求" class="headerlink" title="减少http请求"></a>减少http请求</h2><ul>
<li>图片地图：将 5 个图片合并为一张图片，然后以位置定位超链接。把 HTTP 请求减少为一个</li>
<li>CSS Sprites：CSS 精灵，通过合并图片，指定 css 的 background-image 和 background-position 来显示元素 </li>
<li>合并脚本和样式表</li>
<li>图片使用 Base64编码</li>
</ul>
<h2 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h2><h3 id="缓存分类"><a href="#缓存分类" class="headerlink" title="缓存分类"></a>缓存分类</h3><p><a href="https://shaoshilei.com/2014-08/re-note-browser-cache-200-from-cache-and-304-summary.html" target="_blank" rel="noopener">浏览器缓存 200(from cache) 和 304</a></p>
<ul>
<li>200 from cache：本地缓存（强制缓存），最快速，最省流量，因为根本没有向服务器发送请求。<br>  相关 Header<ul>
<li>Pragma：HTTP 1.0 时代的遗留产物，该字段被设置为 no-cacche 时，会告知浏览器禁用本地缓存</li>
<li>Expires：HTTP 1.0 时代来启用本地缓存的字段，值是一个格林威治时间，告诉浏览器缓存实现的时刻，如果还没到该时刻，则缓存有效，浏览器与服务器时间无法保持一致，如果时间差距大，就会影响缓存结果。</li>
<li>Cache-Control：HTTP 1.1 针对 Expires 时间不一致的解决方案，告知的是过期时间间隔，不是时刻。<ul>
<li>no-store：禁止浏览器缓存相应</li>
<li>no-cache：不允许直接使用本地缓存，先发起请求和服务器协商</li>
<li>max-age=delta-seconds：告知浏览器该响应本地缓存有效的最长期限，以秒为单位，如果和 Last-Modified 一起使用，优先级较高</li>
</ul>
</li>
<li>优先级：Pragma &gt; Cache-Control &gt; Expires</li>
</ul>
</li>
<li>304 Not Modified：协商缓存，浏览器在本地缓存没有命中的情况下请求头中发送一定的校验数据到服务端，如果服务端数据没有改变浏览器从本地缓存响应，返回 304。只返回一些响应头信息，不发送相应实体<br>  相关 Header<ul>
<li>Last-Modified（响应头）：通知浏览器资源的最后修改时间</li>
<li>If-Modified-Since（请求头）：得到资源的最后修改时间后，会将这个信息通过 If-Modified-Since（里面的值就是  Last-Modified） 提交到服务器做检查，如果没有修改，返回 304。</li>
<li>ETag：HTTP 1.1 推出，文件的指纹标识符，如果文件内容修改，值会改变。</li>
<li>If-None-Match：本地缓存失效，会携带 ETag 的值去请求服务端，服务端判断该资源是否改变，如果没有改变，直接使用本地缓存，返回 304。</li>
</ul>
</li>
</ul>
<h3 id="缓存策略的选择"><a href="#缓存策略的选择" class="headerlink" title="缓存策略的选择"></a>缓存策略的选择</h3><h4 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h4><ul>
<li>不变的图像：如 Logo</li>
<li>js，css 静态文件</li>
<li>可下载的内容，媒体文件</li>
</ul>
<h4 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h4><ul>
<li>HTML 文件</li>
<li>经常替换的图片</li>
<li>经常修改的 js，css：可以加入文件的签名来拒绝缓存，index.css?签名</li>
</ul>
<h4 id="不建议缓存的数据"><a href="#不建议缓存的数据" class="headerlink" title="不建议缓存的数据"></a>不建议缓存的数据</h4><ul>
<li>用户隐私等敏感信息</li>
<li>经常改变的 api 数据接口</li>
</ul>
<h3 id="Nginx-配置写法"><a href="#Nginx-配置写法" class="headerlink" title="Nginx 配置写法"></a>Nginx 配置写法</h3><pre class="line-numbers language-conf"><code class="language-conf">gzip on|off; #是否开启gzip
gzip_buffers 32 4K| 16 8K #缓冲(压缩在内存中缓冲几块? 每块多大?)
gzip_comp_level [1-9] #推荐6 压缩级别(级别越高,压的越小,越浪费CPU计算资源)
gzip_types text/plain application/xml # 对哪些类型的文件用压缩 如txt,xml,html ,css
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="前端代码和资源压缩"><a href="#前端代码和资源压缩" class="headerlink" title="前端代码和资源压缩"></a>前端代码和资源压缩</h2><ul>
<li>js 代码压缩工具：UglifyJS，YUI Compressor，Closure</li>
<li>css 压缩工具：YUI Compressor，CSS Compressor</li>
<li>使用 Gzip 压缩</li>
<li>图片压缩：tinypng，JpegMini，ImageOptim<pre class="line-numbers language-conf"><code class="language-conf">gzip on|off;
gzip_buffers 32 4k|16 8k;//缓冲（在内存中缓冲几块？每块多大）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
</ul>
<h2 id="web服务器的负载均衡"><a href="#web服务器的负载均衡" class="headerlink" title="web服务器的负载均衡"></a>web服务器的负载均衡</h2><ul>
<li><p>七层负载均衡的实现</p>
<ul>
<li>功能强大，性能卓越，运行稳定</li>
<li>配置简单灵活</li>
<li>能够自动剔除工作不正常的后端服务器</li>
<li>上传文件使用异步模式</li>
<li>指出多种分配策略，可以分配权重，分配方式灵活</li>
</ul>
</li>
<li><p>四层负载均衡的实现</p>
</li>
<li><p>Nginx的负载均衡</p>
<ul>
<li>内置策略：IP Hash、加权轮询</li>
<li>扩展策略：fair策略，通用hash、一致性hash</li>
</ul>
<h2 id="CDN-加速-1"><a href="#CDN-加速-1" class="headerlink" title="CDN 加速"></a>CDN 加速</h2><p>CDN 的全称是 Content Delivery Network，即内容分发网络。在网络各处放置节点服务器所构成的在现有的互联网基础上的一层只能虚拟网络。</p>
</li>
</ul>
<p>CDN 系统能够实时地根据网络流量和个节点的连接，负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。</p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>本地 Cache 加速，提高了企业站点（尤其含有大量图片和静态页面站点）的访问速度</li>
<li>跨运营商的网络加速，保证不同网络的用户都得到良好的访问质量</li>
<li>远程访问用户根据 DNS 负载均衡技术自动选择 Cache 服务器</li>
<li>自动生成服务器的远程 Mirror（镜像）cache 服务器，减轻远程访问的带宽，分担网络流量， 减轻原站点 WEB 服务器负载</li>
<li>广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵</li>
</ul>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><ul>
<li>站点或者应用中大量静态资源加速分发</li>
<li>大文件下载</li>
<li>直播网站</li>
</ul>
<h3 id="CDN-的实现"><a href="#CDN-的实现" class="headerlink" title="CDN 的实现"></a>CDN 的实现</h3><ul>
<li>使用现成的</li>
<li>用 LVS 做 4 层负载均衡</li>
<li>可用 Nginx，Varnish，Squid，Apache TrafficServer做 7 层负载均衡</li>
<li>使用 squid 做反向代理，或者 Nginx 等做反向代理</li>
</ul>
<h2 id="建立独立的图片服务器"><a href="#建立独立的图片服务器" class="headerlink" title="建立独立的图片服务器"></a>建立独立的图片服务器</h2><h3 id="必要性"><a href="#必要性" class="headerlink" title="必要性"></a>必要性</h3><ul>
<li>分担 Web 服务器的 I/O 负载，将耗费资源的图片服务分离出来，题搞服务器的性能和稳定性</li>
<li>能够专门对图片服务器进行优化，为图片服务设置有针对性的缓存方案每减少带宽成本，提高访问速度</li>
<li>提高网站的可扩展性，通过增加图片服务器，提高图片吞吐力</li>
</ul>
<h3 id="采用独立域名"><a href="#采用独立域名" class="headerlink" title="采用独立域名"></a>采用独立域名</h3><ul>
<li>同一域名下浏览器的并发链接数有限制，突破浏览器并发限制</li>
<li>由于 cookie 的原因，对缓存不利，大部分 web cache都只缓存不带 cookie 的请求，导致每次的图片请求都不能命中 cache</li>
</ul>
<h2 id="如何进行图片上传和同步"><a href="#如何进行图片上传和同步" class="headerlink" title="如何进行图片上传和同步"></a>如何进行图片上传和同步</h2><ul>
<li>NFS 共享方式</li>
<li>利用 FTP 同步</li>
</ul>
<h2 id="动态语言静态化"><a href="#动态语言静态化" class="headerlink" title="动态语言静态化"></a>动态语言静态化</h2><p>将现有 PHP 等动态语言的逻辑代码生成为静态 HTML 文件，用户访问动态脚本重定向到静态 HTML 文件的过程。<br>动态脚本通常会做逻辑和数据查询，访问量越大，服务器压力越大，CPU 负载过高，数据库服务器压力大。</p>
<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><ul>
<li>使用模板引擎</li>
<li>使用 ob 系列函数<ul>
<li>ob_start()：打开输出控制缓冲</li>
<li>ob_get_contents()：返回输出缓冲区的内容</li>
<li>ob_clean()：清空输出缓冲区</li>
<li>ob_end_flush()：冲刷出输出缓冲区内容并关闭缓冲</li>
</ul>
</li>
</ul>
<h2 id="动态语言层的并发处理"><a href="#动态语言层的并发处理" class="headerlink" title="动态语言层的并发处理"></a>动态语言层的并发处理</h2><ul>
<li>就绪状态：线程具备运行的所有条件，逻辑上可以运行，在等待处理机</li>
<li>运行状态：线程占有处理机正在运行</li>
<li>阻塞状态：线程在等待一个事件（如某个信号量），逻辑上不可执行</li>
</ul>
<h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><p>协程是一种用户态的轻量级线程，写成的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，再切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。</p>
<h3 id="线程和进程的区别"><a href="#线程和进程的区别" class="headerlink" title="线程和进程的区别"></a>线程和进程的区别</h3><ol>
<li>线程是进程内的一个执行单元，进程内至少有一个线程，他们共享进程的地址空间，而进程有自己独立的地址空间</li>
<li>进程是资源分配的基本单位，同一个进程内的线程共享进程的资源</li>
<li>线程是处理器调度的基本单位</li>
</ol>
<h3 id="线程与协程的区别"><a href="#线程与协程的区别" class="headerlink" title="线程与协程的区别"></a>线程与协程的区别</h3><ol>
<li>一个线程可以有多个协程，一个进程也可以单独拥有多个线程</li>
<li>线程进程都是同步机制，而协程是异步</li>
<li>协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态</li>
</ol>
<h2 id="数据库缓存层优化"><a href="#数据库缓存层优化" class="headerlink" title="数据库缓存层优化"></a>数据库缓存层优化</h2><h2 id="MySQL-数据层优化"><a href="#MySQL-数据层优化" class="headerlink" title="MySQL 数据层优化"></a>MySQL 数据层优化</h2><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651961829&idx=1&sn=6992d6e36abf3c2918fc3e743b96abed&chksm=bd2d0c398a5a852f97a4fd6cd078486a27311e71d825073003d06969440337f32ef6a856c9f0&scene=21#wechat_redirect" target="_blank" rel="noopener">“反向代理层”绝不能替代“DNS轮询”！</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/06/10/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%A4%A7%E6%B5%81%E9%87%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-id="ckd5czhiv004tnnnr34754ozw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" rel="tag">高并发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-剑指Offer-字符串、数组" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/10/%E5%89%91%E6%8C%87Offer-%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%81%E6%95%B0%E7%BB%84/" class="article-date">
  <time datetime="2019-06-10T08:03:03.000Z" itemprop="datePublished">2019-06-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/10/%E5%89%91%E6%8C%87Offer-%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%81%E6%95%B0%E7%BB%84/">剑指Offer-字符串、数组相关</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="5-替换空格"><a href="#5-替换空格" class="headerlink" title="5. 替换空格"></a><a href="https://leetcode-cn.com/problems/ti-huan-kong-ge-lcof/" target="_blank" rel="noopener">5. 替换空格</a></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> String <span class="token function">replaceSpace</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> blank <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span>
            blank<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> newLen <span class="token operator">=</span> len <span class="token operator">+</span> blank <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">char</span><span class="token punctuation">[</span>newLen<span class="token punctuation">]</span><span class="token punctuation">;</span>
    newLen<span class="token operator">--</span><span class="token punctuation">;</span>
    len<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>len <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> newLen <span class="token operator">>=</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> c <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>len<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newStr<span class="token punctuation">[</span>newLen<span class="token operator">--</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
            newStr<span class="token punctuation">[</span>newLen<span class="token operator">--</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">;</span>
            newStr<span class="token punctuation">[</span>newLen<span class="token operator">--</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'%'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            newStr<span class="token punctuation">[</span>newLen<span class="token operator">--</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="19-正则表达式匹配"><a href="#19-正则表达式匹配" class="headerlink" title="19. 正则表达式匹配"></a><a href="https://leetcode-cn.com/problems/zheng-ze-biao-da-shi-pi-pei-lcof/" target="_blank" rel="noopener">19. 正则表达式匹配</a></h2><p><a href="https://leetcode-cn.com/problems/regular-expression-matching/" target="_blank" rel="noopener">leetcode 10</a></p>
<h2 id="20-表示数值的字符串"><a href="#20-表示数值的字符串" class="headerlink" title="20. 表示数值的字符串"></a><a href="https://leetcode-cn.com/problems/biao-shi-shu-zhi-de-zi-fu-chuan-lcof/" target="_blank" rel="noopener">20. 表示数值的字符串</a></h2><p><a href="https://leetcode-cn.com/problems/valid-number/" target="_blank" rel="noopener">leetcode 65</a></p>
<h2 id="38-字符串的排列"><a href="#38-字符串的排列" class="headerlink" title="38. 字符串的排列"></a><a href="https://leetcode-cn.com/problems/zi-fu-chuan-de-pai-lie-lcof/" target="_blank" rel="noopener">38. 字符串的排列</a></h2><pre class="line-numbers language-java"><code class="language-java">List<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Integer<span class="token operator">>></span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Deque<span class="token operator">&lt;</span>Integer<span class="token operator">></span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Integer<span class="token operator">>></span> <span class="token function">permuteUnique</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Arrays<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> used <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">boolean</span><span class="token punctuation">[</span>nums<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> used<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> used<span class="token punctuation">)</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> pre <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>used<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> pre <span class="token operator">!=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            used<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">dfs</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> used<span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">removeLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            used<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            pre <span class="token operator">=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>相关题目：<a href="https://leetcode-cn.com/problems/permutations-ii/" target="_blank" rel="noopener">leetcode 47</a></li>
</ul>
<h2 id="46-把数字翻译成字符串"><a href="#46-把数字翻译成字符串" class="headerlink" title="46. 把数字翻译成字符串"></a><a href="https://leetcode-cn.com/problems/ba-shu-zi-fan-yi-cheng-zi-fu-chuan-lcof/" target="_blank" rel="noopener">46. 把数字翻译成字符串</a></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">numDecodings</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> null <span class="token operator">||</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    dp<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dp<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        dp<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">26</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> dp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>相关题目：<a href="https://leetcode-cn.com/problems/decode-ways/" target="_blank" rel="noopener">leetcide 91</a></li>
</ul>
<h2 id="48-最长不含重复字符的子字符串"><a href="#48-最长不含重复字符的子字符串" class="headerlink" title="48. 最长不含重复字符的子字符串"></a><a href="https://leetcode-cn.com/problems/zui-chang-bu-han-zhong-fu-zi-fu-de-zi-zi-fu-chuan-lcof/" target="_blank" rel="noopener">48. 最长不含重复字符的子字符串</a></h2><p><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/" target="_blank" rel="noopener">leetcode 3</a></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">lengthOfLongestSubstring</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hash<span class="token punctuation">[</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            j <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>hash<span class="token punctuation">[</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> i <span class="token operator">-</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hash<span class="token punctuation">[</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="50-第一个只出现一次的字符位置"><a href="#50-第一个只出现一次的字符位置" class="headerlink" title="50. 第一个只出现一次的字符位置"></a><a href="https://leetcode-cn.com/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/" target="_blank" rel="noopener">50. 第一个只出现一次的字符位置</a></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">char</span> <span class="token function">firstUniqChar</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> null <span class="token operator">||</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">[</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">[</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>相关题目：<a href="https://leetcode-cn.com/problems/first-unique-character-in-a-string/" target="_blank" rel="noopener">leetcode 387</a></li>
</ul>
<h2 id="58-1-翻转单词顺序列"><a href="#58-1-翻转单词顺序列" class="headerlink" title="58.1 翻转单词顺序列"></a><a href="https://leetcode-cn.com/problems/fan-zhuan-dan-ci-shun-xu-lcof/" target="_blank" rel="noopener">58.1 翻转单词顺序列</a></h2><p><a href="https://leetcode-cn.com/problems/reverse-words-in-a-string/" target="_blank" rel="noopener">leetcode 151</a></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> String <span class="token function">reverseWords</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> length <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reverse</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 翻转单词</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 找到第一个字母</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;</span> length <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            start<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        end <span class="token operator">=</span> start<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&lt;</span> length <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            end<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">reverse</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        start <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// 清除空格</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> length <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            j<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> length <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> length <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            j<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> temp <span class="token operator">=</span> c<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">;</span>
        c<span class="token punctuation">[</span>start<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">;</span>
        c<span class="token punctuation">[</span>end<span class="token operator">--</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="58-2-左旋转字符串"><a href="#58-2-左旋转字符串" class="headerlink" title="58.2 左旋转字符串"></a><a href="https://leetcode-cn.com/problems/zuo-xuan-zhuan-zi-fu-chuan-lcof/" target="_blank" rel="noopener">58.2 左旋转字符串</a></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> String <span class="token function">LeftRotateString</span><span class="token punctuation">(</span>String str<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">==</span> null <span class="token operator">||</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> c <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reverse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reverse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//只能最后翻转整体</span>
    <span class="token function">reverse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> temp <span class="token operator">=</span> c<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">;</span>
        c<span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">;</span>
        c<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
        start<span class="token operator">++</span><span class="token punctuation">;</span>
        end<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><h2 id="12-矩阵中的路径"><a href="#12-矩阵中的路径" class="headerlink" title="12. 矩阵中的路径"></a><a href="https://leetcode-cn.com/problems/ju-zhen-zhong-de-lu-jing-lcof/" target="_blank" rel="noopener">12. 矩阵中的路径</a></h2><p><a href="https://leetcode-cn.com/problems/word-search/" target="_blank" rel="noopener">leetcode 79</a></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> flag<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">exist</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> board<span class="token punctuation">,</span> String word<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">boolean</span><span class="token punctuation">[</span>board<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">[</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> board<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> board<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>board<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> word<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dfs</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span> word<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> board<span class="token punctuation">,</span> String word<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">>=</span> board<span class="token punctuation">.</span>length <span class="token operator">||</span> j <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> j <span class="token operator">>=</span> board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">||</span> board<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> word<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    index<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span> word<span class="token punctuation">,</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">dfs</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span> word<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>
            <span class="token operator">||</span> <span class="token function">dfs</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span> word<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">dfs</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span> word<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="13-机器人的运动范围"><a href="#13-机器人的运动范围" class="headerlink" title="13. 机器人的运动范围"></a><a href="https://leetcode-cn.com/problems/ji-qi-ren-de-yun-dong-fan-wei-lcof/" target="_blank" rel="noopener">13. 机器人的运动范围</a></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> flag<span class="token punctuation">;</span>
<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">movingCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> k <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    flag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">boolean</span><span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> j <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">>=</span> m <span class="token operator">||</span> j <span class="token operator">>=</span> n <span class="token operator">||</span> flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">></span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res <span class="token operator">+=</span> n <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
        n <span class="token operator">/=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="29-顺时针打印矩阵"><a href="#29-顺时针打印矩阵" class="headerlink" title="29. 顺时针打印矩阵"></a><a href="https://leetcode-cn.com/problems/shun-shi-zhen-da-yin-ju-zhen-lcof/" target="_blank" rel="noopener">29. 顺时针打印矩阵</a></h2><p><a href="https://leetcode-cn.com/problems/spiral-matrix/" target="_blank" rel="noopener">leetcode 54</a></p>
<h2 id="47-礼物的最大价值"><a href="#47-礼物的最大价值" class="headerlink" title="47. 礼物的最大价值"></a><a href="https://leetcode-cn.com/problems/li-wu-de-zui-da-jie-zhi-lcof/" target="_blank" rel="noopener">47. 礼物的最大价值</a></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxValue</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>grid <span class="token operator">==</span> null <span class="token operator">||</span> grid<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">:</span> grid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="66-构建乘积数组"><a href="#66-构建乘积数组" class="headerlink" title="66. 构建乘积数组"></a><a href="https://leetcode-cn.com/problems/gou-jian-cheng-ji-shu-zu-lcof/" target="_blank" rel="noopener">66. 构建乘积数组</a></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/06/10/%E5%89%91%E6%8C%87Offer-%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%81%E6%95%B0%E7%BB%84/" data-id="ckd5czhid0032nnnrcs7g519m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%91%E6%8C%87Offer/" rel="tag">剑指Offer</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-面试知识点" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/16/%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/" class="article-date">
  <time datetime="2019-05-16T01:03:46.000Z" itemprop="datePublished">2019-05-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/16/%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/">面试知识点</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>根据 cyc2018 的 <a href="https://xiaozhuanlan.com/topic/3057621498" target="_blank" rel="noopener">一文帮你理清面试知识点</a> 和 <a href="http://zhangchangle.com" target="_blank" rel="noopener">博客</a> 以及其他资料整理而成。</p>
<h1 id="💻操作系统"><a href="#💻操作系统" class="headerlink" title="💻操作系统"></a>💻操作系统</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>★★★ 进程与线程的本质区别、以及各自的使用场景</p>
<ul>
<li>拥有资源：进程是资源分配的基本单位，但是线程不拥有资源，线程可以访问隶属进程的资源。</li>
<li>调度：线程是独立调度的基本单位，在同一进程中，线程的切换不会引起进程切换，从一个进程中的线程切换到另一个进程中的线程时，会引起进程切换。</li>
<li>系统开销：由于创建或撤销进程时，系统都要为之分配或回收资源，如内存空间、I/O设备等，所付出的开销远大于创建或撤销线程时的开销。类似地，在进程切换时，涉及当前执行进程 CPU 环境的保存及新调度进程 CPU 环境的设置，而线程切换时只需保存和设置少量寄存器内容，开销很小。</li>
<li>通信方面：线程间通信可以通过直接读写同一进程中的数据进行通信，但是进程通信需要借助 IPC。</li>
</ul>
<p>★☆☆ 进程状态。</p>
<ul>
<li>就绪状态：等待被调度</li>
<li>运行状态</li>
<li>阻塞状态：等待资源</li>
<li>只有就绪和运行态可以相互转换，其他的都是单项转换。就绪状态的进程通过调度算法从而获得 CPU 时间，转为运行状态；而运行状态的进程，在分配给它的 CPU 时间片用完以后就会转为就绪状态，等待下一次调度</li>
<li>阻塞状态是缺少需要的资源从运行状态转换而来的，但是该资源不包括 CPU 时间，缺少 CPU 时间会从运行态转换为就绪态</li>
</ul>
<p>★★★ 进程调度算法的特点以及使用场景。</p>
<ul>
<li>先来先服务：有利于长作业不利于短作业</li>
<li>短作业优先：长作业可能会饿死</li>
<li>最短剩于时间优先：按估计剩于时间最短的顺序进行调度</li>
<li>时间片轮转：时间片轮转算法的效率和时间片大小有很大关系</li>
<li>优先级调度：</li>
<li>多级反馈队列：</li>
</ul>
<p>★☆☆ 线程实现的方式。</p>
<p>★★☆ 协程的作用。</p>
<p>★★☆ 常见进程同步问题。</p>
<p>★★★ 进程通信方法的特点以及使用场景。</p>
<ul>
<li>管道：无名管道是一种特殊的文件，只存在于内存中，只支持半双工通信，只能在父子进程中使用。</li>
<li>FIFO：命名管道，是 FIFO 文件，存在于文件系统中，去除了管道只能在父子进程中使用的限制。FIFO 常用于客户-服务器应用程序中，FIFO 用作汇聚点，在客户进程和服务器进程之间传递数据。</li>
<li>消息队列：相比于 FIFO，消息队列具有以下优点：<ul>
<li>消息队列可以独立于读写进程存在，从而避免了FIFO 中同步管道的打开和关闭时可能产生的困难。</li>
<li>避免了 FIFO 的同步阻塞问题，不需要进程自己提供同步方法</li>
<li>读进程可以根据消息类型有选择地接收消息，而不像 FIFO 那样只能默认地接收</li>
</ul>
</li>
<li>共享数据：允许多个进程共享一个给定的存储区。因为数据不需要在进程之间复制，所以这是最快的一种 IPC。需要使用信号量用来同步对共享存储的访问。多个进程可以将同一个文件映射到它们的地址空间从而实现共享内存。另外 XSI 共享内存不是使用文件，而是使用使用内存的匿名段。</li>
<li>信号量：它是一个计数器，用于为多个进程提供共享数据对象的访问。</li>
<li>套接字：与其它通信机制不同的是，它可用于不同机器间的进程通信。</li>
</ul>
<p>★★★ 死锁必要条件、解决死锁策略，能写出和分析死锁的代码，能说明在数据库管理系统或者 Java 中如何解决死锁。</p>
<ul>
<li>互斥</li>
<li>占有和等待</li>
<li>环路等待</li>
<li>不可抢占</li>
</ul>
<p>★★★ 虚拟内存的作用，分页系统实现虚拟内存原理。<br>虚拟内存的目的是为了让物理内存扩充成更大的逻辑内存，从而让程序获得更多的可用内存。<br>操作系统将内存抽象成为地址空间。每个程序拥有自己的地址空间，这个地址空间被分割成多个块，每一块称为一页。这些页被映射到物理内存，但不需要映射到连续的物理内存，也不需要所有页都必须在物理内存中。当程序引用到不在物理内存中的页时，由硬件执行必要的映射，将缺失的部分装入物理内存并重新执行失败的指令。</p>
<p>★★★ 页面置换算法的原理，特别是 LRU 的实现原理，最好能手写，再说明它在 Redis 等作为缓存置换算法。</p>
<ul>
<li>最佳</li>
<li>最近最久未使用 LRU：基于双向链表 + HashMap 的算法实现<ul>
<li>访问某个节点，将其从原来位置删除，并重新插入到链表头部。这样就能保证链表尾部存储的就是最近最久未使用的节点，当节点数量大于缓存最大空间时就淘汰链表尾部的节点</li>
<li>为了使删除操作的时间复杂度为 O(1)，就不能采用遍历的方式找到某个节点。HashMap 存储着 Key 到节点的映射，通过 Key 就能以 O(1) 的时间得到节点，然后再以 O(1) 的时间将其从双向队列中删除。</li>
</ul>
</li>
<li>最近未使用 NRU</li>
<li>先进先出 FIFO</li>
<li>第二次机会算法</li>
<li>时钟 CLOCK</li>
</ul>
<p>★★★ 比较分页与分段的区别。</p>
<ul>
<li>对程序员的透明性：分页透明，但是分段需要程序员显示划分每个段</li>
<li>地址空间的维度：分页是一维地址，分段是二维的</li>
<li>大小是否可以改变：页的大小不可变，段的大小可以动态改变</li>
<li>出现的原因：分页主要用于实现虚拟内存，从而获得更大的地址空间；分段主要是为了使程序和数据可以被划分为逻辑上独立的地址空间并且有助于共享和保护。</li>
</ul>
<p>★★★ 分析静态链接的不足，以及动态链接的特点。</p>
<ul>
<li>静态链接有两个问题：</li>
</ul>
<ol>
<li>当静态库更新时那么整个程序都要重新进行链接</li>
<li>对于 printf 这种标准函数库，如果每个程序都要有代码，这会造成极大浪费资源</li>
</ol>
<ul>
<li>动态链接的特点：</li>
</ul>
<ol>
<li>在给定的文件系统中一个库只有一个文件，所有引用该库的可执行目标文件都共享这个文件，它不会被复制到引用他们的可执行文件中</li>
<li>在内存中，一个共享库的 .text 节（以编译程序的机器代码）的一个副本可以被不同的正在运行的进程共享。</li>
</ol>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>★★☆ 文件系统的原理，特别是 inode 和 block。数据恢复原理。</p>
<ul>
<li>对分区进行格式化是为了在分区上建立文件系统。一个分区通常只能格式化为一个文件系统，但是磁盘阵列等技术可以将一个分区格式化为多个文件系统</li>
<li>inode：一个文件占用一个inode，记录文件属性，同时记录此文件的内容所在的block编号</li>
<li>block：记录文件的内容，文件太大时，会产生多个block</li>
<li>对于 Ext2 文件系统，当药读取一个文件的内容时，先在 inode 中去查找文件内容所在的所有block，然后把所有的 block 内容读取出来</li>
<li>对于 FAT 文件系统，它没有 inode ，每个 block 中存储着下一个 block 的编号</li>
<li>ext3/ext4 文件系统引入了日志功能，可以利用日志来修复文件系统</li>
<li>目录：建立一个目录时，会分配一个 inode 与至少一个 block。block 记录的是目录下所有文件的 inode 编号以及文件名。文件的 inode 本身不记录文件名，文件名记录在目录中。因此，拥有文件的 w 权限并不能对文件名进行修改</li>
</ul>
<p>★★★ 硬链接与软链接的区别。</p>
<ul>
<li>硬链接：在目录下创建一个条目，记录着文件名与 inode编号，这个 inode 就是源文件的 inode。不能跨越文件系统，不能对目录链接</li>
<li>软链接：软链接文件保存着原文件所在的绝对路径，在读取时会定位到源文件上。可以为目录链接</li>
</ul>
<p>★★☆ 能够使用常用的命令，比如 cat 文件内容查看、find 搜索文件，以及 cut、sort 等管线命令。了解 grep 和 awk 的作用。</p>
<ul>
<li>cat 取得文件内容</li>
<li>find 文件搜索。可以使用文件的属性和权限进行搜索</li>
<li>cut 对数据进行切分，取出想要的部分</li>
<li>sort 用于排序</li>
<li>grep 使用正则表达式进行全局查找并打印</li>
<li>awk 是一门模式匹配的编程语言，主要功能是用于匹配文本并处理。</li>
</ul>
<p>★★★ 僵尸进程与孤儿进程的区别，从 SIGCHLD 分析产生僵尸进程的原因。</p>
<ul>
<li>孤儿进程：一个父进程退出，而它的一个或多个子进程还在运行，那么这些子进程将会成为孤儿进程。孤儿进程将会被 init 进程（进程号为1）所收养，并由 init 进程对他们完成状态收集工作。由于孤儿进程会被 init 所收养，所以孤儿进程不会对系统造成危害</li>
<li>僵尸进程：如果子进程退出，而父进程并没有调用 wait() 或 waitpid()，那么子进程的进程描述符仍然保存在系统中，这种进程称之为僵尸进程。系统所能使用的进程号是有限的，如果产生大量僵尸进程，将因为没有可用的进程号而导致系统不能产生新的进程。要消灭系统中大量的僵尸进程，只需要将其父进程杀死，此时僵尸进程就会变成孤儿进程，从而被 init 所收养，这样 init 就会释放所有的僵尸进程所占有的资源，从而结束僵尸进程。</li>
<li>SIGCHLD：当一个子进程改变了他的状态时，父进程会得到 SIGCHLD 信号，waitpid() 或者 wait()调用会返回。其中子进程发送的 SIGCHLD 信号包含了子进程的信息，比如进程 ID、进程状态、进程使用 CPU 的时间等。在子进程退出时，他的进程描述符不会立即释放，这是为了让父进程得到子进程信息，父进程通过 wait() 和 waitpid() 来获得一个已经退出的子进程的信息。</li>
</ul>
<h1 id="☁️网络"><a href="#☁️网络" class="headerlink" title="☁️网络"></a>☁️网络</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><p>★★★ 各层协议的作用，以及 TCP/IP 协议的特点。</p>
<ul>
<li>应用层：为特定应用程序提供数据传输服务。 HTTP、DNS。</li>
<li>传输层：为进程提供通用数据传输服务。运输层包括两种协议：传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP 主要提供完整性服务，UDP 主要提供及时性服务。</li>
<li>网络层：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递下来的报文段或者用户数据报封装成分组。</li>
<li>数据链路层：为同一链路的主机提供数据传输服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成帧。</li>
<li>物理层：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。</li>
<li>TCP/IP：只有四层，相当于五层协议中数据链路层和物理层合并为网络接口层。TCP/IP 协议体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层。</li>
</ul>
<p>★★☆ 以太网的特点，以及帧结构。</p>
<ul>
<li>以太网是一种星型拓扑结构局域网。</li>
<li>以太网帧格式</li>
<li>类型：标记上层使用的协议；</li>
<li>数据：长度在 46-1500 之间秒如果太小则需要填充；</li>
<li>FCS：帧检验序列，使用的是 CRC 检验方法；</li>
</ul>
<p>★★☆ 集线器、交换机、路由器的作用，以及所属的网络层。(<a href="https://www.tianmaying.com/tutorial/NetWorkInstrument" target="_blank" rel="noopener">https://www.tianmaying.com/tutorial/NetWorkInstrument</a>)</p>
<ul>
<li>集线器：物理层设备。作用于比特而不是帧，当一个比特到达接口时，集线器重新生成这个比特，并将其能量强度放大，从而扩大网络的传输距离，之后再将这个比特发送到其他所有接口。如果集线器同时收到两个不同接口的帧，那么就发生了碰撞。</li>
<li>交换机：链路层设备。是一种基于 MAC 识别，能完成封装转发数据包功能的网络设备。它不会发生碰撞，能根据 MAC 地址进行存储转发。</li>
<li>路由器：网络层设备。是一种连接多个网络或网段的网络设备，根据 IP 进行转发。</li>
</ul>
<p>★★☆ IP 数据数据报常见字段的作用。</p>
<ul>
<li>版本：有 4（IPv4）和 6（IPv6）两个值；</li>
<li>首部长度 : 占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为首部固定长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。</li>
<li>区分服务 : 用来获得更好的服务，一般情况下不使用。</li>
<li>总长度 : 包括首部长度和数据部分长度。</li>
<li>生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。</li>
<li>协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。</li>
<li>首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。</li>
<li>标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。</li>
<li>片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。</li>
</ul>
<p>★☆☆ ARP 协议的作用，以及维护 ARP 缓存的过程。</p>
<ul>
<li>ARP 实现由 IP 地址得到 MAC 地址</li>
<li>如果主机 A 知道主机 B 的 IP 地址，但是 ARP 高速缓存中没有该 IP 地址到 MAC 地址的映射，此时主机 A 通过广播的方式发送 ARP 请求分组，主机 B 收到该请求后会发送 ARP 响应分组给主机 A 告知其 MAC 地址，随后主机 A 向其高速缓存中写入主机 B 的 IP 地址到MAC 地址的映射。</li>
</ul>
<p>★★☆ ICMP 报文种类以及作用；和 IP 数据报的关系；Ping 和 Traceroute 的具体原理。</p>
<ul>
<li>ICMP 报文分为差错报告报文和询问报文</li>
<li>ICMP 是为了更有效地转发 IP 数据报和提高交付成功的机会。它封装在 IP 数据报中，但不属于高层协议</li>
<li>Ping 的原理是通过向目的主机发送 ICMP Echo 请求报文，目的主机收到之后会发送 Echo 回答报文。Ping 会根据时间和成功相应次数估算出数据包往返时间以及丢包率</li>
<li>Traceroute 发送的 IP 数据报封装的是无法交付的 UDP 用户数据报，并由目的主机发送终点不可达差错报告报文。</li>
<li>源主机向目的主机发送一连串的 IP 数据报。第一个数据报 P1 的生存时间 TTL 设置为 1，当 P1 到达路径上的第一个路由器 R1 时，R1 收下它并把 TTL 减 1，此时 TTL 等于 0，R1 就把 P1 丢弃，并向源主机发送一个 ICMP 时间超过差错报告报文；</li>
<li>源主机接着发送第二个数据报 P2，并把 TTL 设置为 2。P2 先到达 R1，R1 收下后把 TTL 减 1 再转发给 R2，R2 收下后也把 TTL 减 1，由于此时 TTL 等于 0，R2 就丢弃 P2，并向源主机发送一个 ICMP 时间超过差错报文。</li>
<li>不断执行这样的步骤，直到最后一个数据报刚刚到达目的主机，主机不转发数据报，也不把 TTL 值减 1。但是因为数据报封装的是无法交付的 UDP，因此目的主机要向源主机发送 ICMP 终点不可达差错报告报文。</li>
<li>之后源主机知道了到达目的主机所经过的路由器 IP 地址以及到达每个路由器的往返时间。</li>
</ul>
<p>★★★ UDP 与 TCP 比较，分析上层协议应该使用 UDP 还是 TCP。</p>
<ul>
<li>传输控制协议 TCP：是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。TCP 主要提供完整性服务。</li>
<li>用户数据报协议 UDP：是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。。主要提供及时性服务。</li>
</ul>
<p>★★★ 理解三次握手以及四次挥手具体过程，<a href="https://www.jianshu.com/p/e7f45779008a" target="_blank" rel="noopener">三次握手的原因</a>(<a href="https://www.jianshu.com/p/7d0f91345483)、四次挥手原因、TIME_WAIT" target="_blank" rel="noopener">https://www.jianshu.com/p/7d0f91345483)、四次挥手原因、TIME_WAIT</a> 的作用。<br><a href="https://www.zhihu.com/question/24853633" target="_blank" rel="noopener">https://www.zhihu.com/question/24853633</a></p>
<ul>
<li>三次握手：<ul>
<li>服务器处于 LISTEN 状态，等待来自客户端的连接请求</li>
<li>客户端向服务器发送连接请求报文 SYN=1</li>
<li>服务器收到客服端发来的 SYN，如果同意建立连接，则向客户端发送确认报文 SYN=1，ACK=1</li>
<li>客户端收到 SYN ACK 后，还要向服务器发出确认报文 ACK</li>
<li>服务器收到 ACK 后，连接建立</li>
</ul>
</li>
<li>连接建立以后，ACK 都置为 1</li>
<li>第三次握手可以携带数据，如果不携带数据则不消耗序号</li>
<li>三次握手的原因<br>  对于握手：握手只需要确认双方通信时的初始化序号，保证通信不会乱序。（第三次握手必要性：假设服务端的确认丢失，连接并未断开，客户机超时重发连接请求，这样服务器会对同一个客户机保持多个连接，造成资源浪费。）</li>
<li>四次挥手：<ul>
<li>客户端发送释放报文 FIN</li>
<li>服务器收到 FIN 后发出确认 ACK，此时 TCP 属于半关闭状态（CLOSED_WAIT），服务器能向客户端发送数据但是客户端不能向服务器发送数据</li>
<li>当服务器不再需要连接时，发送连接释放报文 FIN</li>
<li>客户端收到 FIN 后发出确认 ACK，进入 TIME-WAIT 状态，等待 2 倍的 MSL（最大报文存活时间）后释放连接</li>
<li>服务器收到 ACK 后释放连接</li>
</ul>
</li>
<li>四次挥手的原因：客户端发送了 FIN 连接释放报文之后，服务器收到了这个报文，就进入了 CLOSE-WAIT 状态。这个状态是为了让服务器发送还为传送完毕的数据，传送完毕后，服务器会发送 FIN 连接释放报文。</li>
<li>TIME_WAIT：客户端收到服务端的 FIN 报文址后进入此状态，此时并不是直接进入 CLOSED 状态，还需要等待一个时间计时器设置的时间 2MSL。这么做有两个理由：<ol>
<li>确保最后一个报文能够到达。如果 B 没收到 A 发送来的确认报文，那么就会重新发送连接释放请求报文，A 等待一段时间就是为了处理这种情况的发生。</li>
<li>等待一段时间是为了让本连接持续时间内所产生的所有报文都从网络中消失，是的下一个连接不会出现九的连接请求报文。</li>
</ol>
</li>
</ul>
<p>★★★ 可靠传输原理，并设计可靠 UDP 协议。</p>
<ul>
<li>建立连接（标志位）：通信前确认通信实体存在</li>
<li>序号机制（序号、确认号）：确保了数据是按序、完整到达</li>
<li>数据校验（校验和）：CRC 校验全部数据，校验包出错，丢弃报文段，不给出响应，超时重发</li>
<li>超时重传（定时器）：保证因链路故障未能到达数据能够被多次重发。<ul>
<li>RTT：数据从发送到接收到对方响应之间的时间间隔，即数据报在网络中一个往返用时。大小不稳定。</li>
<li>RTO：重传间隔，通常每次重传 RTO 是前一次重传间隔的两倍，重传次数达到上限后停止重传。RTO = RTTs + 4*RTTd</li>
</ul>
</li>
<li>流量控制（流量窗口）：避免发送过量<ul>
<li>目的是接收方通过 TCP 头窗口字段告知发送方本方可接收的最大数据量，用以解决发送速率过快导致接收方不能接收的问题。</li>
<li>发送方和接收方各有一个窗口，接收方通过 TCP 报文段中的窗口字段来告诉发送方自己的窗口大小，发送方根据这个值来设置自己窗口大小。如果发送窗口左部的字节已经发送并且收到了确认，那么就将发送窗口向右滑动一定距离，直到左部第一个字节不是已发送并且已确认的状态，接收窗口类似。</li>
<li>TCP 是流数据，发送出去的数据流可以被分为以下四部分：已发送且被确认部分 | 已发送未被确认部分 | 未发送但可发送部分 | 不可发送部分，其中发送窗 = 已发送未确认部分 + 未发但可发送部分。接收到的数据流可分为：已接收 | 未接收但准备接收 | 未接收不准备接收。接收窗 = 未接收但准备接收部分。</li>
<li>发送窗内的数据只有当收到接收端某段发送数据的 ACK 响应时才移动发送窗。接收窗口只会对窗口最后一个<strong>按序</strong>到达的字节进行确认。</li>
</ul>
</li>
<li>拥塞控制（拥塞窗口）</li>
</ul>
<p>★★☆ TCP 拥塞控制的作用，理解具体原理。</p>
<ul>
<li>为了降低整个网络的拥塞程度。</li>
<li>拥塞控制使用拥塞窗口。TCP 主要通过四个算法来进行拥塞控制：慢开始、拥塞避免、快重传、快恢复。</li>
<li>慢开始：发送的最初执行慢开始，令 cwnd = 1，发送方只能发送一个报文段，当收到确认后，将 cwnd 加倍。</li>
<li>拥塞避免：设置一个慢开始门限 ssthresh ，当cwnd &gt;= ssthresh 时，进入拥塞避免，每个轮次只将 cwnd 加 1。如果出现了超时，则令 ssthresh = cwnd / 2，然后重新执行慢开始。</li>
<li>快重传：在发送方，如果收到 3 个重复确认，那么知道下一个报文段丢失，此时执行快重传，立刻重传下一个报文段。</li>
<li>快恢复：快重传之后执行快恢复，令 ssthresh = cwnd / 2，cwnd = ssthresh，此时直接进入拥塞避免。</li>
<li>慢开始和快恢复的快慢指的是 cwnd 的设定值，而不是 cwnd 的增长速率。慢开始 cwnd 设定为 1，而快恢复 cwnd 设定为 ssthresh。</li>
<li>流量控制和拥塞控制：<ul>
<li>流量控制属于通信双方协商，拥塞控制涉及通信链路全局</li>
<li>实际最终发送窗口 = min{流量控制发送窗口,拥塞窗口}</li>
</ul>
</li>
</ul>
<p>★★☆ DNS 的端口号；TCP 还是 UDP；作为缓存、负载均衡。</p>
<ul>
<li>DNS可以使用 UDP 和 TCP 进行传输，使用的端口号都为53.大多数情况下 DNS 使用 UDP 进行传输，这就要求域名解析器和域名服务器都必须自己处理超市和重传来保证可靠性。在两种情况下会使用 TCP 进行传输：<ol>
<li>如果返回的响应超过 512 字节（UDP 最大只支持 512 字节的数据）。</li>
<li>区域传送（区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据）。</li>
</ol>
</li>
</ul>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>★★★ GET 与 POST 比较：作用、参数、安全性、幂等性、可缓存。</p>
<ul>
<li>作用：GET 用于获取资源，而 POST 用于传输实体主体。</li>
<li>参数：GET 和 POST 的请求都能使用额外的参数，但是 GET 的 参数是以查询字符串出现在 URL 中，而 POST 的参数存储在实体主体中。因为 URL 只支持 ASCII 码，因此 GET 的参数中如果存在中文等字符就需要先进行编码。例如 <code>中文</code> 会转换为 <code>%E4%B8%AD%E6%96%87</code>，而空格会转换为<code>%20</code>。POST 参考支持标准字符集。</li>
<li>安全性：安全的 HTTP 方法不会改变服务器状态，也就是说他只是可读的。GET 方法是安全的，而 POST 却不是，因为 POST 的目的是传送实体主体内容，这个内容可能是用户上传的表单数据，上传成功之后，服务器可能把这个数据存储到数据库中，因此状态也就发生了改变。安全的方法除了 GET 之外还有：HEAD、OPTIONS。不安全的方法除了 POST 之外还有 PUT、DELETE。</li>
<li>幂等性：幂等的 HTTP 方法，同样的请求被执行一次与连续执行多次的效果是一样的，服务器的状态也是一样的。换句话说就是，幂等方法不应该具有副作用（统计用途除外）。所有的安全方法也都是幂等的。在正确实现的条件下，GET，HEAD，PUT 和 DELETE 等方法都是幂等的，而 POST 方法不是。</li>
<li>可缓存：如果要对响应进行缓存，需要满足以下条件：</li>
<li>请求报文的 HTTP 方法本身是可缓存的，包括 GET 和 HEAD，但是 PUT 和 DELETE 不可缓存，POST 在多数情况下不可缓存的。</li>
<li>响应报文的状态码是可缓存的，包括：200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501。</li>
<li>响应报文的 Cache-Control 首部字段没有指定不进行缓存。</li>
</ul>
<p>★★☆ HTTP 状态码。</p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>类别</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>1XX</td>
<td>Informational（信息性状态码）</td>
<td>接受的请求正在处理</td>
</tr>
<tr>
<td>2XX</td>
<td>Successful（成功状态码）</td>
<td>请求正常处理完毕</td>
</tr>
<tr>
<td>3XX</td>
<td>Redirection（重定向状态码）</td>
<td>需要进行附加操作以完成请求</td>
</tr>
<tr>
<td>4XX</td>
<td>Client Error（客户端错误状态码）</td>
<td>服务器无法处理请求</td>
</tr>
<tr>
<td>5XX</td>
<td>Server Error（服务器错误状态码）</td>
<td>服务器请求处理出错</td>
</tr>
</tbody></table>
<ul>
<li>100 Continue：表明到目前为止都很正常，客户端可以继续发送请求或者忽略这个响应。</li>
<li>200 Ok</li>
<li>204 No Content：请求已经成功处理，但是返回的响应报文不包含实体的主体部分。一般在只需要从客户端往服务器发送信息，而不需要返回数据时使用。</li>
<li>206 Partial Content：表示客户端进行了范围请求，响应报文包含由 Conent-Range 指定范围的实体内容。</li>
<li>301 Moved Permanently：永久重定向</li>
<li>302 Found：临时性重定向</li>
<li>303 See Other ：和 302 有着相同的功能，但是 303 明确要求客户端应该采用 GET 方法获取资源。</li>
<li>注：虽然 HTTP 协议规定 301、302 状态下重定向时不允许把 POST 方法改成 GET 方法，但是大多数浏览器都会在 301、302 和 303 状态下的重定向把 POST 方法改成 GET 方法。</li>
<li>304 Not Modified ：如果请求报文首部包含一些条件，例如：If-Match，If-Modified-Since，If-None-Match，If-Range，If-Unmodified-Since，如果不满足条件，则服务器会返回 304 状态码。</li>
<li>307 Temporary Redirect ：临时重定向，与 302 的含义类似，但是 307 要求浏览器不会把重定向请求的 POST 方法改成 GET 方法。</li>
<li>400 Bad Request：请求报文中存在语法错误</li>
<li>401 Unauthorized：该状态码表示发送的请求需要有认证信息（BASIC 认证、DIGEST 认证）。如果之前已进行过一次请求，则表示用户认证失败。</li>
<li>403 Fobidden：请求被拒绝</li>
<li>404 Not Found</li>
<li>500 Internal Server Error ：服务器正在执行请求时发生错误。</li>
<li>503 Service Unavailable ：服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。</li>
</ul>
<p>★★★ Cookie 作用、安全性问题、和 Session 的比较。</p>
<ul>
<li>用途：</li>
</ul>
<ol>
<li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li>
<li>个性化设置（如用户自定义设置、主题等）</li>
<li>浏览器行为跟踪（如跟踪分析用户行为等）</li>
</ol>
<ul>
<li>标记为 HttpOnly 的 Cookie 不能被 Javascript 脚本调用。跨站脚本攻击 (XSS) 常常使用 JavaScript 的 <code>document.cookie</code> API 窃取用户的 Cookie 信息，因此使用 HttpOnly 标记可以在一定程度上避免 XSS 攻击。</li>
<li>标记为 Secure 的 Cookie 只能通过被 HTTPS 协议加密过的请求发送给服务端。但即便设置了 Secure 标记，敏感信息也不应该通过 Cookie 传输，因为 Cookie 有其固有的不安全性，Secure 标记也无法提供确实的安全保障。</li>
<li>Cookie 与 Session 选择</li>
<li>Cookie 只能存储 ASCII 码字符串，而 Session 则可以存取任何类型的数据，因此在考虑数据复杂性时首选 Session；</li>
<li>Cookie 存储在浏览器中，容易被恶意查看。如果非要将一些隐私数据存在 Cookie 中，可以将 Cookie 值进行加密，然后在服务器进行解密；</li>
<li>对于大型网站，如果用户所有的信息都存储在 Session 中，那么开销是非常大的，因此不建议将所有的用户信息都存储到 Session 中。</li>
</ul>
<p>★★☆ 缓存的 Cache-Control 字段，特别是 Expires 和 max-age 的区别。ETag 验证原理。</p>
<ul>
<li>HTTP/1.1 通过 Cache-Control 首部字段来控制缓存。</li>
<li>no-store 指令规定不能对请求或响应的任何一部分进行缓存 <code>Cache-Control：no-store</code></li>
<li>no-cache 指令规定缓存服务器需要先向源服务器验证缓存的有效性，只有当缓存服务器有效才将能使用该缓存对客户端的请求进行相应</li>
<li>private 指令规定了将资源作为私有缓存，只能被单独用户所使用，一般存储在用户浏览器中。public 指令规定了将资源作为公共缓存，可以被多个用户所使用，一般存储在代理服务器中。</li>
<li>max-age 指令出现在请求报文中，并且缓存资源的缓存时间小于该指令指定的时间，那么就能接受该缓存。max-age 指令出现在响应报文中，表示缓存资源在缓存服务器中保存的时间。Expires 首部字段也可以用于告知缓存服务器该资源什么时候会过期。在 HTTP/1.1 中，会优先处理 max-age 指令；在 HTTP/1.0 中，max-age 指令会被忽略掉。</li>
<li>ETag：它是资源的唯一标识。URL 不能唯一表示资源，例如 <code>http://www.google.com/</code> 有中文和英文两个资源，只有 ETag 才能对这两个资源进行唯一标识。<code>ETag: &quot;82e22293907ce725faf67773957acd12&quot;</code>可以将缓存资源的 ETag 值放入 If-None-Match 首部，服务器收到该请求后，判断缓存资源的 ETag 值和资源的最新 ETag 值是否一致，如果一致则表示缓存资源有效，返回 304 Not Modified。 <code>If-None-Match: &quot;82e22293907ce725faf67773957acd12&quot;</code></li>
</ul>
<p>★★★ 长连接与短连接原理以及使用场景，流水线。</p>
<ul>
<li>当浏览器访问一个包含多张图片的 HTML 页面时，除了请求访问 HTML 页面资源，还会请求图片资源。如果每进行一次 HTTP 通信就要新建一个 TCP 连接，那么开销会很大。长连接只需要建立一次 TCP 连接就能进行多次 HTTP 通信。</li>
<li>从 HTTP/1.1 开始默认是长连接的，如果要断开连接，需要由客户端或者服务器端提出断开，使用 <code>Connection : close</code>；</li>
<li>在 HTTP/1.1 之前默认是短连接的，如果需要使用长连接，则使用 <code>Connection : Keep-Alive</code>。</li>
</ul>
<p>★★★ HTTP 存在的安全性问题，以及 HTTPs 的加密、认证和完整性保护作用。</p>
<ul>
<li>安全性问题：</li>
<li>使用明文进行通信，内容可能会被窃听</li>
<li>不验证通信方身份，通信方的身份可能遭遇伪装</li>
<li>无法验证报文的完整性，报文有可能遭篡改</li>
<li>HTTPs：让 HTTP 先和 SSL（Secure Sockets Layer）通信，再由 SSL 和 TCP 通信，也就是说 HTTPs 使用了隧道进行通信。通过使用 SSL，HTTPs 具有了加密（防窃听）、认证（防伪装）和完整性保护（防篡改）。</li>
</ul>
<p>★★☆ HTTP/1.x 的缺陷，以及 HTTP/2 的特点。</p>
<ul>
<li>HTTP/1.X 缺陷：<ul>
<li>客户端需要使用多个连接才能实现并发和缩短延迟</li>
<li>不会压缩请求和响应首部，从而导致不必要的网络流量</li>
<li>不支持有效的资源优先级，导致底层 TCP 连接的利用率低下</li>
</ul>
</li>
<li>HTTP/2：<ul>
<li>二进制分帧层：HTTP/2.0将报文分成 HEADERS 帧和 DATA 帧，它们嗾使二进制格式的。在通信过程中，只会有一个 TCP 连接存在，它承载力任意数量的数据流。</li>
<li>服务器推送：HTTP/2.0 在客户端请求一个资源时，会把相关的资源一起发送给客户端，客户端就不需要再次发起请求了。例如客户端请求 page.html 页面，服务端就把 script.js 和 style.css 等与之相关的资源一起发给客户端。</li>
<li>首部压缩：HTTP/2.0 要求客户端和服务器同时维护和更新一个包含之前见过的首部字段表，从而避免了重复传输。不仅如此，HTTP/2.0 也使用 Huffman 编码对首部字段进行压缩。</li>
</ul>
</li>
</ul>
<p>★★★ HTTP/1.1 的特性。</p>
<ul>
<li>默认是长连接</li>
<li>支持流水线</li>
<li>支持同时打开多个 TCP 连接</li>
<li>支持虚拟主机</li>
<li>新增状态码 100</li>
<li>支持分块传输编码</li>
<li>新增缓存处理指令 max-age</li>
</ul>
<p>★★☆ HTTP 与 FTP 的比较。</p>
<ul>
<li>FTP 使用 TCP 进行连接，它需要两个连接来传送一个文件</li>
<li>控制连接：服务器打开端口号 21 等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答</li>
<li>数据连接：用来传送一个文件数据</li>
</ul>
<h2 id="Socket-网络-I-O模型"><a href="#Socket-网络-I-O模型" class="headerlink" title="Socket 网络 I/O模型"></a>Socket 网络 I/O模型</h2><p>★★☆ 五种 IO 模型的特点以及比较。</p>
<ul>
<li>阻塞式 I/O：应用进程被阻塞，直到数据复制到应用进程缓冲池中才被返回。</li>
<li>非阻塞式 I/O：应用进程执行系统调用后，内核返回一个错误码。应用进程可以继续执行，但是需要不断地执行系统调用来获知 I/O是否完成，这种方式成为轮询（polling）。</li>
<li>I/O 复用：使用 select 或者 poll 等待数据，并且可以等待多个套接字中的任何一个变为可读。这一过程会被阻塞，当某一个套接字可读时返回，之后再使用 recvform 把数据从内核复制到进程中。它可以让单个进程具有处理多个 I/O事件的能力。又被称为 Event Driven I/O，即事件驱动 I/O。</li>
<li>信号驱动 I/O：应用进程使用 sigaction 系统调用，内核立即返回，也就是说等待数据阶段应用进程是非阻塞的。内核在数据到达时向应用进程发送 SIGIO 信号，应用进程收到之后在信号处理程序中调用 recvfrom 将数据从内核复制到应用程序中。</li>
<li>异步 I/O：应用进程执行 aio_read 系统调用会立即返回，应用程序可以继续执行，不会被阻塞，内核会在所有操作完成之后向应用进程发送信号。异步 I/O 与信号驱动 I/O 的区别在于，异步 I/O 是通知应用进程 I/O 完成，而信号驱动 I/O 的信号是通知应用进程可以开始 I/O。</li>
</ul>
<h4 id="比较"><a href="#比较" class="headerlink" title="比较:"></a>比较:</h4><ol>
<li>同步 I/O：将数据从内核缓冲区复制到应用进程缓冲区的阶段，应用进程会阻塞。</li>
<li>异步 I/O：不会阻塞。</li>
<li>阻塞式 I/O、非阻塞式 I/O、I/O 复用和信号驱动 I/O 都是同步 I/O，它们的主要区别在第一个阶段。</li>
<li>非阻塞式 I/O 、信号驱动 I/O 和异步 I/O 在第一阶段不会阻塞。</li>
</ol>
<p>★★★ select、poll、epoll 的原理、比较、以及使用场景；epoll 的水平触发与边缘触发。</p>
<h4 id="select："><a href="#select：" class="headerlink" title="select："></a>select：</h4><pre class="line-numbers language-c"><code class="language-c">    <span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>readfds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>writefds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>exceptfds<span class="token punctuation">,</span> <span class="token keyword">struct</span> timeval      <span class="token operator">*</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>有三种类型的描述符类型：readset、writeset、execptset，分别对应读、写、异常条件的描述符集合。fd_set使用数组实现，数组大小使用 FD_SETSIZE 定义。timeout 为超时参数，调用 select 会一直阻塞直到有描述符事件到达或者等待时间超过 timeout。成功调用返回结果大于 0，出错返回结果为 -1，超时返回结果为 0。</p>
<h4 id="poll："><a href="#poll：" class="headerlink" title="poll："></a>poll：</h4><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token keyword">struct</span> pollfd<span class="token operator">*</span>fds<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> fds<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>pollfd使用链表实现</p>
<h4 id="select-和-poll-比较："><a href="#select-和-poll-比较：" class="headerlink" title="select 和 poll 比较："></a>select 和 poll 比较：</h4><ul>
<li>select 会修改描述符，poll不会。</li>
<li>select 的描述符类型使用数组实现，FD_SETSIZE 大小默认为 1024，因此只能监听 1024 个描述符。如果要监听更多描述符，需要修改 FD_SETSIZE 之后重新编译。而 poll 的描述符类型使用链表实现，没有描述符数量的限制。</li>
<li>poll 提供了更多的事件类型，并且对描述符的重复利用上比 select 高</li>
<li>如果一个线程对某个描述符调用了 select 或者 poll，另一个线程关闭了该描述符，会导致调用结果不确定。</li>
<li>速度：select 和 poll速度都比较慢</li>
<li>select 和 poll 每次调用都需要将 <strong>全部描述符从应用进程缓冲池区复制到内核缓冲区</strong></li>
<li>select 和 poll 的返回结果中没有声明哪些描述符已经准备好，所以如果返回值大于等于 0 时，应用程序需要使用<strong>轮询</strong>的方式来找到 I/O 完成的描述符。</li>
<li>可移植性：几乎所有的系统都支持 select。但是只有比较新的系统支持 poll。</li>
</ul>
<h4 id="epoll："><a href="#epoll：" class="headerlink" title="epoll："></a>epoll：</h4><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">epoll_ctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">int</span> op<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">struct</span> epoll_event <span class="token operator">*</span>event<span class="token punctuation">)</span>；
<span class="token keyword">int</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> epoll_event <span class="token operator">*</span> events<span class="token punctuation">,</span> <span class="token keyword">int</span> maxevents<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>epoll_ctl() 用于向内核注册新的描述符或者是改变某个文件描述符的状态。已注册的描述符在内核中会被维护在一棵红黑树上，通过回调函数会将 I/O 准备好的描述符加入到另一个链表中管理，进程调用 epoll_wait() 便可以得到事件完成的描述符。<br>从上面的描述可以看出，epoll 只需要<strong>将描述符从进程缓冲区向内核缓冲区拷贝一次</strong>，并且进程<strong>不需要通过轮询来获得时间完成的描述符</strong>。<br>epoll 仅适用于 Liunx OS。<br><strong>epoll 比 select 和 poll 更加灵活而且没有描述符数量限制</strong><br><strong>epoll 对多线程编程更加友好，一个线程调用了 epoll_wait() 另一个线程关闭了同一个描述符也不会产生像 select 和 poll的不确定情况</strong></p>
<h3 id="工作模式："><a href="#工作模式：" class="headerlink" title="工作模式："></a>工作模式：</h3><p>epoll 的描述符事件有两种触发模式：LT（level trigger）水平触发 和 ET（edge trigger）边缘触发</p>
<ul>
<li>LT 模式：当 epoll_wait() 检测到描述符事件到达时，将此事件通知进程，进程可以不立即处理该事件，下次调用 epoll_wait() 会再次通知进程。是默认的一种模式，并且同时支持 Blocking 和 No-Blocking。</li>
<li>ET 模式：和 LT 模式不同的是，通知之后进程必须立即处理事件，下次再调用 epoll_wait() 时不会再得到事件到达的通知。很大程度上减少了 epoll 事件被重复触发的次数，因此效率要比 LT 模式高。只支持 No-Blocking ，以避免由于一个文件句柄的阻塞读/阻塞写操作把处理多个文件描述符的任务饿死。</li>
</ul>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li>select：select 的 timeout 参数精度为 1ns，而 poll 和 epoll 为 1ms，因此 select 更加适用于实时性要求比较高的场景，比如核反应堆的控制。select 可移植性更好，几乎被所有主流平台所支持。</li>
<li>poll：poll 没有最大描述符数量的限制，如果平台支持并且对实时性要求不高，应该使用 poll 而不是 select。</li>
<li>epoll：只需要运行在 Linux 平台上，有大量的描述符需要同时轮询，并且这些连接最好是长连接。<br>需要同时监控小于 1000 个描述符，就没有必要使用 epoll，因为这个应用场景下并不能体现 epoll 的优势。<br>需要监控的描述符状态变化多，而且都是非常短暂的，也没有必要使用 epoll。因为 epoll 中的所有描述符都存储在内核中，造成每次需要对描述符的状态改变都需要通过 epoll_ctl() 进行系统调用，频繁系统调用降低效率。并且 epoll 的描述符存储在内核，不容易调试。</li>
</ul>
<h1 id="💾数据库"><a href="#💾数据库" class="headerlink" title="💾数据库"></a>💾数据库</h1><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>★★☆ 手写 SQL 语句，特别是连接查询与分组查询。</p>
<p>★★☆ 连接查询与子查询的比较。</p>
<ul>
<li>连接可以替换子查询，并且比子查询的效率一般会更快。</li>
</ul>
<p>★★☆ drop、delete、truncate 比较。</p>
<ul>
<li>DELETE 删除表中 WHERE 语句指定的数据</li>
<li>TRUNCATE 清空表，相当于删除表中所有数据</li>
<li>DROP 删除表结构</li>
<li>DELETE 会被放到日志中以便进行回滚，THUNCATE 和 DROP 立即生效，不会放到日志中，也不支持回滚</li>
</ul>
<p>★★☆ 视图的作用，以及何时能更新视图。</p>
<ul>
<li>简化复杂的查询，比如复杂的连接查询</li>
<li>只使用实际表的一部分数据</li>
<li>通过只给用户访问视图的权限，保证数据的安全性</li>
<li>更改数据格式和表示。</li>
<li>因为视图不存储数据，所以更新视图需要去更新原始表。如果视图定义只依赖于一个原始表，就很容易进行更新操作。但如果视图定义中有以下操作，那么就不能进行视图的更新：</li>
<li>分组查询</li>
<li>连接查询</li>
<li>子查询</li>
<li>Union</li>
<li>聚集函数</li>
<li>DISTINCT</li>
<li>计算字段</li>
</ul>
<p>★☆☆ 理解存储过程、触发器等作用。</p>
<ul>
<li>存储过程可以看成是对一系列 SQL 操作的批处理。</li>
<li>触发器会在某个表执行以下语句时自动执行：DELETE、INSERT、UPDATE。</li>
</ul>
<h2 id="系统原理"><a href="#系统原理" class="headerlink" title="系统原理"></a>系统原理</h2><p>★★★ ACID 的作用以及实现原理。</p>
<ul>
<li>只有满足一致性，事务的执行结果才是正确的。</li>
<li>在无并发的情况下，事务串行执行，隔离性一定能够满足。此时只要能满足原子性，就一定能满足一致性。</li>
<li>在并发的情况下，多个事务并行执行，事务不仅要满足原子性，还需要满足隔离性，才能满足一致性。</li>
<li>事务满足持久化是为了能应对数据库崩溃的情况。</li>
</ul>
<p>★★★ 四大隔离级别，以及不可重复读和幻影读的出现原因。</p>
<ul>
<li>未提交读（READ UNCOMMITTED）：事务中的修改，即使没有提交，对其它事务也是可见的。脏读</li>
<li>提交读（READ COMMITTED）：一个事务只能读取已经提交的事务所做的修改。换句话说，一个事务所做的修改在提交之前对其它事务是不可见的。重复读</li>
<li>可重复读（REPEATABLE READ）：保证在同一个事务中多次读取同样数据的结果是一样的。幻影读</li>
<li>可串行化（SERIALIZABLE）：强制事务串行执行。</li>
<li>不可重复读：T2 读取一个数据，T1 对该数据做了修改。如果 T2 再次读取这个数据，此时读取的结果和第一次读取的结果不同。</li>
<li>幻影读：T1 读取某个范围的数据，T2 在这个范围内插入新的数据，T1 再次读取这个范围的数据，此时读取的结果和和第一次读取的结果不同。</li>
</ul>
<p>★★☆ 封锁的类型以及粒度，两段锁协议，隐式和显示锁定。</p>
<ul>
<li>封锁类型：</li>
<li>1.读写锁</li>
<li>排他锁（Exclusive），简写为 X 锁，又称写锁。</li>
<li>共享锁（Shared），简写为 S 锁，又称读锁。</li>
<li>一个事务对数据对象 A 加了 X 锁，就可以对 A 进行读取和更新。加锁期间其他事务不能对 A 加任何锁。</li>
<li>一个事务对数据对象 A 加了 S 锁，就可以对 A 进行读取操作，但是不能进行更新操作。加锁期间其它事务能对 A 加 S 锁，但是不能加 X 锁。</li>
<li>2.意向锁</li>
<li>使用意向锁可以更容易地支持多粒度封锁。</li>
<li>一个事务在获得某个数据行对象的 S 锁之前，必须先获得表的 IS 锁或者更强的锁</li>
<li>一个事务在获得某个数据行对象的 X 锁之前，必须先获得表的 IX 锁。</li>
<li>通过引入意向锁，事务 T 想要对表 A 加 X 锁，只需要先检测是否有其它事务对表 A 加了 X/IX/S/IS 锁，如果加了就表示有其它事务正在使用这个表或者表中某一行的锁，因此事务 T 加 X 锁失败。</li>
<li>封锁粒度：行级锁和表级锁</li>
<li>应该尽量只锁定需要修改的那部分数据，而不是所有的资源。锁定的数据量越少，发生锁争用的可能就越小，系统的并发程度就越高。</li>
<li>但是加锁需要消耗资源，锁的各种操作（包括获取锁、释放锁、以及检查锁状态）都会增加系统开销。因此封锁粒度越小，系统开销就越大。</li>
<li>在选择封锁粒度时，需要在锁开销和并发程度之间做一个权衡。</li>
<li>两段锁协议：</li>
<li>加锁和解锁分为两个阶段进行</li>
<li>MySQL 隐式与显示锁定：MySQL 的 InnoDB 存储引擎采用两段锁协议，会根据隔离级别在需要的时候自动加锁，并且所有的锁都是在同一时刻被释放，这被称为隐式锁定。InnoDB 也可以使用特定的语句进行显示锁定<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LOCK</span> <span class="token operator">In</span> <span class="token keyword">SHARE MODE</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
★★★ 乐观锁与悲观锁。</li>
</ul>
<p>★★★ MVCC 原理，当前读以及快照读，Next-Key Locks 解决幻影读。</p>
<p>★★☆ 范式理论。</p>
<p>★★★ SQL 与 NoSQL 的比较。</p>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>★★★ B+ Tree 原理，与其它查找树的比较。</p>
<ul>
<li>B+ 树是一颗查找树，并且所有叶子节点位于同一层</li>
<li>B+ Tree 是基于 B Tree 和叶子节点顺寻访问指针进行实现，它具有 B Tree 的平衡性，并且通过顺序访问指针来提高区间查询的性能。</li>
<li>在 B+ Tree 中，一个节点中的 key 从左到右非递减排列，如果某个指针的左右相邻 key 分别是 keyi 和 keyi+1，且不为 null，则该指针指向节点的所有 key 大于等于 keyi 且小于等于 keyi+1。</li>
<li>与红黑树的比较</li>
<li>更少的查找次数：平衡树查找操作的时间复杂度和树高 h 相关，O(h)=O(logdN)，其中 d 为每个节点的出度。红黑树的出度为 2，而 B+ Tree 的出度一般都非常大，所以红黑树的树高 h 很明显比 B+ Tree 大非常多，查找的次数也就更多。</li>
<li>利用磁盘预读特性：为了减少磁盘 I/O 操作，磁盘往往不是严格按需读取，而是每次都会预读。预读过程中，磁盘进行顺序读取，顺序读取不需要进行磁盘寻道，并且只需要很短的旋转时间，速度会非常快。操作系统一般将内存和磁盘分割成固定大小的块，每一块称为一页，内存与磁盘以页为单位交换数据。数据库系统将索引的一个节点的大小设置为页的大小，使得一次 I/O 就能完全载入一个节点。并且可以利用预读特性，相邻的节点也能够被预先载入.</li>
<li><a href="https://my.oschina.net/lienson/blog/2987474" target="_blank" rel="noopener">为什么MySQL数据库要用B+树存储索引？</a></li>
</ul>
<p>★★★ MySQL 索引以及优化。</p>
<ul>
<li>从结构层：web 服务器采用负载均衡服务器，MySQL 服务器采用主从复制，读写分离。</li>
<li>从储存层：采用合适的存储引擎，采用三范式。</li>
<li>从设计层：采用分区分表，表的字段采用合适的字段属性，适当的采用逆范式，开启 MySQL 缓存。</li>
<li>sql 语句层：结果一样的情况下，采用效率高，速度快节省资源的 sql 语句执行。</li>
</ul>
<p>★★★ 查询优化。</p>
<p>★★★ InnoDB 与 MyISAM 比较。</p>
<ul>
<li>事务：InnoDB 是事务型的，可以使用 Commit 和 Rollback 语句</li>
<li>并发：MyISAM 只支持表锁，而 InnoDB 还支持行级锁</li>
<li>外键：InnoDB 支持外键</li>
<li>备份：InnoDB 支持在线热备份</li>
<li>崩溃恢复：MyISAM 崩溃后发生损坏的概率比 InnoDB 高很多，而且恢复的速度也更慢</li>
<li>其他特性：MyISAM 支持压缩表和空间数据索引</li>
</ul>
<p>★★☆ 水平切分与垂直切分。</p>
<p>★★☆ 主从复制原理、作用、实现。</p>
<ul>
<li>原理<ol>
<li>Master 主库将数据变更 DataChanges 记录 binlog 日志中</li>
<li>Slave 起一个 I/O 线程连接到 Master，dump 读取 Master 的 binlog 日志并写入到 Slave 的中继日志 Relay log 中</li>
<li>Slave 中的 SQL 线程读取中继日志 Relay log 进行 SQL 回放执行操作，完成主从复制，保证主从最终一致性</li>
</ol>
</li>
<li>作用：可以实现读写分离，也可以在主库挂掉后从备用库中恢复，实时灾备的故障切换</li>
</ul>
<p>★☆☆ redo、undo、binlog 日志的作用。</p>
<ul>
<li>redo log（重做日志）<ul>
<li>确保事务的持久性,防止在发生故障的时间点，尚有脏页未写入磁盘，在重启mysql服务的时候，根据redo log进行重做，从而达到事务的持久性这一特性。</li>
<li>内容：物理格式的日志，记录的是物理数据页面的修改的信息，其redo log是顺序写入redo log file的物理文件中去的。</li>
</ul>
</li>
<li>undo log（回滚日志）<ul>
<li>保存了事务发生之前的数据的一个版本，可以用于回滚，同事可以提供多版本并发控制下的读</li>
<li>内容：逻辑格式的日志，在执行undo的时候，仅仅是将数据从逻辑上恢复至事务之前的状态，而不是从物理页面上操作实现的，这一点是不同于redo log的。</li>
</ul>
</li>
<li>binlog（二进制日志）：<ol>
<li>用于复制，在主从复制中，从库利用主库上的 binlog 进行重播，实现主从同步</li>
<li>用于数据库的基于时间点的还原</li>
</ol>
<ul>
<li>内容：逻辑格式的日志，可以简单认为就是执行过的事务中的sql语句。但又不完全是sql语句这么简单，而是包括了执行的sql语句（增删改）反向的信息，也就意味着delete对应着delete本身和其反向的insert；update对应着update执行前后的版本的信息；insert对应着delete和insert本身的信息。</li>
</ul>
</li>
<li>redo log 和 binlog：<ol>
<li>作用不同：redo log 是保证事务的持久性的，是事务层面的，binlog 作为还原的功能，是数据库层面的（当然也可以精确到事务层   面的），虽然都有还原的意思，但是其保护数据的层次是不一样的。</li>
<li>内容不同：redo log 是物理日志，是数据页面的修改之后的物理记录，binlog 是逻辑日志，可以简单认为记录的就是 sql 语句</li>
<li>另外，两者日志产生的时间，可以释放的时间，在可释放的情况下清理机制，都是完全不同的。</li>
<li>恢复数据时候的效率，基于物理日志的 redo log 恢复数据的效率要高于语句逻辑日志的 binlog</li>
</ol>
</li>
</ul>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>★★☆ 字典和跳跃表原理分析。</p>
<p>★★★ 使用场景。</p>
<ul>
<li>计数器</li>
<li>缓存</li>
<li>查找表</li>
<li>消息队列</li>
<li>会话缓存</li>
<li>分布式锁实现</li>
</ul>
<p>★★★ 与 Memchached 的比较。</p>
<ul>
<li>数据类型：Memcached 仅支持字符串类型，而 Redis 支持五种不同的数据类型</li>
<li>数据持久化：Redis 支持两种持久化策略：RDB 快照和 AOF 日志，而 Memcached 不支持持久化</li>
<li>分布式：Memcached 不支持分布式，只能通过在客户端使用一致性哈希来实现分布式存储，这种方式在存储和查询时都需要先在客户端计算一次数据所在的节点。Redis Cluster 实现了分布式的支持。</li>
<li>内存管理机制：</li>
<li>在 Redis 中，并不是所有数据都一直存储在内存中，可以将一些很久没用的 value 交换到磁盘，而 Memcached 的数据则会一直在内存中。</li>
<li>Memcached 将内存分割成特定长度的块来存储数据，以完全解决内存碎片的问题。但是这种方式会使得内存的利用率不高，例如块的大小为 128 bytes，只存储 100 bytes 的数据，那么剩下的 28 bytes 就浪费掉了。</li>
</ul>
<p>★☆☆ 数据淘汰机制。</p>
<ul>
<li>可以设置内存最大使用量，当内存使用量超出时，会施行数据淘汰策略。</li>
<li>Reids 具体有 6 种淘汰策略。</li>
<li>使用 Redis 缓存数据时，为了提高缓存命中率，需要保证缓存数据都是热点数据。可以将内存最大使用量设置为热点数据占用的内存量，然后启用 allkeys-lru 淘汰策略，将最近最少使用的数据淘汰。</li>
<li>Redis 4.0 引入了 volatile-lfu 和 allkeys-lfu 淘汰策略，LFU 策略通过统计访问频率，将访问频率最少的键值对淘汰。</li>
</ul>
<p>★★☆ RDB 和 AOF 持久化机制。</p>
<ul>
<li>RDB：将某个时间点的所有数据放到硬盘上。可以将快照复制到其他服务器从而创建具有相同服务器副本如果系统发生故障，将会丢失最后一次创建快照直接后的数据。如果数据量很大，保存快照的时间会很长</li>
<li>AOF：将写命令添加到 AOF 文件的末尾。使用 AOF 持久化需要设置同步选项，从而确保写命令什么时候会同步到磁盘文件上。这是因为对文件进行写入并不会马上将内容同步到磁盘上，而是先存储到缓冲区，然后由操作系统决定什么时候同步到磁盘。有以下同步选项：<ul>
<li>always 每个命令都同步：会严重减低服务器的性能。</li>
<li>everysec 每秒同步一次：这个选项比较合适，可以保证系统崩溃时只会丢失一秒左右的数据，并且 Reids 每秒执行一次对同步服务器性能几乎没有任何影响。</li>
<li>no 让操作系统来决定何时同步：并不能给服务器性能带来多大的提升，而且也会增加系统崩溃时数据丢失的数量。</li>
</ul>
</li>
<li>随着服务器写请求的增多，AOF 文件会越来越大。Redis 提供了一种将 AOF 重写的特性，能够去除 AOF 文件中的冗余写命令。</li>
</ul>
<p>★★☆ 事件驱动模型。<br>★☆☆ 主从复制原理。<br>★★★ 集群与分布式。<br>★★☆ 事务原理。<br>★★★ 线程安全问题。</p>
<h1 id="🎨面向对象"><a href="#🎨面向对象" class="headerlink" title="🎨面向对象"></a>🎨面向对象</h1><h2 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h2><p>★★★ 面向对象三大特性</p>
<ul>
<li>封装</li>
<li>继承</li>
<li>多态</li>
</ul>
<p>★☆☆ 设计原则</p>
<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><p>★★☆ 设计模式的作用。<br>★★★ 手写单例模式，特别是双重检验锁以及静态内部类。<br>★★★ 手写工厂模式。<br>★★★ 理解 MVC，结合 SpringMVC 回答。<br>★★★ 理解代理模式，结合 Spring 中的 AOP 回答。<br>★★★ 分析 JDK 中常用的设计模式，例如装饰者模式、适配器模式、迭代器模式等。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://github.com/linw7/Skill-Tree/blob/master/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.md" target="_blank" rel="noopener">Skill-Tree 操作系统</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/05/16/%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/" data-id="ckd5czhit004gnnnr4kr0do44" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A2%98%E7%9B%AE/" rel="tag">题目</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL-查询优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/11/MySQL-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2019-05-11T13:45:54.000Z" itemprop="datePublished">2019-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/11/MySQL-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">MySQL 查询优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>先说明如何定位低效 SQL 语句，然后根据 SQL 语句可能低效的原因做排查，先从索引着手，如果索引没有问题，考虑其他几个方面，数据访问的问题，长难语句的问题还是一些特定类型优化的问题</p>
<ol>
<li>通过脚本，刷新观察 status</li>
<li>是否周期性故障或者波动</li>
<li>一般由访问高峰或缓存崩溃引起，加缓存并更改缓存失效策略，使失效时间分散或夜间定时失效</li>
<li>show processlist 或开启慢查询 获取有问题的 sql</li>
<li>profiling 分析语句及 explain 分析语句<ol>
<li>如果语句等待时间长：调优服务器参数（如缓冲区，线程数）</li>
<li>如果语句执行时间长：可能是表设计有缺陷，索引没优化 语句没优化</li>
</ol>
</li>
</ol>
<h2 id="排查命令"><a href="#排查命令" class="headerlink" title="排查命令"></a>排查命令</h2><ul>
<li><code>show status</code> 返回计数器</li>
<li><code>show global status</code> 查看服务器级别的所有计数</li>
<li><code>show processlist</code> 观察是否有大量线程处于不正常的状态或特征</li>
</ul>
<h2 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h2><ul>
<li>开启慢查询日志<ol>
<li>以命令行的方式设置参数，不需要重启 MySQL 服务 <code>set global slow_query_log = ON;</code></li>
<li>以配置文件的方式设置，需要重启 MySQL 服务。</li>
</ol>
</li>
<li>设置 long_query_time 值：<code>set long_query_time=10;</code></li>
<li>查看慢查询日志：<code>more show-query.log</code> 或者 <code>mysqldumpslow show-query.log</code></li>
</ul>
<h2 id="使用-Explain-进行分析"><a href="#使用-Explain-进行分析" class="headerlink" title="使用 Explain 进行分析"></a>使用 Explain 进行分析</h2><p>Explain 用来分析 SELECT 查询语句，开发人员可以通过分析 Explain 结果来优化查询语句。</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>type</td>
<td>表示找到所需数据使用的扫描方式</td>
</tr>
<tr>
<td>select_type</td>
<td>查询类型，有简单查询、联合查询、子查询等</td>
</tr>
<tr>
<td>table</td>
<td>表名</td>
</tr>
<tr>
<td>key</td>
<td>使用的索引</td>
</tr>
<tr>
<td>row</td>
<td>扫描的行数</td>
</tr>
<tr>
<td>Extra</td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>常见扫描方式（type）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>system</td>
<td>系统表，少量数据，往往不需要磁盘 IO</td>
</tr>
<tr>
<td>const</td>
<td>常量连接，主键或者唯一索引上的等值查询</td>
</tr>
<tr>
<td>eq_ref</td>
<td>主键索引或者非空唯一索引上的 join 查询，等值扫描，对于前表的每一行，后表只有一行命中</td>
</tr>
<tr>
<td>ref</td>
<td>非主键非唯一索引等值扫描</td>
</tr>
<tr>
<td>range</td>
<td>范围扫描，如 between</td>
</tr>
<tr>
<td>index</td>
<td>索引树扫描，需要扫描索引上的全部数据，如 InnoDB 的count</td>
</tr>
<tr>
<td>ALL</td>
<td>全表扫描</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Extra</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Using Where</td>
<td>SQL 使用了 where 条件过滤数据</td>
</tr>
<tr>
<td>Using index</td>
<td>返回的所有列数据均在一颗所引述上，无需访问实际行记录（索引覆盖）</td>
</tr>
<tr>
<td>Using index condition</td>
<td>命中索引但是没有索引覆盖</td>
</tr>
<tr>
<td>using filesort</td>
<td>得到所需结果集，需要对所有记录进行文件排序（在没有建立索引的列上 order by）</td>
</tr>
<tr>
<td>using temporary</td>
<td>需要建立临时表(temporary table)来暂存中间结果(group by 和 order by 同时存在，且作用于不同的字段时）</td>
</tr>
<tr>
<td>Using join buffer(Block Nested Loop)</td>
<td>需要进行循环嵌套计算（两个关联表join，关联字段均未建立索引）</td>
</tr>
</tbody></table>
<h2 id="profiling-分析查询"><a href="#profiling-分析查询" class="headerlink" title="profiling 分析查询"></a>profiling 分析查询</h2><ul>
<li>profiling 默认是关闭的，通过<code>select @@profiling；</code>查看是否开启，通过<code>set profiling=1;</code>开启</li>
<li>执行需要测试的 sql 语句</li>
<li><code>show profiles\G;</code> 得到被执行的 SQL 语句的时间和 ID。</li>
<li><code>show profile for query 1;</code>得到 id 为 2 的语句执行的详细信息</li>
</ul>
<h1 id="优化方向"><a href="#优化方向" class="headerlink" title="优化方向"></a>优化方向</h1><ul>
<li>数据表数据类型和表结构优化</li>
<li>索引优化</li>
<li>SQL语句的优化</li>
<li>存储引擎的优化</li>
<li>数据库服务器架构的优化</li>
</ul>
<h1 id="数据表数据类型和表结构优化"><a href="#数据表数据类型和表结构优化" class="headerlink" title="数据表数据类型和表结构优化"></a>数据表数据类型和表结构优化</h1><h2 id="建表原则"><a href="#建表原则" class="headerlink" title="建表原则"></a>建表原则</h2><ul>
<li>定常与变长分离</li>
<li>常用字段和不常用字段分离</li>
<li>在 1 对多，需要关联统计的字段上，添加冗余字段</li>
<li>不允许 null</li>
</ul>
<h2 id="列类型选择"><a href="#列类型选择" class="headerlink" title="列类型选择"></a>列类型选择</h2><ul>
<li>字段类型优先级 int date,time enum char varchar blob text</li>
<li>整形：定长，没有国家/地区之分，没有字符集差异，char 需要考虑字符集与校对集（排序规则）</li>
<li>enum：能起约束的目的，内部用整形存储，但与 char 联查时，内部要经历串和值的转化</li>
<li>varchar：不定长，速度慢</li>
<li>text/blob：无法使用内存临时表（排序等操作只能在磁盘上进行）</li>
<li>varchar(10) 和 varchar(300) 在表联查时花更多内存</li>
<li>尽量避免null，不利于索引，要用特殊字节标注，在磁盘占据的空间更大（mysql5.5对null做了改进）</li>
<li>ip 地址的存储，用字符串浪费空间。可以用 iptolong 函数转化为整形存储 </li>
</ul>
<h1 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h1><h2 id="索引的创建原则"><a href="#索引的创建原则" class="headerlink" title="索引的创建原则"></a>索引的创建原则</h2><ul>
<li>最适合索引的列是出现在where，on，group by，order by 子句中的列</li>
<li>尽量选择区分度高的列作为索引</li>
<li>对较小的数据列使用索引,这样会使索引文件更小,同时内存中也可以装载更多的索引键</li>
<li>索引基数越大效果越好</li>
<li>避免创建过多索引</li>
<li>主键尽可能选择较短的数据类型，可以有效减少索引的磁盘占用提高查询效率</li>
</ul>
<h2 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a>联合索引</h2><p>在需要使用多个列作为条件进行查询时，使用复合索引比使用多个单列索引性能更好。</p>
<h3 id="左前缀原则"><a href="#左前缀原则" class="headerlink" title="左前缀原则"></a>左前缀原则</h3><p>原理：比如，我们在（a,b,c）字段上创建一个联合索引，则索引记录会首先按照 A 字段排序，然后再按照 B 字段排序然后再是 C 字段。类似于查字典。<br>index(a,b,c)<br>where a=1 and b&gt;7 and c=2 只能使用 a，b，b用了一半，无法使用到c（使用到范围查询和模糊查询后面的索引都用不到）<br>where a=1 and b=3 order by c 都能用上</p>
<h2 id="索引与排序"><a href="#索引与排序" class="headerlink" title="索引与排序"></a>索引与排序</h2><ul>
<li>对于覆盖索引，直接在索引上查询时，就是有序的，using index</li>
<li>在 InnoDB 引擎中，沿着索引字段排序，自然是有序的， MyISAM 引擎，如果按某索引字段排序，但取出的字段中有未索引字段的做法不是索引-&gt;回行，索引-&gt;回行，而是先取出所有行，再排序</li>
<li>group by 和 order by 同时存在，且作用于不同的字段时，先取出数据，形成临时表做 filesort</li>
</ul>
<h2 id="索引覆盖"><a href="#索引覆盖" class="headerlink" title="索引覆盖"></a>索引覆盖</h2><p>如果查询的列恰好是索引的一部分，那么查询只需要在索引文件上进行,不需要回到磁盘再找数据<br>如 </p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">index</span> index_birthday_and_user_name <span class="token keyword">on</span> user_info<span class="token punctuation">(</span>birthday<span class="token punctuation">,</span> user_name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span><span class="token keyword">select</span> user_name <span class="token keyword">from</span> user_info <span class="token keyword">where</span> birthday <span class="token operator">=</span> <span class="token string">'1991-11-1'</span><span class="token punctuation">`</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="索引失效的情况"><a href="#索引失效的情况" class="headerlink" title="索引失效的情况"></a>索引失效的情况</h2><ul>
<li>ASC，DESC 混用</li>
<li>WHERE 字句中出现非排序使用到的索引</li>
<li>排序列包含非同一个索引的列</li>
<li>排序列使用了复杂的表达式</li>
<li>复合索引遵循左前缀原则</li>
<li>like 查询，% 在前，索引失效，可以使用全文索引</li>
<li>如果 MySQL 估计使用索引比全表扫描更慢,会放弃使用索引</li>
<li>or 条件中的列有索引，后面的没有,索引不会被用到</li>
<li>负向条件(!=、&lt;&gt;、not in、not exists、not like 等)查询不能使用索引，可以优化为 in 查询。</li>
<li>索引列不能是表达式的一部分，也不能是函数的参数</li>
<li>建立索引的列不允许为 null，column is null 可以命中索引，is not null 不能命中。</li>
<li>列的值是字符串，查询时一定要给值加引号,否则索引失效</li>
</ul>
<h2 id="伪哈希索引"><a href="#伪哈希索引" class="headerlink" title="伪哈希索引"></a>伪哈希索引</h2><ul>
<li>同时存在 url 列 hash 列，存储时 crcurl=crc32(url)</li>
</ul>
<h2 id="索引列的顺序"><a href="#索引列的顺序" class="headerlink" title="索引列的顺序"></a>索引列的顺序</h2><p>让选择性最强的索引列放在前面。<br>索引的选择性是指：不重复的索引值和记录总数的比值。最大值为 1，此时每个记录都有唯一的索引与其对应。选择性越高，查询效率也越高。</p>
<h2 id="对较长的字段使用前缀索引"><a href="#对较长的字段使用前缀索引" class="headerlink" title="对较长的字段使用前缀索引"></a>对较长的字段使用前缀索引</h2><p>可以节约大量索引空间<br>对于 BLOB、TEXT 和 VARCHAR 类型的列，必须使用前缀索引，只索引开始的部分字符。<br>对于前缀长度的选取需要根据索引选择性来确定。</p>
<h2 id="索引的使用条件"><a href="#索引的使用条件" class="headerlink" title="索引的使用条件"></a>索引的使用条件</h2><ul>
<li>对于非常小的表、大部分情况下简单的全表扫描比建立索引更高效；</li>
<li>对于中到大型的表，索引就非常有效；</li>
<li>但是对于特大型的表，建立和维护索引的代价将会随之增长。这种情况下，需要用到一种技术可以直接区分出需要查询的一组数据，而不是一条记录一条记录地匹配，例如可以使用分区技术。</li>
</ul>
<h2 id="索引碎片与维护"><a href="#索引碎片与维护" class="headerlink" title="索引碎片与维护"></a>索引碎片与维护</h2><ul>
<li>在长期的数据更改过程中，索引文件和数据文件，都将产生空洞，形成碎片，可以通过一个不产生对数据实质影响的操作来修改表</li>
<li>或者使用 optimize table 也可以修复</li>
</ul>
<h2 id="索引的优点"><a href="#索引的优点" class="headerlink" title="索引的优点"></a>索引的优点</h2><ul>
<li>大大减少服务器需要扫描的数据量</li>
<li>帮助服务器避免进行排序和分组，以及避免创建临时表（B+Tree 索引是有序的，可以用于 ORDER BY 和 GROUP BY 操作。临时表主要是在排序和分组过程中创建，因为不需要排序和分组，也就不需要创建临时表）。</li>
<li>将随机 I/O 变为顺序 I/O（B+Tree 索引是有序的，会将相邻的数据都存储在一起）。</li>
<li>大大提高查询速度，降低写的速度，占用磁盘</li>
</ul>
<h1 id="SQL语句的优化"><a href="#SQL语句的优化" class="headerlink" title="SQL语句的优化"></a>SQL语句的优化</h1><h2 id="切分大查询"><a href="#切分大查询" class="headerlink" title="切分大查询"></a>切分大查询</h2><p>一个大查询如果一次性执行的话，可能一次锁住很多数据、占满整个事务日志、耗尽系统资源、阻塞很多小的但重要的查询。<br>将一个大的查询分解成多个小的相同的查询。<br>一次性删除 1000 万的数据要比一次删除 1 万，暂停一会儿的方案更损耗服务器开销。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> messages <span class="token keyword">WHERE</span> <span class="token keyword">create</span> <span class="token operator">&lt;</span> DATE_SUB<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">3</span> MONTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//切分后</span>
rows_affected <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">do</span> {
rows_affected <span class="token operator">=</span> do_query<span class="token punctuation">(</span>
<span class="token string">"DELETE FROM messages WHERE create &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000"</span><span class="token punctuation">)</span>
} <span class="token keyword">while</span> rows_affected <span class="token operator">></span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="分解关联查询"><a href="#分解关联查询" class="headerlink" title="分解关联查询"></a>分解关联查询</h2><p>将一个关联查询分解成对每一个表进行一次单表查询，然后在应用程序中进行关联。</p>
<ul>
<li>让缓存更高效。对于连接查询，如果其中一个表发生变化，那么整个查询缓存就无法使用。而分解后的多个查询，即使其中一个表发生变化，对其它表的查询缓存依然可以使用。</li>
<li>分解成多个单表查询，这些单表查询的缓存结果更可能被其它查询使用到，从而减少冗余记录的查询。</li>
<li>减少锁竞争。</li>
<li>在应用层进行连接，可以更容易对数据库进行拆分，从而更容易做到高性能和可伸缩。</li>
<li>查询本身效率也可能会有所提升。</li>
</ul>
<h2 id="优化特定类型的查询语句"><a href="#优化特定类型的查询语句" class="headerlink" title="优化特定类型的查询语句"></a>优化特定类型的查询语句</h2><ul>
<li>count(*) 会忽略所有列，直接统计所有列数，不要使用 count(列名)。count()在查询 &lt; 时快，查询 &gt;100 时可以用总的减去 &lt;=100。</li>
<li>group by 和 distinct 可以使用索引来优化</li>
<li>如果不需要使用 order by 进行 group by 时使用 order by null，MySQL 就不会再进行文件排序</li>
<li>优化关联查询：确定 on 或者 using 子句的列上有索引，确保 group by 和 order by 中只有一个表中的列，这样 MySQl 才有可能使用索引</li>
<li>优化子查询：用关联查询替代</li>
<li>优化 limit 分页：limit 偏移量大的时候，查询效率较低。 优化方法：<ol>
<li>从业务上解决，不允许翻过 100 页</li>
<li>不用 offset，用条件查询,记录上次查询最大 ID，下次查询时直接根据 ID 查询</li>
</ol>
</li>
<li>优化 UNION 查询：UNION ALL 效率更高，会查询出重复的数据，但是可以在应用层筛选。 UNION 的子句要尽量具体，查询更少的行</li>
<li>union、in、or 都能够命中索引，建议使用 in。</li>
<li>min/max 优化</li>
</ul>
<h2 id="优化数据访问"><a href="#优化数据访问" class="headerlink" title="优化数据访问"></a>优化数据访问</h2><ul>
<li>改变数据库和表的结构，修改数据表的范式，冗余</li>
<li>只返回必要的列：最好不要使用 SELECT * 语句。</li>
<li>只返回必要的行：使用 LIMIT 语句来限制返回的数据。</li>
<li>缓存重复查询的数据：使用缓存可以避免在数据库中进行查询，特别在要查询的数据经常被重复查询时，缓存带来的查询性能提升将会是非常明显的。</li>
<li>使用索引来覆盖查询</li>
</ul>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li>燕十八.MySQL 优化视频</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651962514&idx=1&sn=550c48c9395b52b7ec561741e86e5ce0&chksm=bd2d094e8a5a80589117a653a30d062b5760ec20f8ab9e2154a63ab782d3353d1b1da50b9bc2&scene=21#wechat_redirect" target="_blank" rel="noopener">同一个SQL语句，为啥性能差异咋就这么大呢？</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651962587&idx=1&sn=d197aea0090ce93b156e0774c6dc3019&chksm=bd2d09078a5a801138922fb5f2b9bb7fdaace7e594d55f45ce4b3fc25cbb973bbc9b2deb2c31&scene=21#wechat_redirect" target="_blank" rel="noopener">如何利用工具，迅猛定位低效SQL？</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/05/11/MySQL-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/" data-id="ckd5czhhp000vnnnr01d12vly" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL-基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/09/MySQL-%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2019-05-09T13:21:05.000Z" itemprop="datePublished">2019-05-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/09/MySQL-%E5%9F%BA%E7%A1%80/">MySQL 基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="基本架构"><a href="#基本架构" class="headerlink" title="基本架构"></a>基本架构</h1><p>客户端-连接器-查询缓存-分析器-优化器-执行器-引擎</p>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>大小（字节）</th>
</tr>
</thead>
<tbody><tr>
<td>tinyint</td>
<td>8</td>
</tr>
<tr>
<td>smallint</td>
<td>16</td>
</tr>
<tr>
<td>mediumint</td>
<td>24</td>
</tr>
<tr>
<td>int</td>
<td>32</td>
</tr>
<tr>
<td>bigint</td>
<td>64</td>
</tr>
</tbody></table>
<ul>
<li>属性：unsigned</li>
<li>长度：可以为整数类型指定宽度，他不会限制值的合法范围，只会影响字符的显示个数,当长度够会默认零填充到前面 如：int(11)</li>
</ul>
<h2 id="实数类型"><a href="#实数类型" class="headerlink" title="实数类型"></a>实数类型</h2><p>float，double 为浮点类型，decimal 可以存储比 bigint 还大的整数，可以用于存储精确小数。<br>CPU 原生支持浮点运算，但是不支持 decimal 类型的计算，因此 decimal 的计算比浮点类型需要更高的代价。</p>
<h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>大小（字节）</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>char</td>
<td>0-255</td>
<td>定长，如果长度设置为 n，不管 value 实际多长都会占用 n 个字符空间（用空格填充）。</td>
</tr>
<tr>
<td>varchar</td>
<td>0-65535</td>
<td>可变长度，占用的空间是 value 的实际大小，varchr 使用 1 或 2 个额外字节记录字符串长度，列长度小于 255 字节，使用 1 个字节表示，否则用两个。</td>
</tr>
<tr>
<td>text</td>
<td>0-65535</td>
<td></td>
</tr>
<tr>
<td>blob</td>
<td>0-65535</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><p>varchar(n) 与 char(n) 括号中 n 代表字符的个数，不是字符的个数。所以使用中文的时候（UTF-8）可以插入 n 个中文。</p>
</li>
<li><p>value 的值超过 char 和 varchar 设置的 n 之后，字符串会被截断。</p>
</li>
<li><p>char 适合存储很短的字符串，或者所有值接近同一个长度</p>
</li>
<li><p>对于经常变更的数据，char 比 varchar 更好，char 不容易产生碎片</p>
</li>
<li><p>在进行存储和检索时，会保留 varchar 末尾的空格，而会删除 char 末尾的空格。</p>
</li>
<li><p>blob/text 查询会使用临时表,导致性能开销</p>
</li>
</ul>
<h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><p>内部存储的是整数</p>
<h2 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h2><ul>
<li>MySQL 提供了 FROM_UNIXTIME() 函数把 UNIX 时间戳转换为日期，并提供了 UNIX_TIMESTAMP() 函数把日期转换为 UNIX 时间戳。</li>
<li>timestamp 比 datetime 空间效率高</li>
<li>如果需要存储微妙，可以使用 bigint 存储</li>
</ul>
<h2 id="列属性"><a href="#列属性" class="headerlink" title="列属性"></a>列属性</h2><p>auto_increment、default、not null、zero fill</p>
<h1 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h1><h2 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h2><ul>
<li>默认事务性索引</li>
<li>数据存储在共享表空间，可以通过配置分开</li>
<li>实现了四个标准的隔离级别，默认级别是可重复读（REPEATABLE READ）。在可重复读隔离级别下，通过多版本并发控制（MVCC）+ 间隙锁（Next-Key Locking）防止幻影读。</li>
<li>主索引是聚簇索引，在索引中保存数据，从而避免直接读取磁盘，对查询性能有很大的提升</li>
<li>内部做了很多优化，包括从磁盘读取数据时采用的可预测性读、能够加快读操作并且自动创建的自适应哈希索引、能够加速插入操作的插入缓冲区等。</li>
<li>对主键查询的性能高于其他类型的存储引擎</li>
<li>通过一些机制和工具支持真正的热备份</li>
<li>支持崩溃后的安全恢复</li>
<li>支持行级锁</li>
<li>支持外键</li>
</ul>
<h2 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h2><ul>
<li>索引与行记录分开存储，叫做非聚簇索引</li>
<li>拥有全文索引，压缩表，空间数据索引</li>
<li>不支持事务</li>
<li>不支持行级锁</li>
<li>不支持崩溃后的安全恢复</li>
<li>表存储在两个文件，MYD和MYI</li>
</ul>
<h2 id="其他表引擎"><a href="#其他表引擎" class="headerlink" title="其他表引擎"></a>其他表引擎</h2><p>Archive、Blackhole、CSV、Memory</p>
<h1 id="三大范式"><a href="#三大范式" class="headerlink" title="三大范式"></a>三大范式</h1><p>数据库的范式设计越高阶，冗余度就越低，高范式一定符合低阶范式的要求。</p>
<ul>
<li>1NF：表中的任何属性都是原子性的，不可再分。</li>
<li>2NF：属性要完全依赖于主键，消除部分子函数依赖。</li>
<li>3NF：属性不依赖于其他非主属性，消除传递依赖。</li>
</ul>
<h2 id="反范式设计"><a href="#反范式设计" class="headerlink" title="反范式设计"></a>反范式设计</h2><p>有时候为了提高运行效率，就必须降低范式标准，适当保留冗余数据。增加字段，允许冗余，达到以空间换时间的目的。</p>
<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><p>为以后的使用而保存的一条或多条 MySQL 语句的集合。存储过程就是有业务逻辑和流程的集合。</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>通过把处理封装在容易使用的单元中，简化复杂的操作</li>
<li>保证数据的一致性</li>
<li>简化对变动的管理</li>
</ul>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><p>提供给程序员和数据分析元来保证数据完整性的一种方法，它是与表事件相关的特殊的存储过程</p>
<h2 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>可通过数据库中的相关表实现级联更改</li>
<li>实时监控某张表中的某个字段的更改而需要做出相应的处理</li>
<li>某些业务编号的生成</li>
</ul>
<h1 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h1><ul>
<li>使用预处理防止 sql 注入</li>
<li>写入数据库的数据要进行特殊字符的转义</li>
<li>查询错误信息不返回给用户，记录到日志</li>
<li>定期数据备份</li>
<li>不给查询用户root权限</li>
<li>关闭远程访问数据库权限</li>
</ul>
<h2 id="Mysql权限管理"><a href="#Mysql权限管理" class="headerlink" title="Mysql权限管理"></a>Mysql权限管理</h2><ul>
<li>host user password 这三个信息存储在mysql.user中</li>
<li>赋予权限 grant 权限(all,create,update…) on <em>.</em> to user@’host’ identified by ‘password’</li>
<li>针对某个库授权 grant all on ecshop.* to user@’host’</li>
<li>修改用户密码 update user set password=password(‘111111’) where XXX;</li>
<li>收回权限 revoke all on <em>.</em> from user@’host’</li>
</ul>
<h1 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h1><p>在主库上把数据更改记录到二进制日志，从库将主库的日志复制到自己的中继日志，从库中读取中继日志中的事件，将其重放到从库的数据中</p>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><ol>
<li>主服务器将用户对数据库更新的操作以二进制格式保存到 Binary Log 日志文件中，然后由 Binary Dump 线程将 Bina Log 日志文件传输给从服务器。</li>
<li>从服务器通过一个 I/O 线程将主服务器的 Bina Log 日志文件中的更新操作复制到一个叫 Relay Log 的中继日志文件中</li>
<li>从服务器通过另一个 SQL 线程将 Relay Log 中继日志文件中的操作依此在本地执行</li>
</ol>
<p>主要涉及三个线程：binlog 线程、I/O 线程和 SQL 线程。</p>
<ul>
<li>binlog 线程 ：负责将主服务器上的数据更改写入二进制日志（Binary log）中。</li>
<li>I/O 线程 ：负责从主服务器上读取二进制日志，并写入从服务器的重放日志（Replay log）中。</li>
<li>SQL 线程 ：负责读取重放日志并重放其中的 SQL 语句。</li>
</ul>
<h2 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h2><ul>
<li>数据分布：随意停止或开始复制，并在不同的地理位置分布数据备份</li>
<li>负载均衡：将第三个服务器的压力</li>
<li>高可用和故障切换：帮助应用程序避免单节点失败</li>
<li>升级测试：可以使用更高版本的 MySQL 作为从库</li>
</ul>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p>主服务器处理写操作以及实时性要求比较高的读操作，而从服务器处理读操作。</p>
<p>读写分离能提高性能的原因在于：</p>
<ul>
<li>主从服务器负责各自的读和写，极大程度缓解了锁的争用；</li>
<li>从服务器可以使用 MyISAM，提升查询性能以及节约系统开销；</li>
<li>增加冗余，提高可用性。</li>
<li>读写分离常用代理方式来实现，代理服务器接收应用层传来的读写请求，然后决定转发到哪个服务器。</li>
</ul>
<h1 id="数据库缓存"><a href="#数据库缓存" class="headerlink" title="数据库缓存"></a>数据库缓存</h1><ul>
<li>极大的解决数据库服务器压力</li>
<li>提高应用数据的响应速度</li>
<li>常见的缓存形式：内存缓存，文件缓存</li>
<li>用户请求–&gt;数据查询–&gt;连接数据库服务器并查询数据–&gt;将数据缓存起来(HTML，内存，JSON，序列化数据)–&gt;显示给客户端</li>
<li>用户再次请求或新用户访问–&gt;数据查询–&gt;直接从缓存中获取数据–&gt;显示给客户端</li>
</ul>
<h2 id="MySql的查询缓存"><a href="#MySql的查询缓存" class="headerlink" title="MySql的查询缓存"></a>MySql的查询缓存</h2><ul>
<li>启用MySql查询缓存 query_cache_type 查询缓存类型，有0、1、2三个取值。<br>0不使用查询缓存。<br>1始终使用查询缓存。也可以关闭查询缓存 SELECT <strong>SQL_NO_CACHE</strong> * FROM my_table WHERE condition;<br>2按需使用查询缓存。 SELECT <strong>SQL_CACHE</strong> * FROM my_table WHERE condition;</li>
<li>query_cache_size 默认情况下为0，表示查询缓存预留的内存为0，无法使用查询缓存 可以临时更改 SEGLOBAL query_cache_size=134217728</li>
<li>查询缓存可以看做是SQL文本和查询结果的映射</li>
<li>第二次查询的SQL和第一次查询的SQL完全相同，则会使用缓存</li>
<li>SHOW STATUS LIKE ‘Qchace_hits’; 查看命中次数</li>
</ul>
<p>1.表的结构或数据发生改变时，查询缓存中的数据不再有效</p>
<ul>
<li>清理缓存</li>
</ul>
<ol>
<li>FLUSH QUERY CACHE;//清理查询缓存的内存碎片</li>
<li>RESET QUERY CACHE;//从查询缓存中移出所有查询</li>
<li>FLUSH TABLES;//关闭所有打开的表，同时该操作将会清空查询缓存中的内容</li>
</ol>
<h1 id="InnoDB-架构"><a href="#InnoDB-架构" class="headerlink" title="InnoDB 架构"></a>InnoDB 架构</h1><p>InnoDB 内存结构包含四大核心组件：</p>
<ol>
<li>缓冲池</li>
<li>写缓冲</li>
<li>自适应哈希索引</li>
<li>日志缓冲</li>
</ol>
<h2 id="缓冲池"><a href="#缓冲池" class="headerlink" title="缓冲池"></a>缓冲池</h2><p>目的是提升 InnoDB 性能，加速读请求，避免每次数据访问都进行磁盘 IO。</p>
<p>缓存表与索引数据，把磁盘上的数据加载到缓冲池。</p>
<p>因为磁盘预读特性，缓冲池一般也是按页缓存读取数据。</p>
<p>MySQL 不能直接用传统的 LRU 缓冲池算法，因为</p>
<ol>
<li>预读失败</li>
<li>缓冲池污染</li>
</ol>
<p>优化预读失败的方法</p>
<ol>
<li>将 LRU 分为两个部分<ul>
<li>新生代</li>
<li>老年代</li>
</ul>
</li>
<li>新生代的尾连接着老年代的头</li>
<li>新页加入到缓冲池时，只加入到老年代的头<ul>
<li>如果数据真正被读取（预读成功），才会加入到新生代的头部</li>
<li>如果数据没有被读取，则会比新生代里的“热数据页”更早被淘汰出缓冲池<br>（1）缓冲池(buffer pool)是一种常见的降低磁盘访问的机制；</li>
</ul>
</li>
</ol>
<p>（2）缓冲池通常以页(page)为单位缓存数据；</p>
<p>（3）缓冲池的常见管理算法是LRU，memcache，OS，InnoDB都使用了这种算法；</p>
<p>（4）InnoDB对普通LRU进行了优化：</p>
<p>将缓冲池分为老生代和新生代，入缓冲池的页，优先进入老生代，页被访问，才进入新生代，以解决预读失效的问题</p>
<p>页被访问，且在老生代停留时间超过配置阈值的，才进入新生代，以解决批量数据访问，大量热数据淘汰的问题</p>
<h2 id="写缓冲"><a href="#写缓冲" class="headerlink" title="写缓冲"></a>写缓冲</h2><p>目的是提升InnoDB性能，加速写请求，避免每次写入都进行磁盘IO。</p>
<p>它是一种应用在非唯一普通索引页(non-unique secondary index page)不在缓冲池中，对页进行了写操作，并不会立刻将磁盘页加载到缓冲池，而仅仅记录缓冲变更(buffer changes)，等未来数据被读取时，再将数据合并(merge)恢复到缓冲池中的技术。写缓冲的目的是降低写操作的磁盘IO，提升数据库性能。</p>
<h2 id="自适应哈希索引"><a href="#自适应哈希索引" class="headerlink" title="自适应哈希索引"></a>自适应哈希索引</h2><p>目的是提升InnoDB性能，加速读请求，减少索引查询的寻路路径。</p>
<p>当某个索引值被使用的非常频繁时，会在 B+Tree 索引之上再创建一个哈希索引，这样就让 B+Tree 索引具有哈希索引的一些优点，比如快速的哈希查找。key 是索引键值，value 是索引记录页面的位置。</p>
<h2 id="日志缓冲"><a href="#日志缓冲" class="headerlink" title="日志缓冲"></a>日志缓冲</h2><p>目的是提升InnoDB性能，极大优化 redo 日志性能，并提供了高并发与强一致性的折衷方案。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li><a href="https://segmentfault.com/a/1190000008131735" target="_blank" rel="noopener">MySQL 性能优化神器 Explain 使用分析</a></li>
<li><a href="https://www.jfox.info/2017/20-tiao-mysql-xing-nen-you-hua-de-zui-jia-jing-yan.html" target="_blank" rel="noopener">20+条MySQL性能优化的最佳经验</a></li>
<li><a href="https://www.jianshu.com/p/43091bfa8aa7" target="_blank" rel="noopener">MySQL慢查询&amp;分析SQL执行效率浅谈</a></li>
<li><a href="https://blog.csdn.net/xiangwanpeng/article/details/54310955" target="_blank" rel="noopener">数据库索引是怎样工作的？</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/23624390" target="_blank" rel="noopener">深入浅出数据库索引原理</a></li>
<li><a href="http://www.uml.org.cn/sjjm/201107145.asp" target="_blank" rel="noopener">MySQl 索引背后的数据结构及算法原理</a></li>
<li><a href="http://tencentdba.com/blog/innodb%E9%A1%B5%E9%9D%A2%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84-1/" target="_blank" rel="noopener">innodb页面存储结构-1</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/05/09/MySQL-%E5%9F%BA%E7%A1%80/" data-id="ckd5czhho000snnnr7ze9hfoh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2019-04-23T13:44:34.000Z" itemprop="datePublished">2019-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式-PHP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="创建型（Creational）"><a href="#创建型（Creational）" class="headerlink" title="创建型（Creational）"></a>创建型（Creational）</h1><p>创建型模式专注于如何实例化一个对象或者一组相关对象</p>
<h2 id="简单工厂（Simple-Factory）"><a href="#简单工厂（Simple-Factory）" class="headerlink" title="简单工厂（Simple Factory）"></a>简单工厂（Simple Factory）</h2><p>简单工厂只是为客户端生成一个实例，而不会向客户端公开任何实例化逻辑。</p>
<p>什么时候使用：当创建对象不仅是一些赋值操作，还涉及一些逻辑操作时，将它放在一个专门的工厂中，从而避免代码重复</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">productA</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'productA'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">productB</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'productB'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Factory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">==</span> <span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">productA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">==</span> <span class="token string">'B'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">productB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
<span class="token variable">$A</span> <span class="token operator">=</span> Factory<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">CreateProduct</span> <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$B</span> <span class="token operator">=</span> Factory<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="工厂模式（Factory-Method）"><a href="#工厂模式（Factory-Method）" class="headerlink" title="工厂模式（Factory Method）"></a>工厂模式（Factory Method）</h2><p>意图：定义一个创建对象的接口，让子类自己决定实例化哪一个工厂类，它提供了一种将实例化逻辑委托给子类的方法。</p>
<p>解决的问题：主要解决接口选择的问题。</p>
<p>何时使用：当类中存在一些通用操作，但是所需子类是在运行时在动态决定的情况。换句话说，当客户端无法知道所需的确切子类时。</p>
<p>跟简单工厂的区别：简单工厂只有一个统一的工厂类，而工厂方法是针对每个要创建的对象都会提供一个工厂类，这些工厂都实现了一个工厂基类。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name">Procduct</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ProductA</span> <span class="token keyword">extends</span> <span class="token class-name">Product</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'A'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ProductB</span> <span class="token keyword">extends</span> <span class="token class-name">Product</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'B'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Factory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">abstract</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ProductAFactory</span> <span class="token keyword">extends</span> <span class="token class-name">Factory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ProductBFactory</span> <span class="token keyword">extends</span> <span class="token class-name">Factory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$productA</span> <span class="token operator">=</span> ProductAFactory<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$productA</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$productB</span> <span class="token operator">=</span> ProductBFactory<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$productB</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="抽象工厂模式（Abstract-Factory）"><a href="#抽象工厂模式（Abstract-Factory）" class="headerlink" title="抽象工厂模式（Abstract Factory）"></a>抽象工厂模式（Abstract Factory）</h2><p>工厂中的工厂，该工厂将各个相关/依赖的工厂组合起来，而无需指定他们具体的类</p>
<ul>
<li>什么时候使用：当创建逻辑有点复杂但内部又相互关联时使用</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name">Door</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">WoodenDoor</span> <span class="token keyword">implements</span> <span class="token class-name">Door</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'I am a wooden door'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">IronDoor</span> <span class="token keyword">implements</span> <span class="token class-name">Door</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'I am an iron door'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">DoorFittingExpert</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Welder</span> <span class="token keyword">implements</span> <span class="token class-name">DoorFittingExpert</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'I can only fit iron doors'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Carpenter</span> <span class="token keyword">implements</span> <span class="token class-name">DoorFittingExpert</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'I can only fit wooden doors'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">DoorFactory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">makeDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Door<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">makeFittingExpert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> DoorFittingExpert<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Wooden factory to return carpenter and wooden door</span>
<span class="token keyword">class</span> <span class="token class-name">WoodenDoorFactory</span> <span class="token keyword">implements</span> <span class="token class-name">DoorFactory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">makeDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Door
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WoodenDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">makeFittingExpert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> DoorFittingExpert
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Carpenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Iron door factory to get iron door and the relevant fitting expert</span>
<span class="token keyword">class</span> <span class="token class-name">IronDoorFactory</span> <span class="token keyword">implements</span> <span class="token class-name">DoorFactory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">makeDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Door
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IronDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">makeFittingExpert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> DoorFittingExpert
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Welder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token variable">$woodenFactory</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WoodenDoorFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$door</span> <span class="token operator">=</span> <span class="token variable">$woodenFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">makeDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$expert</span> <span class="token operator">=</span> <span class="token variable">$woodenFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">makeFittingExpert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$door</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Output: I am a wooden door</span>
<span class="token variable">$expert</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Output: I can only fit wooden doors</span>

<span class="token comment" spellcheck="true">// Same for Iron Factory</span>
<span class="token variable">$ironFactory</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IronDoorFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$door</span> <span class="token operator">=</span> <span class="token variable">$ironFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">makeDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$expert</span> <span class="token operator">=</span> <span class="token variable">$ironFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">makeFittingExpert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$door</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Output: I am an iron door</span>
<span class="token variable">$expert</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Output: I can only fit iron doors</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="建造者模式（Builder）"><a href="#建造者模式（Builder）" class="headerlink" title="建造者模式（Builder）"></a>建造者模式（Builder）</h2><p>可以创建不同风格的对象，同时避免构造函数污染。适合当某对象可能会有多种风格，或者在创建对象时涉及多个步骤时使用</p>
<ul>
<li><p>什么时候使用：当某个对象可能会有多种风格，或者想避免重叠构造器反模式（(telescoping constructor anti-pattern) ）时使用。与工厂模式的区别是，工厂模式适用于创建过程只有一个步骤的情况，而建造者模式适用于创建过程涉及多个步骤的情况。</p>
</li>
<li><p>重叠构造器反模式(telescoping constructor anti-pattern)</p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token variable">$cheese</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token variable">$pepperoni</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token variable">$tomato</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$lettuce</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  构造函数的参数个数很快会变得一发不可收拾，从而要理解参数布局会变得困难。另外假如以后还要添加更多功能的话，该参数列表还会继续增长。</p>
</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Burger</span><span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$size</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$cheese</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$pepperoni</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$lettuce</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$tomato</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>BurgerBuilder <span class="token variable">$builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">size</span> <span class="token operator">=</span> <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">size</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cheese</span> <span class="token operator">=</span> <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cheese</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pepperoni</span> <span class="token operator">=</span> <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pepperoni</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lettuce</span> <span class="token operator">=</span> <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lettuce</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tomato</span> <span class="token operator">=</span> <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tomato</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">BurgerBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$size</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token variable">$cheese</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$pepperoni</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$lettuce</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$tomato</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>int <span class="token variable">$size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">size</span> <span class="token operator">=</span> <span class="token variable">$size</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addPepperoni</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pepperoni</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addLettuce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lettuce</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addCheese</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cheese</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addTomato</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tomato</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> Burger <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Burger</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$burger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BurgerBuilder</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">></span><span class="token function">addPepperoni</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">></span><span class="token function">addLettuce</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">></span><span class="token function">addTomato</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">></span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="原型模式（Prototype）"><a href="#原型模式（Prototype）" class="headerlink" title="原型模式（Prototype）"></a>原型模式（Prototype）</h2><p>根据某个现有的对象，通过克隆来创建对象</p>
<ul>
<li>什么时候使用：当所需对象和某个现存对象非常相似时，或者当创建操作比克隆花销更大时</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Sheep</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$category</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">,</span> string <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token string">'Mountain Sheep'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">category</span> <span class="token operator">=</span> <span class="token variable">$category</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setCategory</span><span class="token punctuation">(</span>string <span class="token variable">$category</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">category</span> <span class="token operator">=</span> <span class="token variable">$category</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">category</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$original</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sheep</span><span class="token punctuation">(</span><span class="token string">"Jolly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$original</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$original</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Clone and modify what is required</span>
<span class="token variable">$cloned</span> <span class="token operator">=</span> clone <span class="token variable">$original</span><span class="token punctuation">;</span>
<span class="token variable">$cloned</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'Dolly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$cloned</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$cloned</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="单例模式（Singleton）"><a href="#单例模式（Singleton）" class="headerlink" title="单例模式（Singleton）"></a>单例模式（Singleton）</h2><p>确保某个类永远只能创建一个对象。<br>节约系统资源，提高了系统效率，同时也能够严格控制客户对它的访问</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**
     * 通过懒加载获得实例（在第一次使用时创建）
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> Singleton
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$instance</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//构造方法私有化，不允许从外部调用以防止创建多个实例</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">__clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//防止实例被克隆</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//防止反序列化</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="结构型（Structural）"><a href="#结构型（Structural）" class="headerlink" title="结构型（Structural）"></a>结构型（Structural）</h1><p>结构型模式主要关注对象的组合或者换句话说是实体间如何能够相互使用。</p>
<h2 id="适配器模式（Adapter）"><a href="#适配器模式（Adapter）" class="headerlink" title="适配器模式（Adapter）"></a>适配器模式（Adapter）</h2><p>适配器模式允许你在适配器中封装其他不兼容的对象，从而使它们与某些类兼容。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name">perfactMan</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">cook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">wife</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">cook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'cook'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">man</span> <span class="token keyword">implements</span> <span class="token class-name">perfactMan</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$wife</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">_construct</span><span class="token punctuation">(</span><span class="token variable">$wife</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">wife</span> <span class="token operator">=</span> <span class="token variable">$wife</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">cook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">wife</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">cook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'write'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$wife</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wife</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$man</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token variable">$wife</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$man</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">cook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$man</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="桥接模式（Bridge）"><a href="#桥接模式（Bridge）" class="headerlink" title="桥接模式（Bridge）"></a>桥接模式（Bridge）</h2><p>将抽象部分与实现部分相分离。</p>
<p>桥接模式认为组合优于继承。它能将一个层级结构中的实现细节转到位于另一个分离的层级结构的对象中。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name">WebPage</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Theme <span class="token variable">$theme</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">About</span> <span class="token keyword">implements</span> <span class="token class-name">WebPage</span><span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$theme</span><span class="token punctuation">;</span>

     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Theme <span class="token variable">$theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">theme</span> <span class="token operator">=</span> <span class="token variable">$theme</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"About page in "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">theme</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Careers</span> <span class="token keyword">implements</span> <span class="token class-name">WebPage</span> <span class="token punctuation">{</span>
   <span class="token keyword">protected</span> <span class="token variable">$theme</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Theme <span class="token variable">$theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">theme</span> <span class="token operator">=</span> <span class="token variable">$theme</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token string">"Careers page in "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">theme</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Theme</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">DarkTheme</span> <span class="token keyword">implements</span> <span class="token class-name">Theme</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'Dark Black'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">LightTheme</span> <span class="token keyword">implements</span> <span class="token class-name">Theme</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'Off white'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$darkTheme</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DarkTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$about</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">About</span><span class="token punctuation">(</span><span class="token variable">$darkTheme</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$careers</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Careers</span><span class="token punctuation">(</span><span class="token variable">$darkTheme</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$about</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "About page in Dark Black";</span>
<span class="token keyword">echo</span> <span class="token variable">$careers</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "Careers page in Dark Black";</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="组合模式（Composite）"><a href="#组合模式（Composite）" class="headerlink" title="组合模式（Composite）"></a>组合模式（Composite）</h2><p>组合模式使得客户能以统一的方式对待每个对象</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">,</span> float <span class="token variable">$salary</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> string<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setSalary</span><span class="token punctuation">(</span>float <span class="token variable">$salary</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> float<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">:</span> <span class="token keyword">array</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Developer</span> <span class="token keyword">implements</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">,</span> float <span class="token variable">$salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">salary</span> <span class="token operator">=</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> string <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setSalary</span><span class="token punctuation">(</span>float <span class="token variable">$salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">salary</span> <span class="token operator">=</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> float <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">array</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">roles</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Designer</span> <span class="token keyword">implements</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">,</span> float <span class="token variable">$salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">salary</span> <span class="token operator">=</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> string <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setSalary</span><span class="token punctuation">(</span>float <span class="token variable">$salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">salary</span> <span class="token operator">=</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> float <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">array</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">roles</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Organization</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token variable">$employees</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addEmployee</span><span class="token punctuation">(</span>Employee <span class="token variable">$employee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">employees</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$employee</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getNetSalaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> float <span class="token punctuation">{</span>
        <span class="token variable">$netSalary</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">employees</span> <span class="token keyword">as</span> <span class="token variable">$employee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$netSalary</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token variable">$employee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$netSalary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// Prepare the employees</span>
<span class="token variable">$john</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Developer</span><span class="token punctuation">(</span><span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$jane</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Designer</span><span class="token punctuation">(</span><span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Add them to organization</span>
<span class="token variable">$organization</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Organization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$organization</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addEmployee</span><span class="token punctuation">(</span><span class="token variable">$john</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$organization</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addEmployee</span><span class="token punctuation">(</span><span class="token variable">$jane</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token string">"Net salaries: "</span> <span class="token punctuation">.</span> <span class="token variable">$organization</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getNetSalaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Net Salaries: 22000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="装饰器模式（Decorator）"><a href="#装饰器模式（Decorator）" class="headerlink" title="装饰器模式（Decorator）"></a>装饰器模式（Decorator）</h2><p>装饰器模式通过将对象封装在装饰器类的对象中，从而你能在运行时动态得修改原对象的行为</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name">Coffee</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SimpleCoffee</span> <span class="token keyword">implements</span> <span class="token class-name">Coffee</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'Simple coffee'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MilkCoffee</span> <span class="token keyword">implements</span> <span class="token class-name">Coffee</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token variable">$coffee</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Coffee <span class="token variable">$coffee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span> <span class="token operator">=</span> <span class="token variable">$coffee</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">', milk'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">WhipCoffee</span> <span class="token keyword">implements</span> <span class="token class-name">Coffee</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token variable">$coffee</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Coffee <span class="token variable">$coffee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span> <span class="token operator">=</span> <span class="token variable">$coffee</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">', whip'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">VanillaCoffee</span> <span class="token keyword">implements</span> <span class="token class-name">Coffee</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token variable">$coffee</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Coffee <span class="token variable">$coffee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span> <span class="token operator">=</span> <span class="token variable">$coffee</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">', vanilla'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token variable">$someCoffee</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 10</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Simple Coffee</span>

<span class="token variable">$someCoffee</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MilkCoffee</span><span class="token punctuation">(</span><span class="token variable">$someCoffee</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 12</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Simple Coffee, milk</span>

<span class="token variable">$someCoffee</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WhipCoffee</span><span class="token punctuation">(</span><span class="token variable">$someCoffee</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 17</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Simple Coffee, milk, whip</span>

<span class="token variable">$someCoffee</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VanillaCoffee</span><span class="token punctuation">(</span><span class="token variable">$someCoffee</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 20</span>
<span class="token keyword">echo</span> <span class="token variable">$someCoffee</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Simple Coffee, milk, whip, vanilla</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="依赖注入（Dependency-Injection）"><a href="#依赖注入（Dependency-Injection）" class="headerlink" title="依赖注入（Dependency Injection）"></a>依赖注入（Dependency Injection）</h2><p>减少类和类之间联系，本来是接受各种参数来构造一个对象，现在只接受一个参数，已经实例化的对象</p>
<ul>
<li>容器：<ul>
<li>降低耦合度</li>
<li>实现惰性加载</li>
<li>便于管理</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">LunTai</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'roll'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Car</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$luntai</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$luntai</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">luntai</span> <span class="token operator">=</span> <span class="token variable">$luntai</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$luntai</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token string">'run'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$luntai</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LunTai</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$car</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token variable">$luntai</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$car</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//容器</span>
<span class="token keyword">class</span> <span class="token class-name">Container</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token variable">$register</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> Closure <span class="token variable">$col</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$register</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$col</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$col</span> <span class="token operator">=</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$register</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$col</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Container<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'luntai'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LunTai</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Container<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span>Container<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">'luntai'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$car</span> <span class="token operator">=</span> Container<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$car</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 创建一个容器（后面称作超级工厂）</span>
<span class="token variable">$container</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 向该 超级工厂 添加 超人 的生产脚本</span>
<span class="token variable">$container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'superman'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$container</span><span class="token punctuation">,</span> <span class="token variable">$moduleName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Superman</span><span class="token punctuation">(</span><span class="token variable">$container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$moduleName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 向该 超级工厂 添加 超能力模组 的生产脚本</span>
<span class="token variable">$container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'xpower'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XPower</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 同上</span>
<span class="token variable">$container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'ultrabomb'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UltraBomb</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// ****************** 华丽丽的分割线 **********************</span>
    <span class="token comment" spellcheck="true">// 开始启动生产</span>
<span class="token variable">$superman_1</span> <span class="token operator">=</span> <span class="token variable">$container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">'superman'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'xpower'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$superman_2</span> <span class="token operator">=</span> <span class="token variable">$container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">'superman'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ultrabomb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$superman_3</span> <span class="token operator">=</span> <span class="token variable">$container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">'superman'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'xpower'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="外观模式（Facade）"><a href="#外观模式（Facade）" class="headerlink" title="外观模式（Facade）"></a>外观模式（Facade）</h2><p>外观模式为负载子系统提供一个简化接口</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Light</span>
<span class="token punctuation">{</span>
    fuction <span class="token function">turnOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">turnOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    funcrion <span class="token function">deactive</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Facade</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$light</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$camera</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">light</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">camera</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Camera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">light</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">turnOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">camera</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">avtice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">light</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">turnOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">camera</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">deavtice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$f</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Facade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$f</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$f</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="享元模式（Flyweight）"><a href="#享元模式（Flyweight）" class="headerlink" title="享元模式（Flyweight）"></a>享元模式（Flyweight）</h2><p>它能使相似对象间通过尽可能多地共享，以减少内存使用和计算花销</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// Anything that will be cached is flyweight. </span>
<span class="token comment" spellcheck="true">// Types of tea here will be flyweights.</span>
<span class="token keyword">class</span> <span class="token class-name">KarakTea</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Acts as a factory and saves the tea</span>
<span class="token keyword">class</span> <span class="token class-name">TeaMaker</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$availableTea</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$preference</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">availableTea</span><span class="token punctuation">[</span><span class="token variable">$preference</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">availableTea</span><span class="token punctuation">[</span><span class="token variable">$preference</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KarakTea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">availableTea</span><span class="token punctuation">[</span><span class="token variable">$preference</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">TeaShop</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token variable">$orders</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$teaMaker</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>TeaMaker <span class="token variable">$teaMaker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">teaMaker</span> <span class="token operator">=</span> <span class="token variable">$teaMaker</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">takeOrder</span><span class="token punctuation">(</span>string <span class="token variable">$teaType</span><span class="token punctuation">,</span> int <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">orders</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">teaMaker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$teaType</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">orders</span> <span class="token keyword">as</span> <span class="token variable">$table</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$tea</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token string">"Serving tea to table# "</span> <span class="token punctuation">.</span> <span class="token variable">$table</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$teaMaker</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TeaMaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$shop</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TeaShop</span><span class="token punctuation">(</span><span class="token variable">$teaMaker</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$shop</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">'less sugar'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$shop</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">'more milk'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$shop</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">'without sugar'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$shop</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Serving tea to table# 1</span>
<span class="token comment" spellcheck="true">// Serving tea to table# 2</span>
<span class="token comment" spellcheck="true">// Serving tea to table# 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="代理模式（Proxy）"><a href="#代理模式（Proxy）" class="headerlink" title="代理模式（Proxy）"></a>代理模式（Proxy）</h2><p>使用代理模式，一个类可以代表其他类的功能。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name">Door</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">LabDoor</span> <span class="token keyword">implements</span> <span class="token class-name">Door</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">"Opening lab door"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">"Closing the lab door"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$door</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Door <span class="token variable">$door</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">door</span> <span class="token operator">=</span> <span class="token variable">$door</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">door</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token string">"Big no! It ain't possible."</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$password</span> <span class="token operator">===</span> <span class="token string">'$ecr@t'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">door</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$door</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LabDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$door</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'invalid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Big no! It ain't possible.</span>

<span class="token variable">$door</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'$ecr@t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Opening lab door</span>
<span class="token variable">$door</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Closing lab door</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="行为型（Behavioral）"><a href="#行为型（Behavioral）" class="headerlink" title="行为型（Behavioral）"></a>行为型（Behavioral）</h1><p>行为型设计模式关注对象之间的通信。</p>
<h2 id="责任链模式（Chain-of-Responsibility）"><a href="#责任链模式（Chain-of-Responsibility）" class="headerlink" title="责任链模式（Chain of Responsibility）"></a>责任链模式（Chain of Responsibility）</h2><p>它用于创建一个对象链。请求从一端进入，并从一个对象传递到另一个，直至找到适合处理的对象。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$successor</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$balance</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setNext</span><span class="token punctuation">(</span>Account <span class="token variable">$account</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">successor</span> <span class="token operator">=</span> <span class="token variable">$account</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pay</span><span class="token punctuation">(</span>float <span class="token variable">$amountToPay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">canPay</span><span class="token punctuation">(</span><span class="token variable">$amountToPay</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">'Paid %s using %s'</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">,</span> <span class="token variable">$amountToPay</span><span class="token punctuation">,</span> <span class="token function">get_called_class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">successor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">'Cannot pay using %s. Proceeding ..'</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">,</span> <span class="token function">get_called_class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">successor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token variable">$amountToPay</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token function">Exception</span><span class="token punctuation">(</span><span class="token string">'None of the accounts have enough balance'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">canPay</span><span class="token punctuation">(</span><span class="token variable">$amount</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> bool <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">balance</span> <span class="token operator">>=</span> <span class="token variable">$amount</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bank</span> <span class="token keyword">extends</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$balance</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>float <span class="token variable">$balance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">balance</span> <span class="token operator">=</span> <span class="token variable">$balance</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Paypal</span> <span class="token keyword">extends</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$balance</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>float <span class="token variable">$balance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">balance</span> <span class="token operator">=</span> <span class="token variable">$balance</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bitcoin</span> <span class="token keyword">extends</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$balance</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>float <span class="token variable">$balance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">balance</span> <span class="token operator">=</span> <span class="token variable">$balance</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// 创建如下的一个链接</span>
<span class="token comment" spellcheck="true">//      $bank->$paypal->$bitcoin</span>
<span class="token comment" spellcheck="true">//</span>
<span class="token comment" spellcheck="true">// 优先使用银行帐户</span>
<span class="token comment" spellcheck="true">//      如果银行帐户无法支付再用 paypal</span>
<span class="token comment" spellcheck="true">//      如果 paypal 不能支持再用比特币</span>

<span class="token variable">$bank</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bank</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// Bank with balance 100</span>
<span class="token variable">$paypal</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paypal</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// Paypal with balance 200</span>
<span class="token variable">$bitcoin</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bitcoin</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Bitcoin with balance 300</span>

<span class="token variable">$bank</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setNext</span><span class="token punctuation">(</span><span class="token variable">$paypal</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$paypal</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setNext</span><span class="token punctuation">(</span><span class="token variable">$bitcoin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Let's try to pay using the first priority i.e. bank</span>
<span class="token variable">$bank</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">259</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 输出会是</span>
<span class="token comment" spellcheck="true">// ==============</span>
<span class="token comment" spellcheck="true">// Cannot pay using bank. Proceeding ..</span>
<span class="token comment" spellcheck="true">// Cannot pay using paypal. Proceeding ..: </span>
<span class="token comment" spellcheck="true">// Paid 259 using Bitcoin!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="命令模式（Command）"><a href="#命令模式（Command）" class="headerlink" title="命令模式（Command）"></a>命令模式（Command）</h2><p>它允许你在对象中封装行为。该模式背后的主要思想是：提供将客户与接收者解耦的方法。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// Receiver</span>
<span class="token keyword">class</span> <span class="token class-name">Bulb</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">turnOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">"Bulb has been lit"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">turnOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">"Darkness!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Command</span>
<span class="token keyword">class</span> <span class="token class-name">TurnOn</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$bulb</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Bulb <span class="token variable">$bulb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bulb</span> <span class="token operator">=</span> <span class="token variable">$bulb</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bulb</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">turnOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bulb</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">turnOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TurnOff</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$bulb</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Bulb <span class="token variable">$bulb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bulb</span> <span class="token operator">=</span> <span class="token variable">$bulb</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bulb</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">turnOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bulb</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">turnOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">RemoteControl</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">submit</span><span class="token punctuation">(</span>Command <span class="token variable">$command</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$command</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token variable">$bulb</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bulb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$turnOn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TurnOn</span><span class="token punctuation">(</span><span class="token variable">$bulb</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$turnOff</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TurnOff</span><span class="token punctuation">(</span><span class="token variable">$bulb</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$remote</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RemoteControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$remote</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token variable">$turnOn</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Bulb has been lit!</span>
<span class="token variable">$remote</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token variable">$turnOff</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Darkness!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="迭代器模式（Iterator）"><a href="#迭代器模式（Iterator）" class="headerlink" title="迭代器模式（Iterator）"></a>迭代器模式（Iterator）</h2><p>它提供了一种访问对象内所有元素的方法，而避免暴露低层的表示法。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">RadioStation</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$frequency</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>float <span class="token variable">$frequency</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">frequency</span> <span class="token operator">=</span> <span class="token variable">$frequency</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> float <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">frequency</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token package">Countable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Iterator</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">StationList</span> <span class="token keyword">implements</span> <span class="token class-name">Countable</span><span class="token punctuation">,</span> Iterator <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/** @var RadioStation[] $stations */</span>
    <span class="token keyword">protected</span> <span class="token variable">$stations</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/** @var int $counter */</span>
    <span class="token keyword">protected</span> <span class="token variable">$counter</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addStation</span><span class="token punctuation">(</span>RadioStation <span class="token variable">$station</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">stations</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$station</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">removeStation</span><span class="token punctuation">(</span>RadioStation <span class="token variable">$toRemove</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$toRemoveFrequency</span> <span class="token operator">=</span> <span class="token variable">$toRemove</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">stations</span> <span class="token operator">=</span> <span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">stations</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>RadioStation <span class="token variable">$station</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$toRemoveFrequency</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$station</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token variable">$toRemoveFrequency</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> int <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">stations</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> RadioStation <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">stations</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">counter</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">counter</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">counter</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">counter</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">valid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">stations</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">counter</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$stationList</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$stationList</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addStation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RadioStation</span><span class="token punctuation">(</span><span class="token number">89</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stationList</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addStation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RadioStation</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stationList</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addStation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RadioStation</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stationList</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addStation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RadioStation</span><span class="token punctuation">(</span><span class="token number">103.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$stationList</span> <span class="token keyword">as</span> <span class="token variable">$station</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$station</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$stationList</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeStation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RadioStation</span><span class="token punctuation">(</span><span class="token number">89</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Will remove station 89</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="中介者模式（Mediator）"><a href="#中介者模式（Mediator）" class="headerlink" title="中介者模式（Mediator）"></a>中介者模式（Mediator）</h2><p>中介者模式引入了一个第三方对象（叫中介者 mediator) 来控制两个对象（叫同事 colleagues) 间的交互。它有助于减少彼此通信的类间的耦合性。因为现在它们无需了解对方的实现细节。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// Mediator</span>
<span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token keyword">implements</span> <span class="token class-name">ChatRoomMediator</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">showMessage</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> string <span class="token variable">$message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string">'M d, y H:i'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$sender</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">echo</span> <span class="token variable">$time</span> <span class="token punctuation">.</span> <span class="token string">'['</span> <span class="token punctuation">.</span> <span class="token variable">$sender</span> <span class="token punctuation">.</span> <span class="token string">']:'</span> <span class="token punctuation">.</span> <span class="token variable">$message</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$chatMediator</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">,</span> ChatRoomMediator <span class="token variable">$chatMediator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">chatMediator</span> <span class="token operator">=</span> <span class="token variable">$chatMediator</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">chatMediator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$mediator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$john</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token variable">$mediator</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$jane</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'Jane Doe'</span><span class="token punctuation">,</span> <span class="token variable">$mediator</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$john</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hi there!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$jane</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Output will be</span>
<span class="token comment" spellcheck="true">// Feb 14, 10:58 [John]: Hi there!</span>
<span class="token comment" spellcheck="true">// Feb 14, 10:58 [Jane]: Hey!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="备忘录模式（Memento）"><a href="#备忘录模式（Memento）" class="headerlink" title="备忘录模式（Memento）"></a>备忘录模式（Memento）</h2><p>备忘录模式就是关于用某种方式获取或保存对象当前状态的模式，从而使对象能在稍后顺利恢复。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">EditorMemento</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$content</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>string <span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Editor</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">type</span><span class="token punctuation">(</span>string <span class="token variable">$words</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token punctuation">.</span> <span class="token string">' '</span> <span class="token punctuation">.</span> <span class="token variable">$words</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EditorMemento</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">restore</span><span class="token punctuation">(</span>EditorMemento <span class="token variable">$memento</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token variable">$memento</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$editor</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Editor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Type some stuff</span>
<span class="token variable">$editor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'This is the first sentence.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$editor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'This is second.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Save the state to restore to : This is the first sentence. This is second.</span>
<span class="token variable">$saved</span> <span class="token operator">=</span> <span class="token variable">$editor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Type some more</span>
<span class="token variable">$editor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'And this is third.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Output: Content before Saving</span>
<span class="token keyword">echo</span> <span class="token variable">$editor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// This is the first sentence. This is second. And this is third.</span>

<span class="token comment" spellcheck="true">// Restoring to last saved state</span>
<span class="token variable">$editor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token variable">$saved</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$editor</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// This is the first sentence. This is second.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="观察者模式（Observer）"><a href="#观察者模式（Observer）" class="headerlink" title="观察者模式（Observer）"></a>观察者模式（Observer）</h2><p>它在对象间定义了一种依赖关系，从而当某个对象的状态改变后，它的所有依赖对象都将得到通知。</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//事件生产者</span>
abstruct <span class="token keyword">class</span> <span class="token class-name">EventGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$observers</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">addObserver</span><span class="token punctuation">(</span>Observer <span class="token variable">$observer</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">observers</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$observer</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$observers</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$item</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">delObserber</span><span class="token punctuation">(</span><span class="token variable">$observer</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token variable">$observer</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">observers</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">array_splice</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">observers</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//观察者接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Observer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$event_info</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//实现观察者逻辑接口</span>
<span class="token keyword">class</span> <span class="token class-name">Observer1</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$event_info</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'给用户发邮件'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Observer2</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$event_info</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'给商户发邮件'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//在主方法中调用</span>
<span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token keyword">extends</span> <span class="token class-name">EventGenerator</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">'下单成功'</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$event</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addOvserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Observer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addOvserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Observer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="访问者（Visitor）"><a href="#访问者（Visitor）" class="headerlink" title="访问者（Visitor）"></a>访问者（Visitor）</h2><h2 id="策略（Strategy）"><a href="#策略（Strategy）" class="headerlink" title="策略（Strategy）"></a>策略（Strategy）</h2><p>能让你在运行时选择算法的行为。</p>
<h2 id="状态（State）"><a href="#状态（State）" class="headerlink" title="状态（State）"></a>状态（State）</h2><h2 id="模板方法（Template-Method）"><a href="#模板方法（Template-Method）" class="headerlink" title="模板方法（Template Method）"></a>模板方法（Template Method）</h2><p>模板方法定义了某特定算法如何执行的框架，但执行步骤的具体实现则推迟到子类中去完成。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li><a href="https://github.com/kamranahmedse/design-patterns-for-humans#-simple-factory" target="_blank" rel="noopener">design-patterns-for-humans</a></li>
<li><a href="https://learnku.com/articles/27556#b32af9" target="_blank" rel="noopener">超全的设计模式简介（45 种）</a></li>
<li><a href="https://www.atjiang.com/design-patterns-for-humans-creational/" target="_blank" rel="noopener">用人话描述的设计模式–创建型设计模式</a></li>
<li><a href="https://www.runoob.com/design-pattern/factory-pattern.html" target="_blank" rel="noopener">菜鸟教程-设计模式</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liuyuqi21.github.io/2019/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-id="ckd5czhir004annnr4e4kei44" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%97%AE%E9%A2%98/">问题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Laravel/" rel="tag">Laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RocketMQ/" rel="tag">RocketMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZooKeeper/" rel="tag">ZooKeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redisson/" rel="tag">redisson</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typora/" rel="tag">typora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B9%90%E8%A7%82%E9%94%81/" rel="tag">乐观锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" rel="tag">分布式事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%91%E6%8C%87Offer/" rel="tag">剑指Offer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">知识点</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">缓存</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" rel="tag">负载均衡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E7%BB%8F/" rel="tag">面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A2%98%E7%9B%AE/" rel="tag">题目</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" rel="tag">高并发</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/JAVA/" style="font-size: 10px;">JAVA</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 17.5px;">Java</a> <a href="/tags/Laravel/" style="font-size: 10px;">Laravel</a> <a href="/tags/Linux/" style="font-size: 12.5px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 20px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/PHP/" style="font-size: 17.5px;">PHP</a> <a href="/tags/Redis/" style="font-size: 17.5px;">Redis</a> <a href="/tags/RocketMQ/" style="font-size: 12.5px;">RocketMQ</a> <a href="/tags/ZooKeeper/" style="font-size: 10px;">ZooKeeper</a> <a href="/tags/leetcode/" style="font-size: 12.5px;">leetcode</a> <a href="/tags/redisson/" style="font-size: 10px;">redisson</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/typora/" style="font-size: 10px;">typora</a> <a href="/tags/%E4%B9%90%E8%A7%82%E9%94%81/" style="font-size: 10px;">乐观锁</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" style="font-size: 12.5px;">分布式事务</a> <a href="/tags/%E5%89%91%E6%8C%87Offer/" style="font-size: 20px;">剑指Offer</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">排序</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 12.5px;">操作系统</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 10px;">消息队列</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/" style="font-size: 10px;">知识点</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 10px;">缓存</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 12.5px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">读书笔记</a> <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" style="font-size: 10px;">负载均衡</a> <a href="/tags/%E9%9D%A2%E7%BB%8F/" style="font-size: 12.5px;">面经</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 10px;">面试</a> <a href="/tags/%E9%A2%98%E7%9B%AE/" style="font-size: 15px;">题目</a> <a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">高并发</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/11/leetcode-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">leetcode 数据结构</a>
          </li>
        
          <li>
            <a href="/2020/04/01/%E9%9D%A2%E8%AF%95%E8%8C%83%E5%9B%B4/">面试范围</a>
          </li>
        
          <li>
            <a href="/2020/03/23/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">负载均衡</a>
          </li>
        
          <li>
            <a href="/2020/03/20/JAVA%20%E5%B9%B6%E5%8F%91/">Java 并发</a>
          </li>
        
          <li>
            <a href="/2020/03/10/typora%E5%BF%AB%E6%8D%B7%E9%94%AE/">typora 快捷键</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Cellophane<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>